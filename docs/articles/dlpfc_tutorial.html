<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SRTpipeline - Embedding and spatial clustering for single sample • SRTpipeline</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="SRTpipeline - Embedding and spatial clustering for single sample">
<meta property="og:description" content="SRTpipeline">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">SRTpipeline</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="../articles/Installation.html">
    <span class="fas fa-book"></span>
     
    Install
  </a>
</li>
<li>
  <a href="../articles/get_started.html">
    <span class="fas fa-book"></span>
     
    Get Started
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-book"></span>
     
    Single Data Analysis
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/single_basic_tutorial.html">Basic tutorial</a>
    </li>
    <li>
      <a href="../articles/dlpfc_tutorial.html">Embedding and clustering introduction</a>
    </li>
    <li>
      <a href="../articles/single_Embryo_SC_tutorial.html">SRT data clustering</a>
    </li>
    <li>
      <a href="../articles/single_Embryo_DRSC_tutorial.html">SRT data embedding and clustering</a>
    </li>
    <li>
      <a href="../articles/single_MOB_Anno_tutorial.html">SRT data embedding and annotation</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-book"></span>
     
    Multiple Data Analysis
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/multibatch_basic_tutorial.html">Basic tutorial</a>
    </li>
    <li>
      <a href="../articles/integration_introduction.html">Basic tutorial v2</a>
    </li>
    <li>
      <a href="../articles/multibatch_brain12_tutorial.html">SRT data clustering and integration</a>
    </li>
    <li>
      <a href="../articles/multibatch_HCC4_tutorial.html">SRT data embedding, clustering and integration example 1</a>
    </li>
    <li>
      <a href="../articles/multibatch_liver8_tutorial.html">SRT data embedding, clustering and integration example 2</a>
    </li>
    <li>
      <a href="../articles/multibatch_MOB16_tutorial.html">SRT data embedding, clustering and integration example 3</a>
    </li>
  </ul>
</li>
<li>
  <a href="../articles/faq.html">
    <span class="fa fa-question-circle-o"></span>
     
    FAQ
  </a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li>
  <a href="../reference/index.html">
    <span class="fa fa-file-code-o"></span>
     
    Functions
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>SRTpipeline - Embedding and spatial clustering for single sample</h1>
            
            <h4 data-toc-skip class="date">Compiled: 二月 19, 2023</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/feiyoung/SRTpipeline/blob/HEAD/vignettes/dlpfc_tutorial.Rmd"><code>vignettes/dlpfc_tutorial.Rmd</code></a></small>
      <div class="hidden name"><code>dlpfc_tutorial.Rmd</code></div>

    </div>

    
    
<hr>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>This tutorial demonstrates how to use <code>SRTpipeline</code> (&gt;=0.1.0) to analyze multiple spatially-resolved transcriptomics (SRT) data. We emphases how to use <code>DR-SC</code> model to achieve joint embedding (dimension reduction) and spaital clustering based on the <code>SRTProject</code> object in the <code>SRTpipeline</code> package. This tutorial will cover the following tasks, which we believe will be common for many spatial analyses:</p>
<ul>
<li>Normalization</li>
<li>Feature selection</li>
<li>Joint embedding and spatial clustering</li>
<li>DEG analysis</li>
<li>Spatial trajectory inference</li>
<li>Visualization</li>
</ul>
<p>First, we load <code>SRTpipeline</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/feiyoung/SRTpipeline">SRTpipeline</a></span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="dataset">Dataset<a class="anchor" aria-label="anchor" href="#dataset"></a>
</h2>
<p>Here, we will be analyzing a spatial transcriptomics dataset (SampleID: 151672) for human dorsolateral prefrontal cortex (DLPFC). There are 4015 spots and 33538 genes that were sequenced on the 10x Visium platform. Our preprocessed data can be downloaded <a href="https://github.com/feiyoung/PRECAST/blob/main/vignettes_data/dlpfc_151672.rda?raw=true" class="external-link">here</a>, and the raw data can be found <a href="https://github.com/LieberInstitute/spatialLIBD" class="external-link">here</a>.</p>
<p>Next, we download the data to the current working path for the followed analysis by the following command:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">githubURL</span> <span class="op">&lt;-</span> <span class="st">"https://github.com/feiyoung/PRECAST/blob/main/vignettes_data/dlpfc_151672.rda?raw=true"</span>
<span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span><span class="va">githubURL</span>, <span class="st">"dlpfc_151672.rda"</span>, mode <span class="op">=</span> <span class="st">"wb"</span><span class="op">)</span></code></pre></div>
<p>Then load to R. The data is saved in a Seurat object named <code>dlpfc_151672</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="st">"dlpfc_151672.rda"</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="pre-processing-workflow">Pre-processing workflow<a class="anchor" aria-label="anchor" href="#pre-processing-workflow"></a>
</h2>
<div class="section level3">
<h3 id="create-a-srtproject-object">Create a SRTProject object<a class="anchor" aria-label="anchor" href="#create-a-srtproject-object"></a>
</h3>
<p>First, we show how to create a SRTProject object step by step.</p>
<p>Because the gene name is ensembl in this data, we change the genes’ ensembl name to symbols for convenience of followed analyses. We can see most of ensembl names have been transferred to the symbol names and the genes not transferred are generally not in the variable gene set. Thhus, it does not matter for analyses that there are genes not be transferred.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">count_matrix</span> <span class="op">&lt;-</span> <span class="va">dlpfc_151672</span><span class="op">[[</span><span class="st">"RNA"</span><span class="op">]</span><span class="op">]</span><span class="op">@</span><span class="va">counts</span>
<span class="co">## Use eg.db database: this method is fast</span>
<span class="va">symbol_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/transferGeneNames.html">transferGeneNames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">count_matrix</span><span class="op">)</span>, now_name <span class="op">=</span> <span class="st">"ensembl"</span>, to_name <span class="op">=</span> <span class="st">"symbol"</span>,
    species <span class="op">=</span> <span class="st">"Human"</span>, Method <span class="op">=</span> <span class="st">"eg.db"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">count_matrix</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">symbol_name</span>
<span class="va">symbol_name</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">]</span></code></pre></div>
<pre><code><span class="co">##  [1] "ENSG00000243485" "Fam138a"         "Or4f5"           "Loc100996442"   </span>
<span class="co">##  [5] "ENSG00000239945" "ENSG00000239906" "ENSG00000241599" "ENSG00000236601"</span>
<span class="co">##  [9] "Or4f29"          "ENSG00000235146" "Or4f16"          "ENSG00000229905"</span>
<span class="co">## [13] "Linc01409"       "Fam87b"          "Linc00115"       "Fam41c"         </span>
<span class="co">## [17] "ENSG00000272438" "ENSG00000230699" "ENSG00000241180" "Linc02593"</span></code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## create count matrix list: note each component has a name, i.e., `ID151672`.</span>

<span class="va">cntList</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ID151672 <span class="op">=</span> <span class="va">count_matrix</span><span class="op">)</span>

<span class="co">## create spatial coordinate matrix</span>
<span class="va">coordList</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">dlpfc_151672</span><span class="op">$</span><span class="va">row</span>, <span class="va">dlpfc_151672</span><span class="op">$</span><span class="va">col</span><span class="op">)</span><span class="op">)</span>

<span class="co">## create metadata list</span>
<span class="va">meta.data</span> <span class="op">&lt;-</span> <span class="va">dlpfc_151672</span><span class="op">@</span><span class="va">meta.data</span>
<span class="va">metadataList</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">meta.data</span><span class="op">)</span>

<span class="co">## create meta data for each data batches. Here we only have one data batch.</span>
<span class="va">sampleMetadata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>species <span class="op">=</span> <span class="st">"Human"</span>, tissues <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"DLPFC"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">sampleMetadata</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cntList</span><span class="op">)</span>

<span class="co">## Name of this project</span>
<span class="va">projectName</span> <span class="op">&lt;-</span> <span class="st">"Brain151672"</span>

<span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">dlpfc_151672</span><span class="op">)</span></code></pre></div>
<p>Next, we start creating a SRTProject object. We can print the basic information of this object, including three parts. The first part have the class of this object, outputPath of data that require to be output, h5filePath that saves the memory-cusuming data (i.e., count, logcount, …). The second part is about the datasets basic information, such as how many data batches(sample) and the data names, sample meta data (sampleColData) and meta data for each spot (cellMetaData). The last part is about downstream analyses information (that is empty) when this object created. Quality control is also performed when creating the SRTProject. SRTpipeline allows you to easily explore QC metrics and filter cells based on any user-defined criteria. A few QC metrics <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4758103/" class="external-link">commonly used</a> by the community include * The number of unique genes detected in each cell. + Low-quality cells or empty droplets will often have very few genes + Cell doublets or multiplets may exhibit an aberrantly high gene count * Similarly, the total number of molecules detected within a cell (correlates strongly with unique genes)</p>
<p>In the example below, we visualize QC metrics, and use these to filter cells. * filter out the spots with nonzero expression levels for less than 20 genes. * filter out genes with non-zero expression levels for fewer than 20 spots</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SRTProj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CreateSRTProject.html">CreateSRTProject</a></span><span class="op">(</span><span class="va">cntList</span>, <span class="va">coordList</span>, projectName <span class="op">=</span> <span class="va">projectName</span>, <span class="va">metadataList</span>, <span class="va">sampleMetadata</span>,
    min.spots <span class="op">=</span> <span class="fl">20</span>, min.genes <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>
<span class="va">SRTProj</span></code></pre></div>
<pre><code><span class="co">## class: SRTProject </span>
<span class="co">## outputPath: F:\Research paper\IntegrateDRcluster\AnalysisCode\SRTpipeline\vignettes\Brain151672 </span>
<span class="co">## h5filePath: F:\Research paper\IntegrateDRcluster\AnalysisCode\SRTpipeline\vignettes\Brain151672/Brain151672.h5 </span>
<span class="co">## ---------Datasets basic information-----------------</span>
<span class="co">## samples(1): ID151672</span>
<span class="co">## sampleColData names(3): species tissues NumOfSpots</span>
<span class="co">## cellMetaData names(101): orig.ident nCount_RNA ... r_gc.V7 batch</span>
<span class="co">## numberOfSpots(1): 4015</span>
<span class="co">## ---------Downstream analyses information-----------------</span>
<span class="co">## Low-dimensional embeddings(0):</span>
<span class="co">## Inferred cluster labels: No</span>
<span class="co">## Embedding for plotting(0):</span></code></pre>
</div>
<div class="section level3">
<h3 id="normalizing-the-data">Normalizing the data<a class="anchor" aria-label="anchor" href="#normalizing-the-data"></a>
</h3>
<p>After creating the SRTProject object, the next step is to normalize the data. Normalized values are stored in the h5 file of h5file path.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SRTProj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/normalizeSRT.html">normalizeSRT</a></span><span class="op">(</span><span class="va">SRTProj</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="feature-selection">Feature selection<a class="anchor" aria-label="anchor" href="#feature-selection"></a>
</h3>
<p>We next select a subset of genes that exhibit high spot-to-spot variation in the dataset (i.e, they are highly expressed in some spots, and lowly expressed in others). It has been found that focusing on these genes in downstream analysis helps to highlight biological signal in single-cell datasets <a href="https://www.nature.com/articles/nmeth.2645" class="external-link">here</a>.</p>
<div class="section level4">
<h4 id="choose-spatially-variable-features">Choose spatially variable features<a class="anchor" aria-label="anchor" href="#choose-spatially-variable-features"></a>
</h4>
<p>In the single_basic_tutorial, we introduced using <code>vst</code> to choose the highly vairiable genes. Here, we introduce to apply the SPARK-X to choose the top spatially variable genes (SVGs). By default, we return 2,000 genes per dataset. These will be used in downstream analysis, like probabilistic embeddings and spatial clustering. In the SVGs selection implementation of <code><a href="../reference/selectVariableFeatures.html">selectVariableFeatures()</a></code> function, we first select 5,000 highly variable genes to speed up the computation, then use <code>SPARK-X</code> to choose top SVGs from these 5000 genes. The selected SVGs are saved in <code>SRTProj@geneMetaData$isVGs#combine</code> for followed analysse. In addition, the other columns of <code>SRTProj@geneMetaData</code> save the selected SVGs for each data batch. Because there is only one data batch, <code>SRTProj@geneMetaData$isSVGs#ID151672</code> is equal to <code>SRTProj@geneMetaData$isVGs#combine</code>. The column <code>rankSVGs#ID151672</code> retains the rank of SVGs for the selected top SVGs and ranking first means that it is the most spaitally variable gene.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SRTProj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/selectVariableFeatures.html">selectVariableFeatures</a></span><span class="op">(</span><span class="va">SRTProj</span>, type <span class="op">=</span> <span class="st">"SVGs"</span>, method <span class="op">=</span> <span class="st">"SPARK-X"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">SRTProj</span><span class="op">@</span><span class="va">geneMetaData</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## DataFrame with 6 rows and 3 columns</span>
<span class="co">##           isVGs#combine isSVGs#ID151672 rankSVGs#ID151672</span>
<span class="co">##               &lt;logical&gt;       &lt;logical&gt;         &lt;integer&gt;</span>
<span class="co">## Linc01409         FALSE           FALSE                NA</span>
<span class="co">## Fam41c            FALSE           FALSE                NA</span>
<span class="co">## Noc2l              TRUE            TRUE              1166</span>
<span class="co">## Klhl17            FALSE           FALSE                NA</span>
<span class="co">## Hes4              FALSE           FALSE                NA</span>
<span class="co">## Isg15             FALSE           FALSE                NA</span></code></pre>
<p>Users can access the top SVGs using</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="va">svg4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/topVGs.html">topVGs</a></span><span class="op">(</span><span class="va">SRTProj</span>, ntop <span class="op">=</span> <span class="fl">4</span>, type <span class="op">=</span> <span class="st">"SVGs"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] "Cox2"    "Cox3"    "Nd3"     "Scgb2a2"</span></code></pre>
<p>Visualize the expression of these SVGs on the spatial coordinates.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/EachExprSpaHeatMap.html">EachExprSpaHeatMap</a></span><span class="op">(</span><span class="va">SRTProj</span>, features <span class="op">=</span> <span class="va">svg4</span>, layout.dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="dlpfc_tutorial_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
</div>
<div class="section level4">
<h4 id="choose-highly-variable-features">Choose highly variable features<a class="anchor" aria-label="anchor" href="#choose-highly-variable-features"></a>
</h4>
<p>We can also choose the top highly variable genes (HVGs) using <code><a href="../reference/selectVariableFeatures.html">selectVariableFeatures()</a></code> function. We found the performance of using SVGs or HVGs has no significant difference for the downstream analyses, such as dimension reduction and spatial clustering.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># not run here SRTProj &lt;- selectVariableFeatures(SRTProj, type = 'HVGs', method='vst')</span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="calculate-the-adjcence-matrix">Calculate the adjcence matrix<a class="anchor" aria-label="anchor" href="#calculate-the-adjcence-matrix"></a>
</h3>
<p>Next, we define the neighbors for each spot by the spatial coordinates, which is represented by a sparse adjacency matrix (AdjMat) saved in the h5file. We can check the saved sparse adjacency matrix using <code>h5ls()</code>.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Obtain adjacence matrix</span>
<span class="va">SRTProj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/AddAdj.html">AddAdj</a></span><span class="op">(</span><span class="va">SRTProj</span>, platform <span class="op">=</span> <span class="st">"Visium"</span><span class="op">)</span>
<span class="fu">h5ls</span><span class="op">(</span><span class="va">SRTProj</span><span class="op">@</span><span class="va">projectMetadata</span><span class="op">$</span><span class="va">h5filePath</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##               group           name       otype   dclass      dim</span>
<span class="co">## 0                 /         AdjMat   H5I_GROUP                  </span>
<span class="co">## 1           /AdjMat       AdjMat_1   H5I_GROUP                  </span>
<span class="co">## 2  /AdjMat/AdjMat_1            Dim H5I_DATASET  INTEGER        2</span>
<span class="co">## 3  /AdjMat/AdjMat_1           data H5I_DATASET    FLOAT    23382</span>
<span class="co">## 4  /AdjMat/AdjMat_1        indices H5I_DATASET  INTEGER    23382</span>
<span class="co">## 5  /AdjMat/AdjMat_1         indptr H5I_DATASET  INTEGER     4016</span>
<span class="co">## 6                 /  SpatialCoords H5I_DATASET  INTEGER 4015 x 2</span>
<span class="co">## 7                 /   cellMetaData H5I_DATASET COMPOUND     4015</span>
<span class="co">## 8                 /          count   H5I_GROUP                  </span>
<span class="co">## 9            /count        count_1   H5I_GROUP                  </span>
<span class="co">## 10   /count/count_1            Dim H5I_DATASET  INTEGER        2</span>
<span class="co">## 11   /count/count_1      cellNames H5I_DATASET   STRING     4015</span>
<span class="co">## 12   /count/count_1           data H5I_DATASET    FLOAT  7020250</span>
<span class="co">## 13   /count/count_1      geneNames H5I_DATASET   STRING    14640</span>
<span class="co">## 14   /count/count_1        indices H5I_DATASET  INTEGER  7020250</span>
<span class="co">## 15   /count/count_1         indptr H5I_DATASET  INTEGER     4016</span>
<span class="co">## 16                /           data   H5I_GROUP                  </span>
<span class="co">## 17            /data         data_1   H5I_GROUP                  </span>
<span class="co">## 18     /data/data_1            Dim H5I_DATASET  INTEGER        2</span>
<span class="co">## 19     /data/data_1      cellNames H5I_DATASET   STRING     4015</span>
<span class="co">## 20     /data/data_1           data H5I_DATASET    FLOAT  7020250</span>
<span class="co">## 21     /data/data_1      geneNames H5I_DATASET   STRING    14640</span>
<span class="co">## 22     /data/data_1        indices H5I_DATASET  INTEGER  7020250</span>
<span class="co">## 23     /data/data_1         indptr H5I_DATASET  INTEGER     4016</span>
<span class="co">## 24                / sampleMetadata H5I_DATASET COMPOUND        1</span>
<span class="co">## 25                /    samplenames H5I_DATASET   STRING        1</span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="joint-embedding-and-spatial-clustering">Joint embedding and spatial clustering<a class="anchor" aria-label="anchor" href="#joint-embedding-and-spatial-clustering"></a>
</h2>
<p>We fit the <code>DR-SC</code> model by using the top 2000 SVGs. Users can also use the top HVGs but we found the performance of using SVGs or HVGs has no significant difference for the downstream analyses, such as dimension reduction and spatial clustering. Here, we specify the number of clusters as 5, while <code>DR.SC</code> can also select the number of clusters given a integer vector for argument <span class="math inline">\(K\)</span>.</p>
<p>Afeter finishing joint dimension reduction and spatial clustering, the SRTProject <code>SRTProj</code> has two more downstream analyses information: the low-dimensional embeddings DR.SC and inferred cluster labels, and they are saved in <code>SRTProj@reductions$DR.SC</code> and <code>SRTProj@clusters</code>, respectively.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">### Given K</span>
<span class="va">SRTProj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Cluster_DRSC.html">Cluster_DRSC</a></span><span class="op">(</span><span class="va">SRTProj</span>, K <span class="op">=</span> <span class="fl">5</span>, q <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## iter = 2, loglik= 1346600.865533, dloglik=1.000627 </span>
<span class="co">## iter = 3, loglik= 1353742.641148, dloglik=0.005304 </span>
<span class="co">## iter = 4, loglik= 1355990.232665, dloglik=0.001660 </span>
<span class="co">## iter = 5, loglik= 1357192.177017, dloglik=0.000886 </span>
<span class="co">## iter = 6, loglik= 1357939.843319, dloglik=0.000551 </span>
<span class="co">## iter = 7, loglik= 1358452.521599, dloglik=0.000378 </span>
<span class="co">## iter = 8, loglik= 1358819.052312, dloglik=0.000270 </span>
<span class="co">## iter = 9, loglik= 1359093.534920, dloglik=0.000202 </span>
<span class="co">## iter = 10, loglik= 1359293.614632, dloglik=0.000147 </span>
<span class="co">## iter = 11, loglik= 1359451.564390, dloglik=0.000116 </span>
<span class="co">## iter = 12, loglik= 1359583.561794, dloglik=0.000097 </span>
<span class="co">## iter = 13, loglik= 1359707.432431, dloglik=0.000091 </span>
<span class="co">## iter = 14, loglik= 1359812.895814, dloglik=0.000078 </span>
<span class="co">## iter = 15, loglik= 1359905.985216, dloglik=0.000068 </span>
<span class="co">## iter = 16, loglik= 1359989.190665, dloglik=0.000061 </span>
<span class="co">## iter = 17, loglik= 1360054.345686, dloglik=0.000048 </span>
<span class="co">## iter = 18, loglik= 1360111.166494, dloglik=0.000042 </span>
<span class="co">## iter = 19, loglik= 1360162.761811, dloglik=0.000038 </span>
<span class="co">## iter = 20, loglik= 1360207.532071, dloglik=0.000033 </span>
<span class="co">## iter = 21, loglik= 1360251.634221, dloglik=0.000032 </span>
<span class="co">## iter = 22, loglik= 1360290.376774, dloglik=0.000028 </span>
<span class="co">## iter = 23, loglik= 1360324.640829, dloglik=0.000025 </span>
<span class="co">## iter = 24, loglik= 1360363.241937, dloglik=0.000028 </span>
<span class="co">## iter = 25, loglik= 1360395.307944, dloglik=0.000024</span></code></pre>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SRTProj</span></code></pre></div>
<pre><code><span class="co">## class: SRTProject </span>
<span class="co">## outputPath: F:\Research paper\IntegrateDRcluster\AnalysisCode\SRTpipeline\vignettes\Brain151672 </span>
<span class="co">## h5filePath: F:\Research paper\IntegrateDRcluster\AnalysisCode\SRTpipeline\vignettes\Brain151672/Brain151672.h5 </span>
<span class="co">## ---------Datasets basic information-----------------</span>
<span class="co">## samples(1): ID151672</span>
<span class="co">## sampleColData names(3): species tissues NumOfSpots</span>
<span class="co">## cellMetaData names(101): orig.ident nCount_RNA ... r_gc.V7 batch</span>
<span class="co">## numberOfSpots(1): 4015</span>
<span class="co">## ---------Downstream analyses information-----------------</span>
<span class="co">## Variable features:  2000 </span>
<span class="co">## Low-dimensional embeddings(1): DR.SC</span>
<span class="co">## Inferred cluster labels: Yes</span>
<span class="co">## Embedding for plotting(0):</span></code></pre>
</div>
<div class="section level2">
<h2 id="visualization">Visualization<a class="anchor" aria-label="anchor" href="#visualization"></a>
</h2>
<p><code>SRTpipeline</code> package oﬀers a variety of visualization tools. To run tSNE in SRTpipeline we use the <code><a href="../reference/AddTSNE.html">AddTSNE()</a></code> function:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SRTProj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/AddTSNE.html">AddTSNE</a></span><span class="op">(</span><span class="va">SRTProj</span>, n_comp <span class="op">=</span> <span class="fl">2</span>, reduction <span class="op">=</span> <span class="st">"DR.SC"</span><span class="op">)</span></code></pre></div>
<p>The <code>reduction</code> tells <code><a href="../reference/AddTSNE.html">AddTSNE()</a></code> function uses specified reduction in the <code>SRTProj@reductions</code> slot to calculate tSNE embeddings.</p>
<p>To plot the two-dimensional tSNE results, we use the <code><a href="../reference/EmbedPlot.html">EmbedPlot()</a></code> function and pass the name of the tSNE embedding we just generated (“tSNE”). We can tell SRTpipeline how to color the spots by using <code>item</code> argument which tells SRTpipeline which data to use to find the specified metadata column provided to name. The data are from two sources: <code>SRTProj@clusters</code> or <code>SRTProj@cellMetaData</code>. In particular, <code>item='cluster'</code> means using <code>SRTProj@clusters</code> for coloring.</p>
<p>We visualized the inferred domain types on embeddings using two components from tSNE. The tSNE plot showed the domain clusters were well segregated.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cols_cluster</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/chooseColors.html">chooseColors</a></span><span class="op">(</span>n_colors <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>
<span class="va">p_tsne2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/EmbedPlot.html">EmbedPlot</a></span><span class="op">(</span><span class="va">SRTProj</span>, item <span class="op">=</span> <span class="st">"cluster"</span>, plotEmbeddings <span class="op">=</span> <span class="st">"tSNE"</span>, cols <span class="op">=</span> <span class="va">cols_cluster</span>, legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span>
<span class="va">p_tsne2</span></code></pre></div>
<p><img src="dlpfc_tutorial_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
<p>To run UMAP in SRTpipeline we use the <code><a href="../reference/AddUMAP.html">AddUMAP()</a></code> function. Frist, we evaluate the two-dimensional UMAPs.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SRTProj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/AddUMAP.html">AddUMAP</a></span><span class="op">(</span><span class="va">SRTProj</span>, n_comp <span class="op">=</span> <span class="fl">2</span>, reduction <span class="op">=</span> <span class="st">"DR.SC"</span><span class="op">)</span>
<span class="va">p_umap2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/EmbedPlot.html">EmbedPlot</a></span><span class="op">(</span><span class="va">SRTProj</span>, item <span class="op">=</span> <span class="st">"cluster"</span>, plotEmbeddings <span class="op">=</span> <span class="st">"UMAP"</span>, cols <span class="op">=</span> <span class="va">cols_cluster</span>, legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span>
<span class="va">p_umap2</span></code></pre></div>
<p><img src="dlpfc_tutorial_files/figure-html/unnamed-chunk-14-1.png" width="700"></p>
<p>Next, we merge all plots into one figure.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/drawFigs.html">drawFigs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">p_tsne2</span>, <span class="va">p_umap2</span><span class="op">)</span>, layout.dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, common.legend <span class="op">=</span> <span class="cn">TRUE</span>, legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></code></pre></div>
<p><img src="dlpfc_tutorial_files/figure-html/unnamed-chunk-15-1.png" width="700"></p>
<p>Calculate the 3-dimensional tSNEs based on the extracted features from DR-SC.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SRTProj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/AddTSNE.html">AddTSNE</a></span><span class="op">(</span><span class="va">SRTProj</span>, n_comp <span class="op">=</span> <span class="fl">3</span>, reduction <span class="op">=</span> <span class="st">"DR.SC"</span><span class="op">)</span></code></pre></div>
<p>We visualize the 3-dimensional tSNEs on the spatial coordinates using RGB colors. We can see there are apparent spatial pattern for the embeddings. Users can also plot the 3-dimensional UMAP RGB plot similarly.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/EachRGBSpaHeatMap.html">EachRGBSpaHeatMap</a></span><span class="op">(</span><span class="va">SRTProj</span>, plot_type <span class="op">=</span> <span class="st">"tSNE"</span>, title_name <span class="op">=</span> <span class="st">"tSNE RGB plot: "</span><span class="op">)</span></code></pre></div>
<p><img src="dlpfc_tutorial_files/figure-html/unnamed-chunk-17-1.png" width="700"> Then, we visualize the spatial distribution of cluster labels that shows the layer structure.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/EachClusterSpaHeatMap.html">EachClusterSpaHeatMap</a></span><span class="op">(</span><span class="va">SRTProj</span>, cols <span class="op">=</span> <span class="va">cols_cluster</span>, legend.position <span class="op">=</span> <span class="st">"right"</span>, base_size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span></code></pre></div>
<p><img src="dlpfc_tutorial_files/figure-html/unnamed-chunk-18-1.png" width="700"></p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># remove the border EachClusterSpaHeatMap(SRTProj, cols=cols_cluster,</span>
<span class="co"># legend.position='right',base_size=16, border_col='white')</span></code></pre></div>
<p>We plotted the heatmap of Pearson’s correlation coefcients of the DR.SC embeddings among the detected domains shows the good separation of the estimated embeddings across domains (high values in the diagnal) and the correlations between deeper layers were high, e.g., there were high correlations between domain 2 and 3, while correlations among the separated layers were low, i.e., domain 1 and 4.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/CCHeatMap.html">CCHeatMap</a></span><span class="op">(</span><span class="va">SRTProj</span>, reduction <span class="op">=</span> <span class="st">"DR.SC"</span>, grp_color <span class="op">=</span> <span class="va">cols_cluster</span><span class="op">)</span></code></pre></div>
<p><img src="dlpfc_tutorial_files/figure-html/unnamed-chunk-19-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="deg-analysis">DEG analysis<a class="anchor" aria-label="anchor" href="#deg-analysis"></a>
</h2>
<p>To do downstream analyses, we require to get the count data from h5file. The function <code><a href="../reference/getGeneSpotData.html">getGeneSpotData()</a></code> access the gene-by-spot count matrix and other data in <code>SRTProj</code> and then return a <code>SpatialExperiment</code> object, including two assays: counts, logcounts; rowData: from <code>SRTProj@geneMetaData</code>; colData: from <code>SRTProj@cellMetaData</code>, <code>SRTProj@clusters</code> and sample_id; reducedDim: from <code>SRTProj@reductions</code>, <code>SRTProj@plotEmbeddings</code> and sptial coordinates <code>Coord</code>.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">spe</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getGeneSpotData.html">getGeneSpotData</a></span><span class="op">(</span><span class="va">SRTProj</span><span class="op">)</span>
<span class="va">spe</span></code></pre></div>
<pre><code><span class="co">## class: SpatialExperiment </span>
<span class="co">## dim: 14640 4015 </span>
<span class="co">## metadata(0):</span>
<span class="co">## assays(2): counts logcounts</span>
<span class="co">## rownames(14640): Linc01409 Fam41c ... Loc102724770 Loc102724788</span>
<span class="co">## rowData names(3): isVGs.combine isSVGs.ID151672 rankSVGs.ID151672</span>
<span class="co">## colnames(4015): ID151672#AAACAAGTATCTCCCA-1 ID151672#AAACACCAATAACTGC-1</span>
<span class="co">##   ... ID151672#TTGTTTCCATACAACT-1 ID151672#TTGTTTGTGTAAATTC-1</span>
<span class="co">## colData names(103): orig.ident nCount_RNA ... clusters sample_id</span>
<span class="co">## reducedDimNames(5): DR.SC tSNE UMAP tSNE3 Coord</span>
<span class="co">## mainExpName: NULL</span>
<span class="co">## altExpNames(0):</span>
<span class="co">## spatialData names(0) :</span>
<span class="co">## spatialCoords names(2) : V1 V2</span>
<span class="co">## imgData names(0):</span></code></pre>
<p>After fitting DR-SC model, we can perform differentially expression analysis using the spatial cluster labels. First, we detect the DE genes for cluster 1, where the argument <code>use_cluster</code> tells <code><a href="../reference/FindDEGs.html">FindDEGs()</a></code> uses which colname name in the <code>colData(spe)</code> to do DEG analysis.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dat_deg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/FindDEGs.html">FindDEGs</a></span><span class="op">(</span><span class="va">spe</span>, cluster1 <span class="op">=</span> <span class="st">"1"</span>, use_cluster <span class="op">=</span> <span class="st">"clusters"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">dat_deg</span>, <span class="va">avg_log2FC</span> <span class="op">&gt;</span> <span class="fl">0.25</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## DataFrame with 28 rows and 5 columns</span>
<span class="co">##               p_val avg_log2FC     pct.1     pct.2   p_val_adj</span>
<span class="co">##           &lt;numeric&gt;  &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;   &lt;numeric&gt;</span>
<span class="co">## Krt17   9.02022e-82   0.417970     0.372     0.098 1.32056e-77</span>
<span class="co">## B3galt2 2.26542e-73   0.410571     0.393     0.122 3.31657e-69</span>
<span class="co">## Diras2  6.08970e-71   0.447130     0.753     0.438 8.91531e-67</span>
<span class="co">## Themis  1.86657e-68   0.255048     0.196     0.029 2.73266e-64</span>
<span class="co">## Gng2    4.53119e-62   0.396148     0.459     0.176 6.63366e-58</span>
<span class="co">## ...             ...        ...       ...       ...         ...</span>
<span class="co">## Atp2b1  2.56436e-29   0.263823     0.726     0.538 3.75422e-25</span>
<span class="co">## Ppp3cb  3.74670e-28   0.265756     0.754     0.552 5.48517e-24</span>
<span class="co">## Cldnd1  1.68506e-26   0.269192     0.586     0.366 2.46692e-22</span>
<span class="co">## Mobp    1.78231e-25   0.253856     0.436     0.241 2.60930e-21</span>
<span class="co">## Lmo3    1.06723e-23   0.252268     0.647     0.448 1.56242e-19</span></code></pre>
<p>We perform differential expression analysis for all clusters by using <code><a href="../reference/FindAllDEGs.html">FindAllDEGs()</a></code> function, then the DE genes’ information is saved in a <code>DataFrame</code> object <code>dat_degs</code>.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dat_degs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/FindAllDEGs.html">FindAllDEGs</a></span><span class="op">(</span><span class="va">spe</span>, use_cluster <span class="op">=</span> <span class="st">"clusters"</span><span class="op">)</span>
<span class="va">dat_degs</span></code></pre></div>
<pre><code><span class="co">## DataFrame with 1753 rows and 7 columns</span>
<span class="co">##               p_val avg_log2FC     pct.1     pct.2   p_val_adj  cluster</span>
<span class="co">##           &lt;numeric&gt;  &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;   &lt;numeric&gt; &lt;factor&gt;</span>
<span class="co">## Krt17   9.02022e-82   0.417970     0.372     0.098 1.32056e-77        1</span>
<span class="co">## B3galt2 2.26542e-73   0.410571     0.393     0.122 3.31657e-69        1</span>
<span class="co">## Diras2  6.08970e-71   0.447130     0.753     0.438 8.91531e-67        1</span>
<span class="co">## Themis  1.86657e-68   0.255048     0.196     0.029 2.73266e-64        1</span>
<span class="co">## Gng2    4.53119e-62   0.396148     0.459     0.176 6.63366e-58        1</span>
<span class="co">## ...             ...        ...       ...       ...         ...      ...</span>
<span class="co">## Ppia     0.00198200  -0.271143     0.676     0.980           1        5</span>
<span class="co">## Rpl15    0.00277155  -0.257737     0.515     0.921           1        5</span>
<span class="co">## Agr3     0.00334172   0.255815     0.133     0.100           1        5</span>
<span class="co">## Mobp.2   0.00455818   0.295763     0.273     0.279           1        5</span>
<span class="co">## Sparc    0.00563869   0.309654     0.254     0.254           1        5</span>
<span class="co">##                gene</span>
<span class="co">##         &lt;character&gt;</span>
<span class="co">## Krt17         Krt17</span>
<span class="co">## B3galt2     B3galt2</span>
<span class="co">## Diras2       Diras2</span>
<span class="co">## Themis       Themis</span>
<span class="co">## Gng2           Gng2</span>
<span class="co">## ...             ...</span>
<span class="co">## Ppia           Ppia</span>
<span class="co">## Rpl15         Rpl15</span>
<span class="co">## Agr3           Agr3</span>
<span class="co">## Mobp.2         Mobp</span>
<span class="co">## Sparc         Sparc</span></code></pre>
<p>We identify the significant DE genes by two criteria: (a) adjustd p-value less than 0.01 and (b) average log fold change greater than 0.4.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">degs_sig</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">dat_degs</span>, <span class="va">p_val_adj</span> <span class="op">&lt;</span> <span class="fl">0.01</span> <span class="op">&amp;</span> <span class="va">avg_log2FC</span> <span class="op">&gt;</span> <span class="fl">0.4</span><span class="op">)</span>
<span class="va">degs_sig</span></code></pre></div>
<pre><code><span class="co">## DataFrame with 21 rows and 7 columns</span>
<span class="co">##                p_val avg_log2FC     pct.1     pct.2    p_val_adj  cluster</span>
<span class="co">##            &lt;numeric&gt;  &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;    &lt;numeric&gt; &lt;factor&gt;</span>
<span class="co">## Krt17    9.02022e-82   0.417970     0.372     0.098  1.32056e-77        1</span>
<span class="co">## B3galt2  2.26542e-73   0.410571     0.393     0.122  3.31657e-69        1</span>
<span class="co">## Diras2   6.08970e-71   0.447130     0.753     0.438  8.91531e-67        1</span>
<span class="co">## Pcp4    1.08424e-170   0.677584     0.716     0.238 1.58732e-166        3</span>
<span class="co">## Fabp4    3.78837e-72   0.526506     0.400     0.132  5.54618e-68        4</span>
<span class="co">## ...              ...        ...       ...       ...          ...      ...</span>
<span class="co">## Col1a1   1.31392e-16   0.531997     0.298     0.182  1.92358e-12        5</span>
<span class="co">## Col1a2   1.56491e-14   0.500862     0.261     0.153  2.29103e-10        5</span>
<span class="co">## Krt18.1  3.10583e-12   0.512108     0.340     0.265  4.54694e-08        5</span>
<span class="co">## Azgp1.1  1.72231e-08   0.443223     0.277     0.214  2.52146e-04        5</span>
<span class="co">## Nupr1.1  5.20265e-08   0.442259     0.303     0.254  7.61669e-04        5</span>
<span class="co">##                gene</span>
<span class="co">##         &lt;character&gt;</span>
<span class="co">## Krt17         Krt17</span>
<span class="co">## B3galt2     B3galt2</span>
<span class="co">## Diras2       Diras2</span>
<span class="co">## Pcp4           Pcp4</span>
<span class="co">## Fabp4         Fabp4</span>
<span class="co">## ...             ...</span>
<span class="co">## Col1a1       Col1a1</span>
<span class="co">## Col1a2       Col1a2</span>
<span class="co">## Krt18.1       Krt18</span>
<span class="co">## Azgp1.1       Azgp1</span>
<span class="co">## Nupr1.1       Nupr1</span></code></pre>
<p>In the following, we perform gene set enrichment analysis for the DE genes of each Domain identified by DR-SC model using R package <code>gprofiler2</code>.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">gprofiler2</span><span class="op">)</span>
<span class="va">termList</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span> <span class="op">{</span>
    <span class="co"># k &lt;- 1</span>
    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"k = "</span>, <span class="va">k</span>, <span class="st">"\n"</span><span class="op">)</span>
    <span class="va">dat_degs_sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">degs_sig</span>, <span class="va">cluster</span> <span class="op">==</span> <span class="va">k</span><span class="op">)</span>
    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">dat_degs_sub</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span>
        <span class="kw">next</span>
    <span class="va">que1</span> <span class="op">&lt;-</span> <span class="va">dat_degs_sub</span><span class="op">$</span><span class="va">gene</span>
    <span class="va">gostres</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/gprofiler2/man/gost.html" class="external-link">gost</a></span><span class="op">(</span>query <span class="op">=</span> <span class="va">que1</span>, organism <span class="op">=</span> <span class="st">"hsapiens"</span>, correction_method <span class="op">=</span> <span class="st">"fdr"</span><span class="op">)</span>
    <span class="va">termList</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">gostres</span>
<span class="op">}</span></code></pre></div>
<pre><code><span class="co">## k =  1 </span>
<span class="co">## k =  2 </span>
<span class="co">## k =  3 </span>
<span class="co">## k =  4 </span>
<span class="co">## k =  5</span></code></pre>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">termList</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">result</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##     query significant    p_value term_size query_size intersection_size</span>
<span class="co">## 1 query_1        TRUE 0.03230485         7          3                 1</span>
<span class="co">## 2 query_1        TRUE 0.03230485         6          3                 1</span>
<span class="co">## 3 query_1        TRUE 0.03230485         7          3                 1</span>
<span class="co">## 4 query_1        TRUE 0.03230485         6          3                 1</span>
<span class="co">## 5 query_1        TRUE 0.03230485         8          3                 1</span>
<span class="co">## 6 query_1        TRUE 0.04037340        12          3                 1</span>
<span class="co">##   precision     recall    term_id source</span>
<span class="co">## 1 0.3333333 0.14285714 GO:0006681  GO:BP</span>
<span class="co">## 2 0.3333333 0.16666667 GO:0006682  GO:BP</span>
<span class="co">## 3 0.3333333 0.14285714 GO:0019374  GO:BP</span>
<span class="co">## 4 0.3333333 0.16666667 GO:0019375  GO:BP</span>
<span class="co">## 5 0.3333333 0.12500000 GO:0046476  GO:BP</span>
<span class="co">## 6 0.3333333 0.08333333 GO:0051798  GO:BP</span>
<span class="co">##                                          term_name effective_domain_size</span>
<span class="co">## 1             galactosylceramide metabolic process                 21092</span>
<span class="co">## 2          galactosylceramide biosynthetic process                 21092</span>
<span class="co">## 3                   galactolipid metabolic process                 21092</span>
<span class="co">## 4                galactolipid biosynthetic process                 21092</span>
<span class="co">## 5            glycosylceramide biosynthetic process                 21092</span>
<span class="co">## 6 positive regulation of hair follicle development                 21092</span>
<span class="co">##   source_order                                        parents</span>
<span class="co">## 1         2645                         GO:0006677, GO:0019374</span>
<span class="co">## 2         2646             GO:0006681, GO:0019375, GO:0046476</span>
<span class="co">## 3         6609                                     GO:0006664</span>
<span class="co">## 4         6610                         GO:0009247, GO:0019374</span>
<span class="co">## 5        14135             GO:0006677, GO:0006688, GO:0046513</span>
<span class="co">## 6        16083 GO:0001942, GO:0051094, GO:0051240, GO:0051797</span></code></pre>
<p>To understand the functions of the identified spatial domains by DR-SC model, we compare the top significant biological process (BP) pathways in GO database for the DE genes from Domain 1 and 3. Here, we only show to visualize the significant BP pathways and users can explore the other databases such as KEGG and HPA.</p>
<p>The enrichment analysis shows that genes specific to Domain 1 were highly enriched for galactosylceramide metabolic process, galactosylceramide biosynthetic process and galactolipid metabolic process, which may indicate the cells in Domain 1 play an important role to achieve these functions. The genes specific to Domain 4 were highly enriched for negative regulation of response to external stimulus and negative regulation of response to extracellular stimulus.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Most commonly used databases</span>
<span class="va">source_set</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"GO:BP"</span>, <span class="st">"GO:CC"</span>, <span class="st">"GO:MF"</span>, <span class="st">"KEGG"</span>, <span class="st">"HPA"</span><span class="op">)</span>
<span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"steelblue3"</span>, <span class="st">"goldenrod"</span>, <span class="st">"brown3"</span>, <span class="st">"#f98866"</span>, <span class="st">"#CE6DBD"</span><span class="op">)</span>
<span class="co">## Here, we show GO:BP</span>
<span class="va">source1</span> <span class="op">&lt;-</span> <span class="st">"GO:BP"</span>
<span class="va">ss</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">source_set</span> <span class="op">==</span> <span class="va">source1</span><span class="op">)</span>
<span class="va">ntop</span> <span class="op">=</span> <span class="fl">5</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cols</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">source_set</span>
<span class="va">pList_enrich</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">ii</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span> <span class="op">{</span>
    <span class="co">## ii &lt;- 4</span>
    <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"ii="</span>, <span class="va">ii</span><span class="op">)</span>
    <span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">termList</span><span class="op">[[</span><span class="va">ii</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">result</span>
    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
        <span class="va">dat1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">dat</span>, <span class="va">term_size</span> <span class="op">&lt;</span> <span class="fl">500</span><span class="op">)</span>
        <span class="va">dat1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_top_pathway.html">get_top_pathway</a></span><span class="op">(</span><span class="va">dat1</span>, ntop <span class="op">=</span> <span class="va">ntop</span>, source_set <span class="op">=</span> <span class="va">source1</span><span class="op">)</span>
        <span class="va">dat1</span> <span class="op">&lt;-</span> <span class="va">dat1</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html" class="external-link">complete.cases</a></span><span class="op">(</span><span class="va">dat1</span><span class="op">)</span>, <span class="op">]</span>
        <span class="va">dat1</span><span class="op">$</span><span class="va">nlog10P</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">dat1</span><span class="op">$</span><span class="va">p_value</span><span class="op">)</span>

        <span class="va">pList_enrich</span><span class="op">[[</span><span class="va">ii</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/barPlot_enrich.html">barPlot_enrich</a></span><span class="op">(</span><span class="va">dat1</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">dat1</span><span class="op">$</span><span class="va">nlog10P</span><span class="op">)</span>, <span class="op">]</span>, source <span class="op">=</span> <span class="st">"source"</span>, <span class="st">"term_name"</span>,
            <span class="st">"nlog10P"</span>, cols <span class="op">=</span> <span class="va">cols</span><span class="op">[</span><span class="va">source_set</span><span class="op">[</span><span class="va">ss</span><span class="op">]</span><span class="op">]</span>, base_size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ylab</span><span class="op">(</span><span class="st">"-log10(p-adj)"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">xlab</span><span class="op">(</span><span class="st">"Biological terms"</span><span class="op">)</span> <span class="op">+</span>
            <span class="fu">ggtitle</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Domain"</span>, <span class="va">ii</span><span class="op">)</span><span class="op">)</span>
    <span class="op">}</span>

<span class="op">}</span>

<span class="fu"><a href="../reference/drawFigs.html">drawFigs</a></span><span class="op">(</span><span class="va">pList_enrich</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span><span class="op">]</span>, common.legend <span class="op">=</span> <span class="cn">T</span>, layout.dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span>, align <span class="op">=</span> <span class="st">"hv"</span><span class="op">)</span></code></pre></div>
<p><img src="dlpfc_tutorial_files/figure-html/unnamed-chunk-25-1.png" width="700"></p>
<p>We take out the top DE genes for each cluster for visualization.</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>
<span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">1</span>
<span class="va">dat_degs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="va">as.data.frame</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">cluster</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/top_n.html" class="external-link">top_n</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, wt <span class="op">=</span> <span class="va">avg_log2FC</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">topGene</span>
<span class="va">topGene</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 5 x 7</span></span>
<span class="co">## <span style="color: #949494;"># Groups:   cluster [5]</span></span>
<span class="co">##       p_val avg_log2FC pct.1 pct.2 p_val_adj cluster gene   </span>
<span class="co">##       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  </span>
<span class="co">## <span style="color: #BCBCBC;">1</span> 6.09<span style="color: #949494;">e</span><span style="color: #BB0000;">- 71</span>      0.447 0.753 0.438 8.92<span style="color: #949494;">e</span><span style="color: #BB0000;">- 67</span> 1       Diras2 </span>
<span class="co">## <span style="color: #BCBCBC;">2</span> 1.06<span style="color: #949494;">e</span><span style="color: #BB0000;">- 54</span>      0.340 0.658 0.45  1.56<span style="color: #949494;">e</span><span style="color: #BB0000;">- 50</span> 2       Scn1b  </span>
<span class="co">## <span style="color: #BCBCBC;">3</span> 1.08<span style="color: #949494;">e</span><span style="color: #BB0000;">-170</span>      0.678 0.716 0.238 1.59<span style="color: #949494;">e</span><span style="color: #BB0000;">-166</span> 3       Pcp4   </span>
<span class="co">## <span style="color: #BCBCBC;">4</span> 3.79<span style="color: #949494;">e</span><span style="color: #BB0000;">- 72</span>      0.527 0.4   0.132 5.55<span style="color: #949494;">e</span><span style="color: #BB0000;">- 68</span> 4       Fabp4  </span>
<span class="co">## <span style="color: #BCBCBC;">5</span> 1.09<span style="color: #949494;">e</span><span style="color: #BB0000;">-141</span>      0.861 0.925 0.68  1.59<span style="color: #949494;">e</span><span style="color: #BB0000;">-137</span> 5       Scgb2a2</span></code></pre>
<p>Then we plot the volin plot of logcount expressions grouped by clusters, which suggests the marker gene has higher expression in the corresponding cluster.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://bioconductor.org/packages/scater/" class="external-link">scater</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/scater/man/plotExpression.html" class="external-link">plotExpression</a></span><span class="op">(</span><span class="va">spe</span>, features <span class="op">=</span> <span class="va">topGene</span><span class="op">$</span><span class="va">gene</span>, x <span class="op">=</span> <span class="st">"clusters"</span>, exprs_values <span class="op">=</span> <span class="st">"logcounts"</span>, colour_by <span class="op">=</span> <span class="st">"clusters"</span><span class="op">)</span></code></pre></div>
<p><img src="dlpfc_tutorial_files/figure-html/unnamed-chunk-27-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="trajectory-inference">Trajectory inference<a class="anchor" aria-label="anchor" href="#trajectory-inference"></a>
</h2>
<p>Next, we performed trajectory inference using the embeddings and domain labels jointly estimated by DR.SC model. The <code><a href="../reference/EmbedPlot.html">EmbedPlot()</a></code> function can be used to visualize the inferred pseudotime on a specified embedding. If there is only one data batch, the function <code><a href="../reference/EachEmbedPlot.html">EachEmbedPlot()</a></code> plays the same role as function <code><a href="../reference/EmbedPlot.html">EmbedPlot()</a></code>.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">spe</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/AddTrajectory.html">AddTrajectory</a></span><span class="op">(</span><span class="va">spe</span>, reduction <span class="op">=</span> <span class="st">"DR.SC"</span>, name <span class="op">=</span> <span class="st">"PT"</span><span class="op">)</span>
<span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/EmbedPlot.html">EmbedPlot</a></span><span class="op">(</span><span class="va">spe</span>, reduction <span class="op">=</span> <span class="st">"DR.SC"</span>, colour_by <span class="op">=</span> <span class="st">"PT"</span><span class="op">)</span>
<span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/EmbedPlot.html">EmbedPlot</a></span><span class="op">(</span><span class="va">spe</span>, reduction <span class="op">=</span> <span class="st">"Coord"</span>, colour_by <span class="op">=</span> <span class="st">"PT"</span><span class="op">)</span>
<span class="fu"><a href="../reference/drawFigs.html">drawFigs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span><span class="op">)</span>, layout.dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, common.legend <span class="op">=</span> <span class="cn">TRUE</span>, legend.position <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span></code></pre></div>
<p><img src="dlpfc_tutorial_files/figure-html/unnamed-chunk-28-1.png" width="700"></p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># save(spe, SRTProj, file=paste0(SRTProj@projectMetadata$outputPath,'/SRTProj.rds'))</span>
<span class="co"># load('F:/Research</span>
<span class="co"># paper/IntegrateDRcluster/AnalysisCode/SRTpipeline/vignettes/DLPFC151672/SRTProj.rds')</span></code></pre></div>
<details><p><summary><strong>Session Info</strong></summary></p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## R version 4.1.2 (2021-11-01)</span>
<span class="co">## Platform: x86_64-w64-mingw32/x64 (64-bit)</span>
<span class="co">## Running under: Windows 10 x64 (build 22621)</span>
<span class="co">## </span>
<span class="co">## Matrix products: default</span>
<span class="co">## </span>
<span class="co">## locale:</span>
<span class="co">## [1] LC_COLLATE=Chinese (Simplified)_China.936 </span>
<span class="co">## [2] LC_CTYPE=Chinese (Simplified)_China.936   </span>
<span class="co">## [3] LC_MONETARY=Chinese (Simplified)_China.936</span>
<span class="co">## [4] LC_NUMERIC=C                              </span>
<span class="co">## [5] LC_TIME=Chinese (Simplified)_China.936    </span>
<span class="co">## </span>
<span class="co">## attached base packages:</span>
<span class="co">## [1] stats4    stats     graphics  grDevices utils     datasets  methods  </span>
<span class="co">## [8] base     </span>
<span class="co">## </span>
<span class="co">## other attached packages:</span>
<span class="co">##  [1] slingshot_2.2.0             TrajectoryUtils_1.2.0      </span>
<span class="co">##  [3] princurve_2.1.6             scater_1.25.1              </span>
<span class="co">##  [5] scuttle_1.4.0               gprofiler2_0.2.1           </span>
<span class="co">##  [7] SpatialExperiment_1.4.0     SingleCellExperiment_1.16.0</span>
<span class="co">##  [9] SummarizedExperiment_1.24.0 GenomicRanges_1.46.1       </span>
<span class="co">## [11] GenomeInfoDb_1.30.1         MatrixGenerics_1.6.0       </span>
<span class="co">## [13] matrixStats_0.62.0          colorspace_2.0-3           </span>
<span class="co">## [15] ggplot2_3.3.6               dplyr_1.0.9                </span>
<span class="co">## [17] Matrix_1.4-0                sp_1.5-0                   </span>
<span class="co">## [19] SeuratObject_4.1.0          Seurat_4.1.1               </span>
<span class="co">## [21] hdf5r_1.3.5                 ff_4.0.7                   </span>
<span class="co">## [23] bit_4.0.4                   rhdf5_2.38.0               </span>
<span class="co">## [25] org.Hs.eg.db_3.14.0         AnnotationDbi_1.56.2       </span>
<span class="co">## [27] IRanges_2.28.0              S4Vectors_0.32.3           </span>
<span class="co">## [29] Biobase_2.54.0              BiocGenerics_0.40.0        </span>
<span class="co">## [31] SRTpipeline_0.1.1          </span>
<span class="co">## </span>
<span class="co">## loaded via a namespace (and not attached):</span>
<span class="co">##   [1] scattermore_0.8           ggthemes_4.2.4           </span>
<span class="co">##   [3] R.methodsS3_1.8.1         GiRaF_1.0.1              </span>
<span class="co">##   [5] ragg_1.2.2                tidyr_1.2.0              </span>
<span class="co">##   [7] bit64_4.0.5               knitr_1.37               </span>
<span class="co">##   [9] R.utils_2.11.0            irlba_2.3.5              </span>
<span class="co">##  [11] DelayedArray_0.20.0       data.table_1.14.2        </span>
<span class="co">##  [13] rpart_4.1.16              KEGGREST_1.34.0          </span>
<span class="co">##  [15] RCurl_1.98-1.6            generics_0.1.2           </span>
<span class="co">##  [17] ScaledMatrix_1.2.0        cowplot_1.1.1            </span>
<span class="co">##  [19] RSQLite_2.2.10            RANN_2.6.1               </span>
<span class="co">##  [21] future_1.26.1             spatstat.data_3.0-0      </span>
<span class="co">##  [23] httpuv_1.6.5              assertthat_0.2.1         </span>
<span class="co">##  [25] viridis_0.6.2             xfun_0.29                </span>
<span class="co">##  [27] jquerylib_0.1.4           evaluate_0.15            </span>
<span class="co">##  [29] promises_1.2.0.1          fansi_1.0.3              </span>
<span class="co">##  [31] igraph_1.3.5              DBI_1.1.2                </span>
<span class="co">##  [33] htmlwidgets_1.5.4         spatstat.geom_2.4-0      </span>
<span class="co">##  [35] purrr_0.3.4               ellipsis_0.3.2           </span>
<span class="co">##  [37] RSpectra_0.16-1           ggpubr_0.4.0             </span>
<span class="co">##  [39] backports_1.4.1           DR.SC_3.1                </span>
<span class="co">##  [41] deldir_1.0-6              sparseMatrixStats_1.6.0  </span>
<span class="co">##  [43] vctrs_0.4.1               ROCR_1.0-11              </span>
<span class="co">##  [45] abind_1.4-5               cachem_1.0.6             </span>
<span class="co">##  [47] withr_2.5.0               PRECAST_1.4              </span>
<span class="co">##  [49] progressr_0.10.1          sctransform_0.3.3        </span>
<span class="co">##  [51] mclust_5.4.10             goftest_1.2-3            </span>
<span class="co">##  [53] cluster_2.1.2             lazyeval_0.2.2           </span>
<span class="co">##  [55] crayon_1.5.1              edgeR_3.36.0             </span>
<span class="co">##  [57] pkgconfig_2.0.3           labeling_0.4.2           </span>
<span class="co">##  [59] nlme_3.1-155              vipor_0.4.5              </span>
<span class="co">##  [61] rlang_1.0.2               globals_0.15.0           </span>
<span class="co">##  [63] lifecycle_1.0.1           miniUI_0.1.1.1           </span>
<span class="co">##  [65] rsvd_1.0.5                rprojroot_2.0.3          </span>
<span class="co">##  [67] polyclip_1.10-0           lmtest_0.9-40            </span>
<span class="co">##  [69] SC.MEB_1.1                carData_3.0-5            </span>
<span class="co">##  [71] Rhdf5lib_1.16.0           zoo_1.8-10               </span>
<span class="co">##  [73] beeswarm_0.4.0            ggridges_0.5.3           </span>
<span class="co">##  [75] rjson_0.2.21              png_0.1-7                </span>
<span class="co">##  [77] viridisLite_0.4.0         iSC.MEB_1.0.1            </span>
<span class="co">##  [79] bitops_1.0-7              R.oo_1.24.0              </span>
<span class="co">##  [81] KernSmooth_2.23-20        rhdf5filters_1.6.0       </span>
<span class="co">##  [83] Biostrings_2.62.0         blob_1.2.2               </span>
<span class="co">##  [85] DelayedMatrixStats_1.16.0 stringr_1.4.0            </span>
<span class="co">##  [87] parallelly_1.32.0         spatstat.random_2.2-0    </span>
<span class="co">##  [89] rstatix_0.7.0             ggsignif_0.6.3           </span>
<span class="co">##  [91] beachmat_2.10.0           scales_1.2.0             </span>
<span class="co">##  [93] memoise_2.0.1             magrittr_2.0.3           </span>
<span class="co">##  [95] plyr_1.8.7                ica_1.0-2                </span>
<span class="co">##  [97] zlibbioc_1.40.0           compiler_4.1.2           </span>
<span class="co">##  [99] dqrng_0.3.0               RColorBrewer_1.1-3       </span>
<span class="co">## [101] fitdistrplus_1.1-8        cli_3.2.0                </span>
<span class="co">## [103] XVector_0.34.0            listenv_0.8.0            </span>
<span class="co">## [105] patchwork_1.1.1           pbapply_1.5-0            </span>
<span class="co">## [107] formatR_1.11              MASS_7.3-55              </span>
<span class="co">## [109] mgcv_1.8-39               tidyselect_1.1.2         </span>
<span class="co">## [111] stringi_1.7.6             textshaping_0.3.6        </span>
<span class="co">## [113] highr_0.9                 yaml_2.3.6               </span>
<span class="co">## [115] locfit_1.5-9.4            BiocSingular_1.10.0      </span>
<span class="co">## [117] ggrepel_0.9.1             grid_4.1.2               </span>
<span class="co">## [119] sass_0.4.1                tools_4.1.2              </span>
<span class="co">## [121] future.apply_1.9.0        parallel_4.1.2           </span>
<span class="co">## [123] rstudioapi_0.13           gridExtra_2.3            </span>
<span class="co">## [125] farver_2.1.0              Rtsne_0.16               </span>
<span class="co">## [127] DropletUtils_1.14.2       digest_0.6.29            </span>
<span class="co">## [129] rgeos_0.5-9               FNN_1.1.3.1              </span>
<span class="co">## [131] shiny_1.7.1               Rcpp_1.0.10              </span>
<span class="co">## [133] car_3.0-12                broom_0.7.12             </span>
<span class="co">## [135] later_1.3.0               RcppAnnoy_0.0.19         </span>
<span class="co">## [137] httr_1.4.3                fs_1.5.2                 </span>
<span class="co">## [139] tensor_1.5                reticulate_1.25          </span>
<span class="co">## [141] splines_4.1.2             uwot_0.1.11              </span>
<span class="co">## [143] spatstat.utils_3.0-1      pkgdown_2.0.6            </span>
<span class="co">## [145] plotly_4.10.0             systemfonts_1.0.4        </span>
<span class="co">## [147] xtable_1.8-4              jsonlite_1.8.0           </span>
<span class="co">## [149] R6_2.5.1                  pillar_1.7.0             </span>
<span class="co">## [151] htmltools_0.5.2           mime_0.12                </span>
<span class="co">## [153] glue_1.6.2                fastmap_1.1.0            </span>
<span class="co">## [155] BiocParallel_1.28.3       BiocNeighbors_1.12.0     </span>
<span class="co">## [157] codetools_0.2-18          utf8_1.2.2               </span>
<span class="co">## [159] lattice_0.20-45           bslib_0.3.1              </span>
<span class="co">## [161] spatstat.sparse_2.1-1     tibble_3.1.7             </span>
<span class="co">## [163] ggbeeswarm_0.6.0          leiden_0.4.2             </span>
<span class="co">## [165] gtools_3.9.2.2            magick_2.7.3             </span>
<span class="co">## [167] limma_3.50.1              survival_3.2-13          </span>
<span class="co">## [169] CompQuadForm_1.4.3        rmarkdown_2.11           </span>
<span class="co">## [171] desc_1.4.0                munsell_0.5.0            </span>
<span class="co">## [173] GenomeInfoDbData_1.2.7    HDF5Array_1.22.1         </span>
<span class="co">## [175] reshape2_1.4.4            gtable_0.3.0             </span>
<span class="co">## [177] spatstat.core_2.4-4</span></code></pre>
</details>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Wei Liu, Yi Yang, Xu Liao, Xiao Zhang, Jin Liu.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
