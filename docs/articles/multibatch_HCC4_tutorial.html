<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SRT data embedding, clustering and integration • SRTpipeline</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="SRT data embedding, clustering and integration">
<meta property="og:description" content="SRTpipeline">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">SRTpipeline</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="../articles/Installation.html">
    <span class="fas fa-book"></span>
     
    Install
  </a>
</li>
<li>
  <a href="../articles/get_started.html">
    <span class="fas fa-book"></span>
     
    Get Started
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-book"></span>
     
    Single Data Analysis
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/single_basic_tutorial.html">Basic tutorial</a>
    </li>
    <li>
      <a href="../articles/dlpfc_tutorial.html">Embedding and clustering introduction</a>
    </li>
    <li>
      <a href="../articles/single_Embryo_SC_tutorial.html">SRT data clustering</a>
    </li>
    <li>
      <a href="../articles/single_Embryo_DRSC_tutorial.html">SRT data embedding and clustering</a>
    </li>
    <li>
      <a href="../articles/single_MOB_Anno_tutorial.html">SRT data embedding and annotation</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-book"></span>
     
    Multiple Data Analysis
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/multibatch_basic_tutorial.html">Basic tutorial</a>
    </li>
    <li>
      <a href="../articles/integration_introduction.html">Basic tutorial v2</a>
    </li>
    <li>
      <a href="../articles/multibatch_brain12_tutorial.html">SRT data clustering and integration</a>
    </li>
    <li>
      <a href="../articles/multibatch_HCC4_tutorial.html">SRT data embedding, clustering and integration example 1</a>
    </li>
    <li>
      <a href="../articles/multibatch_liver8_tutorial.html">SRT data embedding, clustering and integration example 2</a>
    </li>
    <li>
      <a href="../articles/multibatch_MOB16_tutorial.html">SRT data embedding, clustering and integration example 3</a>
    </li>
  </ul>
</li>
<li>
  <a href="../articles/faq.html">
    <span class="fa fa-question-circle-o"></span>
     
    FAQ
  </a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li>
  <a href="../reference/index.html">
    <span class="fa fa-file-code-o"></span>
     
    Functions
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>SRT data embedding, clustering and integration</h1>
            
            <h4 data-toc-skip class="date">Compiled: 二月 21, 2023</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/feiyoung/SRTpipeline/blob/HEAD/vignettes/multibatch_HCC4_tutorial.Rmd"><code>vignettes/multibatch_HCC4_tutorial.Rmd</code></a></small>
      <div class="hidden name"><code>multibatch_HCC4_tutorial.Rmd</code></div>

    </div>

    
    
<hr>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>This tutorial introduce how to use <code>SRTpipeline</code> (&gt;=0.1.0) to analyze multiple spatially-resolved transcriptomics (SRT) data. We emphases how to use <code>PRECAST</code> model for joint spatial embedding, clustering and integration and its followed applications based on <code>SRTProject</code> object in the <code>SRTpipeline</code> package. This tutorial will cover the following tasks, which we believe will be common for many spatial analyses:</p>
<ul>
<li>Normalization</li>
<li>Feature selection</li>
<li>Dimension reduction</li>
<li>Spatial clustering</li>
<li>Data integration</li>
<li>Batch-corrected gene expression</li>
<li>DEG analysis</li>
<li>Spatial trajectory inference</li>
<li>Visualization</li>
</ul>
<p>First, we load <code>SRTpipeline</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/feiyoung/SRTpipeline">SRTpipeline</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2023</span><span class="op">)</span>  <span class="co"># set a random seed for reproducibility.</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="dataset">Dataset<a class="anchor" aria-label="anchor" href="#dataset"></a>
</h2>
<p>For this tutorial, we will introduce how to create a <code>SRTProject</code> object with multiple SRT samples using SRTpipeline that includes an introduction to common analytical workflows for multiple data batches. Here, we will be taking spatial transcriptomics dataset for mouse liver as an example. There are eight tissue slices with 1,300~3,000 spots and 36,601 genes that were sequenced on the Visium platform. The raw data can be downloaded <a href="https://www.ncbi.nlm.nih.gov/sra?linkname=bioproject_sra_all&amp;from_uid=858545" class="external-link">here</a>, and <a href="https://doi.org/10.6084/m9.figshare.21280569.v1" class="external-link">here</a> and the preprocessed data can be downloaded <a href="https://github.com/feiyoung/PRECAST/tree/main/vignettes_data/" class="external-link">here</a>.</p>
<p>Next, we read the preprocessed data to the current working path for the followed analysis by the following command:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">seuList</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"HCC4_seuList.RDS"</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="pre-processing-workflow">Pre-processing workflow<a class="anchor" aria-label="anchor" href="#pre-processing-workflow"></a>
</h2>
<div class="section level3">
<h3 id="prepare-srtproject">Prepare SRTProject<a class="anchor" aria-label="anchor" href="#prepare-srtproject"></a>
</h3>
<p>Then load to R.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">n_sample</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">seuList</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://satijalab.org/seurat" class="external-link">Seurat</a></span><span class="op">)</span>
<span class="co">## create count matrix list: note each component has a name.</span>
<span class="va">cntList</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">## create spatial coordinate matrix</span>
<span class="va">coordList</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">## create metadata list</span>
<span class="va">metadataList</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">r</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_sample</span><span class="op">)</span> <span class="op">{</span>
    <span class="co"># r &lt;- 1</span>
    <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"r = "</span>, <span class="va">r</span><span class="op">)</span>
    <span class="va">seu</span> <span class="op">&lt;-</span> <span class="va">seuList</span><span class="op">[[</span><span class="va">r</span><span class="op">]</span><span class="op">]</span>
    <span class="va">sp_count</span> <span class="op">&lt;-</span> <span class="va">seu</span><span class="op">@</span><span class="va">assays</span><span class="op">$</span><span class="va">RNA</span><span class="op">@</span><span class="va">counts</span>
    <span class="va">meta.data</span> <span class="op">&lt;-</span> <span class="va">seu</span><span class="op">@</span><span class="va">meta.data</span>
    <span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">meta.data</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">sp_count</span><span class="op">)</span>
    <span class="va">cntList</span><span class="op">[[</span><span class="va">r</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">sp_count</span>
    <span class="va">metadataList</span><span class="op">[[</span><span class="va">r</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">meta.data</span>
    <span class="va">coordList</span><span class="op">[[</span><span class="va">r</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>row <span class="op">=</span> <span class="va">seu</span><span class="op">$</span><span class="va">row</span>, col <span class="op">=</span> <span class="va">seu</span><span class="op">$</span><span class="va">col</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cntList</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"HCC"</span>, <span class="fl">1</span><span class="op">:</span><span class="va">n_sample</span><span class="op">)</span>
<span class="co">## create meta data for each data batches. Here we only have one data batch.</span>
<span class="va">sampleMetadata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Human"</span>, <span class="va">n_sample</span><span class="op">)</span>, tissues <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"HCC"</span>, <span class="va">n_sample</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">sampleMetadata</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cntList</span><span class="op">)</span>
<span class="co">## Name of this project</span>
<span class="va">projectName</span> <span class="op">&lt;-</span> <span class="st">"HCC4_PRECAST"</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="create-a-srtproject-object">Create a SRTProject object<a class="anchor" aria-label="anchor" href="#create-a-srtproject-object"></a>
</h3>
<p>We start creating SRTProject object and filter out the genes less than 20 spots with nonzero read counts and the spots less than 20 genes with nonzero read counts.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SRTProj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CreateSRTProject.html">CreateSRTProject</a></span><span class="op">(</span><span class="va">cntList</span>, <span class="va">coordList</span>, projectName <span class="op">=</span> <span class="va">projectName</span>, <span class="va">metadataList</span>, <span class="va">sampleMetadata</span>,
    min.spots <span class="op">=</span> <span class="fl">20</span>, min.genes <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>
<span class="va">SRTProj</span></code></pre></div>
<pre><code><span class="co">## class: SRTProject </span>
<span class="co">## outputPath: F:\Research paper\IntegrateDRcluster\AnalysisCode\SRTpipeline\vignettes\HCC4_PRECAST </span>
<span class="co">## h5filePath: F:\Research paper\IntegrateDRcluster\AnalysisCode\SRTpipeline\vignettes\HCC4_PRECAST/HCC4_PRECAST.h5 </span>
<span class="co">## ---------Datasets basic information-----------------</span>
<span class="co">## samples(4): HCC1 HCC2 HCC3 HCC4</span>
<span class="co">## sampleColData names(3): species tissues NumOfSpots</span>
<span class="co">## cellMetaData names(10): orig.ident nCount_RNA ... imagecol batch</span>
<span class="co">## numberOfSpots(4): 2983 1334 2732 2764</span>
<span class="co">## ---------Downstream analyses information-----------------</span>
<span class="co">## Low-dimensional embeddings(0):</span>
<span class="co">## Inferred cluster labels: No</span>
<span class="co">## Embedding for plotting(0):</span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="normalizing-the-data">Normalizing the data<a class="anchor" aria-label="anchor" href="#normalizing-the-data"></a>
</h2>
<p>After removing unwanted cells and genes from the dataset, the next step is to normalize the data. To save RAM memory, normalized values are stored in disk as a <code>h5file</code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SRTProj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/normalizeSRT.html">normalizeSRT</a></span><span class="op">(</span><span class="va">SRTProj</span>, normalization.method <span class="op">=</span> <span class="st">"LogNormalize"</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="feature-selection">Feature selection<a class="anchor" aria-label="anchor" href="#feature-selection"></a>
</h2>
<p>We next select a subset of genes that exhibit high spot-to-spot variation in the dataset (i.e, they are highly expressed in some spots, and lowly expressed in others). It has been found that focusing on these genes in downstream analysis helps to highlight biological signal in single-cell datasets <a href="https://www.nature.com/articles/nmeth.2645" class="external-link">here</a>.</p>
<p>Then we choose variable features. The default number of variable features is 2,000, and users can change it using argument <code>nfeatures</code>. The default type is highly variable genes (HVGs), but users can use spatially variable genes by seting <code>type='SVGs'</code>, then <code>method='SPARK-X'</code> can be used to choose SVGs.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SRTProj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/selectVariableFeatures.html">selectVariableFeatures</a></span><span class="op">(</span><span class="va">SRTProj</span>, nfeatures <span class="op">=</span> <span class="fl">2000</span>, type <span class="op">=</span> <span class="st">"HVGs"</span>, method <span class="op">=</span> <span class="st">"vst"</span><span class="op">)</span>
<span class="va">SRTProj</span></code></pre></div>
<pre><code><span class="co">## class: SRTProject </span>
<span class="co">## outputPath: F:\Research paper\IntegrateDRcluster\AnalysisCode\SRTpipeline\vignettes\HCC4_PRECAST </span>
<span class="co">## h5filePath: F:\Research paper\IntegrateDRcluster\AnalysisCode\SRTpipeline\vignettes\HCC4_PRECAST/HCC4_PRECAST.h5 </span>
<span class="co">## ---------Datasets basic information-----------------</span>
<span class="co">## samples(4): HCC1 HCC2 HCC3 HCC4</span>
<span class="co">## sampleColData names(3): species tissues NumOfSpots</span>
<span class="co">## cellMetaData names(10): orig.ident nCount_RNA ... imagecol batch</span>
<span class="co">## numberOfSpots(4): 2983 1334 2732 2764</span>
<span class="co">## ---------Downstream analyses information-----------------</span>
<span class="co">## Variable features:  2000 </span>
<span class="co">## Low-dimensional embeddings(0):</span>
<span class="co">## Inferred cluster labels: No</span>
<span class="co">## Embedding for plotting(0):</span></code></pre>
<p>Calculate the adjcence matrix</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Obtain adjacency matrix</span>
<span class="va">SRTProj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/AddAdj.html">AddAdj</a></span><span class="op">(</span><span class="va">SRTProj</span>, platform <span class="op">=</span> <span class="st">"Visium"</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="joint-dimension-reduction-clustering-and-integration-analysis-using-precast-model">Joint dimension reduction, clustering and integration analysis using PRECAST model<a class="anchor" aria-label="anchor" href="#joint-dimension-reduction-clustering-and-integration-analysis-using-precast-model"></a>
</h2>
<p><code>PRECAST</code> model achieves joint dimension reduction, clustering and alignment by integration analysis for multiple samples. Some SRT clustering methods use Markov random field to model clusters of spots. These approaches work extremely well and are a standard practice in SRT data. <code>PRECAST</code> extracts the micro-environment related embeddings and aligned embeddings. The micro-environment related and aligned embeddings are saved in the slot <code>reductions$microEnv.PRECAST</code> and <code>reductions$aligned.PRECAST</code>, and the spatial clusters are saved in the slot <code>clusters</code>. Here, we set the number of clusters <code>K=7:11</code>, then the modified BIC criterion will be used to detemine the number of clusters from the candidates. From the results, <code>K=8</code> is chosen. The step spent approximately 10 minutes on a personal computer with Windows system.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SRTProj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Integrate_PRECAST.html">Integrate_PRECAST</a></span><span class="op">(</span><span class="va">SRTProj</span>, K <span class="op">=</span> <span class="fl">7</span><span class="op">:</span><span class="fl">9</span>, q <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## variable initialize finish! </span>
<span class="co">## NA</span>
<span class="co">## variable initialize finish! </span>
<span class="co">## predict Y and V! </span>
<span class="co">## predict Y and V! </span>
<span class="co">## Finish ICM step! </span>
<span class="co">## predict Y and V! </span>
<span class="co">## Finish ICM step! </span>
<span class="co">## Finish ICM step! </span>
<span class="co">## iter = 2, loglik= 19152090.000000, dloglik=1.008918 </span>
<span class="co">## iter = 2, loglik= 19153500.000000, dloglik=1.008919 </span>
<span class="co">## iter = 2, loglik= 19155374.000000, dloglik=1.008920 </span>
<span class="co">## predict Y and V! </span>
<span class="co">## diff Energy = 11.009619 </span>
<span class="co">## diff Energy = 8.262450 </span>
<span class="co">## diff Energy = 5.011832 </span>
<span class="co">## Finish ICM step! </span>
<span class="co">## predict Y and V! </span>
<span class="co">## diff Energy = 4.868132 </span>
<span class="co">## diff Energy = 1.575717 </span>
<span class="co">## diff Energy = 8.837044 </span>
<span class="co">## diff Energy = 6.629207 </span>
<span class="co">## Finish ICM step! </span>
<span class="co">## predict Y and V! </span>
<span class="co">## diff Energy = 3.188183 </span>
<span class="co">## diff Energy = 1.316671 </span>
<span class="co">## diff Energy = 0.461392 </span>
<span class="co">## diff Energy = 4.405605 </span>
<span class="co">## Finish ICM step! </span>
<span class="co">## iter = 3, loglik= 19229200.000000, dloglik=0.004026 </span>
<span class="co">## iter = 3, loglik= 19230052.000000, dloglik=0.003997 </span>
<span class="co">## predict Y and V! </span>
<span class="co">## diff Energy = 8.682318 </span>
<span class="co">## diff Energy = 6.670260 </span>
<span class="co">## diff Energy = 7.548091 </span>
<span class="co">## diff Energy = 4.870124 </span>
<span class="co">## iter = 3, loglik= 19231540.000000, dloglik=0.003976 </span>
<span class="co">## Finish ICM step! </span>
<span class="co">## predict Y and V! </span>
<span class="co">## diff Energy = 15.383581 </span>
<span class="co">## diff Energy = 5.505604 </span>
<span class="co">## diff Energy = 2.698027 </span>
<span class="co">## diff Energy = 8.929449 </span>
<span class="co">## Finish ICM step! </span>
<span class="co">## iter = 4, loglik= 19258736.000000, dloglik=0.001536 </span>
<span class="co">## predict Y and V! </span>
<span class="co">## diff Energy = 11.752818 </span>
<span class="co">## diff Energy = 12.987633 </span>
<span class="co">## diff Energy = 0.532186 </span>
<span class="co">## diff Energy = 1.337098 </span>
<span class="co">## Finish ICM step! </span>
<span class="co">## iter = 4, loglik= 19258952.000000, dloglik=0.001503 </span>
<span class="co">## predict Y and V! </span>
<span class="co">## diff Energy = 9.936438 </span>
<span class="co">## diff Energy = 3.680013 </span>
<span class="co">## diff Energy = 3.597687 </span>
<span class="co">## diff Energy = 4.555817 </span>
<span class="co">## Finish ICM step! </span>
<span class="co">## iter = 4, loglik= 19259818.000000, dloglik=0.001470 </span>
<span class="co">## predict Y and V! </span>
<span class="co">## diff Energy = 14.719856 </span>
<span class="co">## diff Energy = 0.093451 </span>
<span class="co">## iter = 5, loglik= 19275690.000000, dloglik=0.000880 </span>
<span class="co">## diff Energy = 3.852135 </span>
<span class="co">## Finish ICM step! </span>
<span class="co">## predict Y and V! </span>
<span class="co">## diff Energy = 4.413967 </span>
<span class="co">## diff Energy = 10.123855 </span>
<span class="co">## diff Energy = 0.667092 </span>
<span class="co">## predict Y and V! </span>
<span class="co">## diff Energy = 1.262597 </span>
<span class="co">## diff Energy = 2.407626 </span>
<span class="co">## diff Energy = 12.749095 </span>
<span class="co">## diff Energy = 0.797623 </span>
<span class="co">## Finish ICM step! </span>
<span class="co">## Finish ICM step! </span>
<span class="co">## iter = 5, loglik= 19275660.000000, dloglik=0.000868 </span>
<span class="co">## iter = 6, loglik= 19286176.000000, dloglik=0.000544 </span>
<span class="co">## iter = 5, loglik= 19274960.000000, dloglik=0.000786 </span>
<span class="co">## predict Y and V! </span>
<span class="co">## diff Energy = 3.989880 </span>
<span class="co">## diff Energy = 1.363137 </span>
<span class="co">## diff Energy = 2.521062 </span>
<span class="co">## diff Energy = 6.726256 </span>
<span class="co">## Finish ICM step! </span>
<span class="co">## predict Y and V! </span>
<span class="co">## diff Energy = 1.911554 </span>
<span class="co">## diff Energy = 0.663595 </span>
<span class="co">## diff Energy = 9.176133 </span>
<span class="co">## diff Energy = 4.462726 </span>
<span class="co">## Finish ICM step! </span>
<span class="co">## predict Y and V! </span>
<span class="co">## diff Energy = 7.861823 </span>
<span class="co">## diff Energy = 6.287667 </span>
<span class="co">## diff Energy = 4.470873 </span>
<span class="co">## iter = 6, loglik= 19286524.000000, dloglik=0.000564 </span>
<span class="co">## diff Energy = 1.427833 </span>
<span class="co">## Finish ICM step! </span>
<span class="co">## iter = 7, loglik= 19293314.000000, dloglik=0.000370 </span>
<span class="co">## predict Y and V! </span>
<span class="co">## diff Energy = 0.246707 </span>
<span class="co">## diff Energy = 2.160293 </span>
<span class="co">## iter = 6, loglik= 19284552.000000, dloglik=0.000498 </span>
<span class="co">## Finish ICM step! </span>
<span class="co">## predict Y and V! </span>
<span class="co">## diff Energy = 0.438921 </span>
<span class="co">## diff Energy = 0.070206 </span>
<span class="co">## diff Energy = 5.494381 </span>
<span class="co">## diff Energy = 1.705617 </span>
<span class="co">## Finish ICM step! </span>
<span class="co">## iter = 7, loglik= 19293778.000000, dloglik=0.000376 </span>
<span class="co">## predict Y and V! </span>
<span class="co">## diff Energy = 1.677203 </span>
<span class="co">## diff Energy = 0.353119 </span>
<span class="co">## diff Energy = 1.737614 </span>
<span class="co">## iter = 8, loglik= 19298098.000000, dloglik=0.000248 </span>
<span class="co">## Finish ICM step! </span>
<span class="co">## predict Y and V! </span>
<span class="co">## diff Energy = 5.324886 </span>
<span class="co">## diff Energy = 0.162021 </span>
<span class="co">## diff Energy = 0.720278 </span>
<span class="co">## diff Energy = 0.876093 </span>
<span class="co">## predict Y and V! </span>
<span class="co">## diff Energy = 0.969523 </span>
<span class="co">## diff Energy = 0.524339 </span>
<span class="co">## diff Energy = 6.988776 </span>
<span class="co">## Finish ICM step! </span>
<span class="co">## Finish ICM step! </span>
<span class="co">## iter = 7, loglik= 19291074.000000, dloglik=0.000338 </span>
<span class="co">## iter = 9, loglik= 19301580.000000, dloglik=0.000180 </span>
<span class="co">## iter = 8, loglik= 19298752.000000, dloglik=0.000258 </span>
<span class="co">## predict Y and V! </span>
<span class="co">## diff Energy = 6.088966 </span>
<span class="co">## diff Energy = 3.979883 </span>
<span class="co">## diff Energy = 0.382177 </span>
<span class="co">## Finish ICM step! </span>
<span class="co">## predict Y and V! </span>
<span class="co">## diff Energy = 0.185772 </span>
<span class="co">## diff Energy = 0.596927 </span>
<span class="co">## diff Energy = 7.135834 </span>
<span class="co">## predict Y and V! </span>
<span class="co">## diff Energy = 2.046024 </span>
<span class="co">## diff Energy = 0.018895 </span>
<span class="co">## diff Energy = 0.164930 </span>
<span class="co">## Finish ICM step! </span>
<span class="co">## diff Energy = 2.897159 </span>
<span class="co">## Finish ICM step! </span>
<span class="co">## iter = 8, loglik= 19296282.000000, dloglik=0.000270 </span>
<span class="co">## iter = 10, loglik= 19304192.000000, dloglik=0.000135 </span>
<span class="co">## iter = 9, loglik= 19302346.000000, dloglik=0.000186 </span>
<span class="co">## predict Y and V! </span>
<span class="co">## diff Energy = 1.627416 </span>
<span class="co">## diff Energy = 0.645968 </span>
<span class="co">## diff Energy = 5.161469 </span>
<span class="co">## predict Y and V! </span>
<span class="co">## diff Energy = 5.556897 </span>
<span class="co">## Finish ICM step! </span>
<span class="co">## Finish ICM step! </span>
<span class="co">## predict Y and V! </span>
<span class="co">## diff Energy = 5.368841 </span>
<span class="co">## diff Energy = 0.617413 </span>
<span class="co">## diff Energy = 2.676151 </span>
<span class="co">## diff Energy = 0.234389 </span>
<span class="co">## Finish ICM step! </span>
<span class="co">## iter = 11, loglik= 19305960.000000, dloglik=0.000092 </span>
<span class="co">## iter = 9, loglik= 19300058.000000, dloglik=0.000196 </span>
<span class="co">## iter = 10, loglik= 19304854.000000, dloglik=0.000130 </span>
<span class="co">## predict Y and V! </span>
<span class="co">## diff Energy = 0.139625 </span>
<span class="co">## diff Energy = 2.457803 </span>
<span class="co">## diff Energy = 0.043794 </span>
<span class="co">## Finish ICM step! </span>
<span class="co">## predict Y and V! </span>
<span class="co">## diff Energy = 2.862559 </span>
<span class="co">## diff Energy = 1.087521 </span>
<span class="co">## predict Y and V! </span>
<span class="co">## diff Energy = 0.482468 </span>
<span class="co">## diff Energy = 1.788260 </span>
<span class="co">## diff Energy = 0.079574 </span>
<span class="co">## diff Energy = 4.972907 </span>
<span class="co">## Finish ICM step! </span>
<span class="co">## Finish ICM step! </span>
<span class="co">## iter = 12, loglik= 19307502.000000, dloglik=0.000080 </span>
<span class="co">## iter = 11, loglik= 19306768.000000, dloglik=0.000099 </span>
<span class="co">## iter = 10, loglik= 19302916.000000, dloglik=0.000148 </span>
<span class="co">## predict Y and V! </span>
<span class="co">## diff Energy = 0.135565 </span>
<span class="co">## diff Energy = 3.101122 </span>
<span class="co">## Finish ICM step! </span>
<span class="co">## predict Y and V! </span>
<span class="co">## diff Energy = 0.007794 </span>
<span class="co">## diff Energy = 0.870837 </span>
<span class="co">## diff Energy = 2.274071 </span>
<span class="co">## iter = 13, loglik= 19308792.000000, dloglik=0.000067 </span>
<span class="co">## Finish ICM step! </span>
<span class="co">## predict Y and V! </span>
<span class="co">## diff Energy = 3.084832 </span>
<span class="co">## diff Energy = 1.377484 </span>
<span class="co">## diff Energy = 0.035957 </span>
<span class="co">## Finish ICM step! </span>
<span class="co">## predict Y and V! </span>
<span class="co">## diff Energy = 1.372339 </span>
<span class="co">## diff Energy = 0.391564 </span>
<span class="co">## diff Energy = 3.120036 </span>
<span class="co">## iter = 12, loglik= 19308316.000000, dloglik=0.000080 </span>
<span class="co">## Finish ICM step! </span>
<span class="co">## iter = 11, loglik= 19305220.000000, dloglik=0.000119 </span>
<span class="co">## iter = 14, loglik= 19309524.000000, dloglik=0.000038 </span>
<span class="co">## predict Y and V! </span>
<span class="co">## diff Energy = 0.272916 </span>
<span class="co">## diff Energy = 0.333331 </span>
<span class="co">## diff Energy = 0.889918 </span>
<span class="co">## Finish ICM step! </span>
<span class="co">## predict Y and V! </span>
<span class="co">## diff Energy = 2.360854 </span>
<span class="co">## diff Energy = 0.763300 </span>
<span class="co">## Finish ICM step! </span>
<span class="co">## predict Y and V! </span>
<span class="co">## diff Energy = 1.256197 </span>
<span class="co">## diff Energy = 5.278311 </span>
<span class="co">## diff Energy = 1.016219 </span>
<span class="co">## Finish ICM step! </span>
<span class="co">## iter = 13, loglik= 19309456.000000, dloglik=0.000059 </span>
<span class="co">## iter = 12, loglik= 19306874.000000, dloglik=0.000086 </span>
<span class="co">## iter = 15, loglik= 19310274.000000, dloglik=0.000039 </span>
<span class="co">## predict Y and V! </span>
<span class="co">## diff Energy = 0.717860 </span>
<span class="co">## diff Energy = 1.092539 </span>
<span class="co">## diff Energy = 0.412402 </span>
<span class="co">## diff Energy = 1.848001 </span>
<span class="co">## Finish ICM step! </span>
<span class="co">## predict Y and V! </span>
<span class="co">## diff Energy = 0.282135 </span>
<span class="co">## diff Energy = 3.166495 </span>
<span class="co">## Finish ICM step! </span>
<span class="co">## predict Y and V! </span>
<span class="co">## diff Energy = 7.367300 </span>
<span class="co">## Finish ICM step! </span>
<span class="co">## iter = 14, loglik= 19310306.000000, dloglik=0.000044 </span>
<span class="co">## iter = 16, loglik= 19311078.000000, dloglik=0.000042 </span>
<span class="co">## iter = 13, loglik= 19308158.000000, dloglik=0.000067 </span>
<span class="co">## predict Y and V! </span>
<span class="co">## diff Energy = 5.157040 </span>
<span class="co">## diff Energy = 0.994202 </span>
<span class="co">## diff Energy = 1.331491 </span>
<span class="co">## Finish ICM step! </span>
<span class="co">## predict Y and V! </span>
<span class="co">## diff Energy = 1.218117 </span>
<span class="co">## diff Energy = 3.405816 </span>
<span class="co">## diff Energy = 0.429373 </span>
<span class="co">## Finish ICM step! </span>
<span class="co">## predict Y and V! </span>
<span class="co">## diff Energy = 0.737044 </span>
<span class="co">## iter = 15, loglik= 19311150.000000, dloglik=0.000044 </span>
<span class="co">## Finish ICM step! </span>
<span class="co">## iter = 17, loglik= 19311638.000000, dloglik=0.000029 </span>
<span class="co">## predict Y and V! </span>
<span class="co">## diff Energy = 0.340474 </span>
<span class="co">## diff Energy = 2.122223 </span>
<span class="co">## diff Energy = 5.182219 </span>
<span class="co">## iter = 14, loglik= 19309088.000000, dloglik=0.000048 </span>
<span class="co">## predict Y and V! </span>
<span class="co">## diff Energy = 0.981946 </span>
<span class="co">## Finish ICM step! </span>
<span class="co">## Finish ICM step! </span>
<span class="co">## iter = 18, loglik= 19312216.000000, dloglik=0.000030 </span>
<span class="co">## iter = 16, loglik= 19311694.000000, dloglik=0.000028 </span>
<span class="co">## predict Y and V! </span>
<span class="co">## diff Energy = 1.917482 </span>
<span class="co">## diff Energy = 0.646530 </span>
<span class="co">## Finish ICM step! </span>
<span class="co">## predict Y and V! </span>
<span class="co">## diff Energy = 1.154662 </span>
<span class="co">## diff Energy = 0.100481 </span>
<span class="co">## Finish ICM step! </span>
<span class="co">## predict Y and V! </span>
<span class="co">## diff Energy = 3.658197 </span>
<span class="co">## diff Energy = 1.866670 </span>
<span class="co">## Finish ICM step! </span>
<span class="co">## iter = 15, loglik= 19309872.000000, dloglik=0.000041 </span>
<span class="co">## iter = 19, loglik= 19312646.000000, dloglik=0.000022 </span>
<span class="co">## iter = 17, loglik= 19312276.000000, dloglik=0.000030 </span>
<span class="co">## predict Y and V! </span>
<span class="co">## diff Energy = 4.841889 </span>
<span class="co">## diff Energy = 3.959756 </span>
<span class="co">## diff Energy = 0.951052 </span>
<span class="co">## predict Y and V! </span>
<span class="co">## diff Energy = 0.388100 </span>
<span class="co">## diff Energy = 0.319716 </span>
<span class="co">## diff Energy = 4.875951 </span>
<span class="co">## Finish ICM step! </span>
<span class="co">## Finish ICM step! </span>
<span class="co">## predict Y and V! </span>
<span class="co">## diff Energy = 1.814254 </span>
<span class="co">## diff Energy = 1.078986 </span>
<span class="co">## Finish ICM step! </span>
<span class="co">## iter = 20, loglik= 19312986.000000, dloglik=0.000018 </span>
<span class="co">## iter = 16, loglik= 19310592.000000, dloglik=0.000037 </span>
<span class="co">## iter = 18, loglik= 19312674.000000, dloglik=0.000021 </span>
<span class="co">## predict Y and V! </span>
<span class="co">## diff Energy = 3.909587 </span>
<span class="co">## diff Energy = 0.213740 </span>
<span class="co">## Finish ICM step! </span>
<span class="co">## predict Y and V! </span>
<span class="co">## diff Energy = 1.568420 </span>
<span class="co">## diff Energy = 1.982147 </span>
<span class="co">## diff Energy = 0.062297 </span>
<span class="co">## diff Energy = 0.062114 </span>
<span class="co">## Finish ICM step! </span>
<span class="co">## iter = 17, loglik= 19311142.000000, dloglik=0.000028 </span>
<span class="co">## iter = 19, loglik= 19313074.000000, dloglik=0.000021 </span>
<span class="co">## predict Y and V! </span>
<span class="co">## diff Energy = 0.335694 </span>
<span class="co">## diff Energy = 1.919033 </span>
<span class="co">## Finish ICM step! </span>
<span class="co">## predict Y and V! </span>
<span class="co">## diff Energy = 0.991286 </span>
<span class="co">## diff Energy = 2.250116 </span>
<span class="co">## diff Energy = 2.199910 </span>
<span class="co">## Finish ICM step! </span>
<span class="co">## iter = 18, loglik= 19311544.000000, dloglik=0.000021 </span>
<span class="co">## iter = 20, loglik= 19313490.000000, dloglik=0.000022 </span>
<span class="co">## predict Y and V! </span>
<span class="co">## diff Energy = 0.404394 </span>
<span class="co">## diff Energy = 0.833901 </span>
<span class="co">## diff Energy = 0.241814 </span>
<span class="co">## diff Energy = 2.012040 </span>
<span class="co">## Finish ICM step! </span>
<span class="co">## iter = 19, loglik= 19311922.000000, dloglik=0.000020 </span>
<span class="co">## predict Y and V! </span>
<span class="co">## diff Energy = 0.390965 </span>
<span class="co">## diff Energy = 4.629987 </span>
<span class="co">## Finish ICM step! </span>
<span class="co">## iter = 20, loglik= 19312332.000000, dloglik=0.000021</span></code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SRTProj</span></code></pre></div>
<pre><code><span class="co">## class: SRTProject </span>
<span class="co">## outputPath: F:\Research paper\IntegrateDRcluster\AnalysisCode\SRTpipeline\vignettes\HCC4_PRECAST </span>
<span class="co">## h5filePath: F:\Research paper\IntegrateDRcluster\AnalysisCode\SRTpipeline\vignettes\HCC4_PRECAST/HCC4_PRECAST.h5 </span>
<span class="co">## ---------Datasets basic information-----------------</span>
<span class="co">## samples(4): HCC1 HCC2 HCC3 HCC4</span>
<span class="co">## sampleColData names(3): species tissues NumOfSpots</span>
<span class="co">## cellMetaData names(10): orig.ident nCount_RNA ... imagecol batch</span>
<span class="co">## numberOfSpots(4): 2983 1334 2732 2764</span>
<span class="co">## ---------Downstream analyses information-----------------</span>
<span class="co">## Variable features:  2000 </span>
<span class="co">## Low-dimensional embeddings(2): microEnv.PRECAST aligned.PRECAST</span>
<span class="co">## Inferred cluster labels: Yes</span>
<span class="co">## Embedding for plotting(0):</span></code></pre>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">SRTProj</span><span class="op">@</span><span class="va">clusters</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## </span>
<span class="co">##    1    2    3    4    5    6    7    8 </span>
<span class="co">## 4465  882  809  720  679  379 1446  433</span></code></pre>
</div>
<div class="section level2">
<h2 id="visualization">Visualization<a class="anchor" aria-label="anchor" href="#visualization"></a>
</h2>
<div class="section level3">
<h3 id="srt-embeddings">SRT embeddings<a class="anchor" aria-label="anchor" href="#srt-embeddings"></a>
</h3>
<p>To check the performance of integration, we visuzlize the inferred clusters and data batches on the two-dimensional tSNEs. First, we use <code><a href="../reference/AddTSNE.html">AddTSNE()</a></code> function to calculate the two-dimensional tSNEs based on the <code>aligned.PRECAST</code> embeddings.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SRTProj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/AddTSNE.html">AddTSNE</a></span><span class="op">(</span><span class="va">SRTProj</span>, n_comp <span class="op">=</span> <span class="fl">2</span>, reduction <span class="op">=</span> <span class="st">"aligned.PRECAST"</span><span class="op">)</span></code></pre></div>
<p>We visualized the inferred clusters and data batches. The tSNE plot showed the domain clusters were well segregated and data batches were well mixed.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cols_cluster</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/chooseColors.html">chooseColors</a></span><span class="op">(</span>n_colors <span class="op">=</span> <span class="fl">8</span><span class="op">)</span>
<span class="va">cols_batch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/chooseColors.html">chooseColors</a></span><span class="op">(</span>palettes_name <span class="op">=</span> <span class="st">"Light 13"</span>, n_colors <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>
<span class="va">p_tsne2_cluster</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/EmbedPlot.html">EmbedPlot</a></span><span class="op">(</span><span class="va">SRTProj</span>, item <span class="op">=</span> <span class="st">"cluster"</span>, plotEmbeddings <span class="op">=</span> <span class="st">"tSNE"</span>, cols <span class="op">=</span> <span class="va">cols_cluster</span>,
    legend.position <span class="op">=</span> <span class="st">"bottom"</span>, pt_size <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span>
<span class="va">p_tsne2_batch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/EmbedPlot.html">EmbedPlot</a></span><span class="op">(</span><span class="va">SRTProj</span>, item <span class="op">=</span> <span class="st">"batch"</span>, plotEmbeddings <span class="op">=</span> <span class="st">"tSNE"</span>, cols <span class="op">=</span> <span class="va">cols_batch</span>,
    legend.position <span class="op">=</span> <span class="st">"bottom"</span>, pt_size <span class="op">=</span> <span class="fl">0.2</span>, nrow.legend <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="../reference/drawFigs.html">drawFigs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">p_tsne2_cluster</span>, <span class="va">p_tsne2_batch</span><span class="op">)</span>, layout.dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></code></pre></div>
<p><img src="multibatch_HCC4_tutorial_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="spatial-heatmap-to-show-the-clustering-performance">Spatial heatmap to show the clustering performance<a class="anchor" aria-label="anchor" href="#spatial-heatmap-to-show-the-clustering-performance"></a>
</h3>
<p>Except for the embedding plots, SRTpipeline also provides a variaty of visualization functions. First, we visualize the spatial distribution of cluster labels that shows the layer structure for all data batches.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## choose colors to function chooseColors</span>
<span class="va">p12</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/EachClusterSpaHeatMap.html">EachClusterSpaHeatMap</a></span><span class="op">(</span><span class="va">SRTProj</span>, cols <span class="op">=</span> <span class="va">cols_cluster</span>, legend.position <span class="op">=</span> <span class="st">"right"</span>, base_size <span class="op">=</span> <span class="fl">12</span>,
    pt_size <span class="op">=</span> <span class="fl">1</span>, layout.dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="va">p12</span></code></pre></div>
<p><img src="multibatch_HCC4_tutorial_files/figure-html/unnamed-chunk-10-1.png" width="700"> By setting <code>combine =FALSE</code>, this function will return a list of ggplot2 objects, thus user can revise each plot. In addtion, we can also plot some of data batches that are interested using the number ID or names of batch.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pList</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/EachClusterSpaHeatMap.html">EachClusterSpaHeatMap</a></span><span class="op">(</span><span class="va">SRTProj</span>, cols <span class="op">=</span> <span class="va">cols_cluster</span>, legend.position <span class="op">=</span> <span class="st">"bottom"</span>, base_size <span class="op">=</span> <span class="fl">12</span>,
    pt_size <span class="op">=</span> <span class="fl">0.5</span>, layout.dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span><span class="op">)</span>, nrow.legend <span class="op">=</span> <span class="fl">1</span>, combine <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="../reference/EachClusterSpaHeatMap.html">EachClusterSpaHeatMap</a></span><span class="op">(</span><span class="va">SRTProj</span>, batch <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, title_name <span class="op">=</span> <span class="st">"PRECAST: "</span>, cols <span class="op">=</span> <span class="va">cols_cluster</span>, legend.position <span class="op">=</span> <span class="st">"right"</span>,
    base_size <span class="op">=</span> <span class="fl">12</span>, pt_size <span class="op">=</span> <span class="fl">1</span>, layout.dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="multibatch_HCC4_tutorial_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/EachClusterSpaHeatMap.html">EachClusterSpaHeatMap</a></span><span class="op">(</span><span class="va">SRTProj</span>, batch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"HCC1"</span>, <span class="st">"HCC2"</span>, <span class="st">"HCC3"</span><span class="op">)</span>, title_name <span class="op">=</span> <span class="st">"PRECAST: "</span>, cols <span class="op">=</span> <span class="va">cols_cluster</span>,
    legend.position <span class="op">=</span> <span class="st">"right"</span>, base_size <span class="op">=</span> <span class="fl">12</span>, pt_size <span class="op">=</span> <span class="fl">1</span>, layout.dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="multibatch_HCC4_tutorial_files/figure-html/unnamed-chunk-11-2.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="rgb-plot-to-show-the-embedding-performance">RGB plot to show the embedding performance<a class="anchor" aria-label="anchor" href="#rgb-plot-to-show-the-embedding-performance"></a>
</h3>
<p>Next, we summarized the inferred embeddings for biological eﬀects between spatial domain types (the slot <code>reductions</code>) using three components from either tSNE or UMAP and visualized the resulting tSNE/UMAP components with red/green/blue (RGB) colors in the RGB plot.</p>
<p>The resulting RGB plots from <code>PRECAST</code> showed the laminar organization of the human cerebral cortex, and <code>PRECAST</code> provided smooth transitions across neighboring spots and spatial domains.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SRTProj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/AddTSNE.html">AddTSNE</a></span><span class="op">(</span><span class="va">SRTProj</span>, n_comp <span class="op">=</span> <span class="fl">3</span>, reduction <span class="op">=</span> <span class="st">"aligned.PRECAST"</span><span class="op">)</span>
<span class="va">p_tsne3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/EachRGBSpaHeatMap.html">EachRGBSpaHeatMap</a></span><span class="op">(</span><span class="va">SRTProj</span>, plot_type <span class="op">=</span> <span class="st">"tSNE"</span>, pt_size <span class="op">=</span> <span class="fl">0.5</span>, title_name <span class="op">=</span> <span class="st">""</span>, layout.dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,
    <span class="fl">4</span><span class="op">)</span><span class="op">)</span>
<span class="va">p_tsne3</span></code></pre></div>
<p><img src="multibatch_HCC4_tutorial_files/figure-html/unnamed-chunk-12-1.png" width="700"> To run UMAP in SRTpipeline we use the <code><a href="../reference/AddUMAP.html">AddUMAP()</a></code> function. Frist, we evaluate the two-dimensional UMAPs.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SRTProj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/AddUMAP.html">AddUMAP</a></span><span class="op">(</span><span class="va">SRTProj</span>, n_comp <span class="op">=</span> <span class="fl">2</span>, reduction <span class="op">=</span> <span class="st">"aligned.PRECAST"</span><span class="op">)</span>
<span class="va">p_umap2_cluster</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/EmbedPlot.html">EmbedPlot</a></span><span class="op">(</span><span class="va">SRTProj</span>, item <span class="op">=</span> <span class="st">"cluster"</span>, plotEmbeddings <span class="op">=</span> <span class="st">"UMAP"</span>, cols <span class="op">=</span> <span class="va">cols_cluster</span>,
    legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span>
<span class="va">p_umap2_batch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/EmbedPlot.html">EmbedPlot</a></span><span class="op">(</span><span class="va">SRTProj</span>, item <span class="op">=</span> <span class="st">"batch"</span>, plotEmbeddings <span class="op">=</span> <span class="st">"UMAP"</span>, cols <span class="op">=</span> <span class="va">cols_batch</span>,
    legend.position <span class="op">=</span> <span class="st">"bottom"</span>, nrow.legend <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="../reference/drawFigs.html">drawFigs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">p_umap2_cluster</span>, <span class="va">p_umap2_batch</span><span class="op">)</span>, layout.dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></code></pre></div>
<p><img src="multibatch_HCC4_tutorial_files/figure-html/unnamed-chunk-13-1.png" width="700"> Then, we evaluate the three-dimensional UMAPs.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SRTProj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/AddUMAP.html">AddUMAP</a></span><span class="op">(</span><span class="va">SRTProj</span>, n_comp <span class="op">=</span> <span class="fl">3</span>, reduction <span class="op">=</span> <span class="st">"aligned.PRECAST"</span><span class="op">)</span>
<span class="va">p_umap3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/EachRGBSpaHeatMap.html">EachRGBSpaHeatMap</a></span><span class="op">(</span><span class="va">SRTProj</span>, plot_type <span class="op">=</span> <span class="st">"UMAP"</span>, layout.dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span><span class="op">)</span>, pt_size <span class="op">=</span> <span class="fl">0.5</span>, title_name <span class="op">=</span> <span class="st">"UMAP: "</span><span class="op">)</span>
<span class="va">p_umap3</span></code></pre></div>
<p><img src="multibatch_HCC4_tutorial_files/figure-html/unnamed-chunk-14-1.png" width="700"></p>
<p>To save the plot, we can use <code><a href="../reference/write_fig.html">write_fig()</a></code> function.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/write_fig.html">write_fig</a></span><span class="op">(</span><span class="va">p_umap3</span>, filename <span class="op">=</span> <span class="st">"PRECAST_p_umap3.png"</span>, width <span class="op">=</span> <span class="fl">14</span>, height <span class="op">=</span> <span class="fl">11</span><span class="op">)</span></code></pre></div>
<p>Moreover, we can visualize the microenvironment effects on the spatial coordinates. Then, we evaluate the three-dimensional UMAPs based on <code>microEnv.PRECAST</code>.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># save the previous calculated UMAP3</span>
<span class="va">umap3_cluster</span> <span class="op">&lt;-</span> <span class="va">SRTProj</span><span class="op">@</span><span class="va">plotEmbeddings</span><span class="op">$</span><span class="va">UMAP3</span>
<span class="va">SRTProj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/AddUMAP.html">AddUMAP</a></span><span class="op">(</span><span class="va">SRTProj</span>, n_comp <span class="op">=</span> <span class="fl">3</span>, reduction <span class="op">=</span> <span class="st">"microEnv.PRECAST"</span><span class="op">)</span>
<span class="va">p_umap3_micro</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/EachRGBSpaHeatMap.html">EachRGBSpaHeatMap</a></span><span class="op">(</span><span class="va">SRTProj</span>, plot_type <span class="op">=</span> <span class="st">"UMAP"</span>, layout.dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span><span class="op">)</span>, pt_size <span class="op">=</span> <span class="fl">1.2</span>,
    title_name <span class="op">=</span> <span class="st">"mircoEnv: "</span><span class="op">)</span>
<span class="va">p_umap3_micro</span></code></pre></div>
<p><img src="multibatch_HCC4_tutorial_files/figure-html/unnamed-chunk-16-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="cell-by-cell-heatmap-to-show-the-relation-of-spatial-domains">Cell-by-cell heatmap to show the relation of spatial domains<a class="anchor" aria-label="anchor" href="#cell-by-cell-heatmap-to-show-the-relation-of-spatial-domains"></a>
</h3>
<p>We plotted the heatmap of Pearson’s correlation coefcients of the estimated embeddings among the detected domains shows the good separation of the estimated embeddings across domains and the correlations between deeper layers were high, e.g., there were high correlations between domain 2 and 3, while correlations among the separated layers were low, i.e., domain 1 and 4.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p_cc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CCHeatMap.html">CCHeatMap</a></span><span class="op">(</span><span class="va">SRTProj</span>, reduction <span class="op">=</span> <span class="st">"aligned.PRECAST"</span>, grp_color <span class="op">=</span> <span class="va">cols_cluster</span><span class="op">)</span>
<span class="va">p_cc</span></code></pre></div>
<p><img src="multibatch_HCC4_tutorial_files/figure-html/unnamed-chunk-17-1.png" width="700"> After adding the quantities for data visualization, the <code>SRTProject</code> object will have more information in the downstream analyses information. Now, we print this <code>SRTProject</code> object to check it. We observed two components added in the slot <code>plotEmbeddings</code> (Embeddings for plotting): <code>tSNE</code>, <code>tSNE3</code>, <code>UMAP</code> and <code>UMAP3</code>.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SRTProj</span></code></pre></div>
<pre><code><span class="co">## class: SRTProject </span>
<span class="co">## outputPath: F:\Research paper\IntegrateDRcluster\AnalysisCode\SRTpipeline\vignettes\HCC4_PRECAST </span>
<span class="co">## h5filePath: F:\Research paper\IntegrateDRcluster\AnalysisCode\SRTpipeline\vignettes\HCC4_PRECAST/HCC4_PRECAST.h5 </span>
<span class="co">## ---------Datasets basic information-----------------</span>
<span class="co">## samples(4): HCC1 HCC2 HCC3 HCC4</span>
<span class="co">## sampleColData names(3): species tissues NumOfSpots</span>
<span class="co">## cellMetaData names(10): orig.ident nCount_RNA ... imagecol batch</span>
<span class="co">## numberOfSpots(4): 2983 1334 2732 2764</span>
<span class="co">## ---------Downstream analyses information-----------------</span>
<span class="co">## Variable features:  2000 </span>
<span class="co">## Low-dimensional embeddings(2): microEnv.PRECAST aligned.PRECAST</span>
<span class="co">## Inferred cluster labels: Yes</span>
<span class="co">## Embedding for plotting(4): tSNE tSNE3 UMAP UMAP3</span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="combined-deg-analysis">Combined DEG analysis<a class="anchor" aria-label="anchor" href="#combined-deg-analysis"></a>
</h2>
<p>After obtain the spatial cluster labels using a clustering model, we can perform differentially expression analysis. The argument <code>only.var.features</code> implies whether do batch correction for only variable features (default as <code>TRUE</code>).</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">speInt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getIntegratedData.html">getIntegratedData</a></span><span class="op">(</span><span class="va">SRTProj</span>, Method <span class="op">=</span> <span class="st">"PRECAST"</span>, species <span class="op">=</span> <span class="st">"Human"</span>, only.var.features <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>We perform differential expression analysis for all clusters by using <code><a href="https://satijalab.org/seurat/reference/FindAllMarkers.html" class="external-link">FindAllMarkers()</a></code> function, then the DE genes’ information is saved in a data.frame object <code>dat_degs</code>.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dat_degs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/FindAllDEGs.html">FindAllDEGs</a></span><span class="op">(</span><span class="va">speInt</span><span class="op">)</span>
<span class="va">dat_degs</span></code></pre></div>
<pre><code><span class="co">## DataFrame with 1289 rows and 7 columns</span>
<span class="co">##                  p_val avg_log2FC     pct.1     pct.2    p_val_adj  cluster</span>
<span class="co">##              &lt;numeric&gt;  &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;    &lt;numeric&gt; &lt;factor&gt;</span>
<span class="co">## CRP        0.00000e+00   0.260223     1.000     0.995  0.00000e+00        1</span>
<span class="co">## LCN2      1.32523e-302   0.681233     0.842     0.658 2.65047e-299        1</span>
<span class="co">## GPX2      7.25522e-277   0.300463     0.997     0.974 1.45104e-273        1</span>
<span class="co">## THBS1     4.05417e-242  -0.337956     0.942     0.956 8.10833e-239        1</span>
<span class="co">## SPINK1    9.47703e-239   0.612831     0.870     0.735 1.89541e-235        1</span>
<span class="co">## ...                ...        ...       ...       ...          ...      ...</span>
<span class="co">## CYP2A6.4   9.88942e-25  -0.333501     0.855     0.871  1.97788e-21        8</span>
<span class="co">## ADAMTS1.4  1.12284e-23  -0.294081     0.693     0.835  2.24567e-20        8</span>
<span class="co">## PTGDS.4    7.50928e-20   0.336822     1.000     0.933  1.50186e-16        8</span>
<span class="co">## CCL2.5     4.99032e-16  -0.305413     0.751     0.816  9.98065e-13        8</span>
<span class="co">## PPP1R3G    6.27300e-07   0.252607     0.603     0.617  1.25460e-03        8</span>
<span class="co">##                  gene</span>
<span class="co">##           &lt;character&gt;</span>
<span class="co">## CRP               CRP</span>
<span class="co">## LCN2             LCN2</span>
<span class="co">## GPX2             GPX2</span>
<span class="co">## THBS1           THBS1</span>
<span class="co">## SPINK1         SPINK1</span>
<span class="co">## ...               ...</span>
<span class="co">## CYP2A6.4       CYP2A6</span>
<span class="co">## ADAMTS1.4     ADAMTS1</span>
<span class="co">## PTGDS.4         PTGDS</span>
<span class="co">## CCL2.5           CCL2</span>
<span class="co">## PPP1R3G       PPP1R3G</span></code></pre>
<p>We identify the significant DE genes by two criteria: (a) adjustd p-value less than 0.01 and (b) average log fold change greater than 0.4.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">degs_sig</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">dat_degs</span>, <span class="va">p_val_adj</span> <span class="op">&lt;</span> <span class="fl">0.01</span> <span class="op">&amp;</span> <span class="va">avg_log2FC</span> <span class="op">&gt;</span> <span class="fl">0.5</span><span class="op">)</span>
<span class="va">degs_sig</span></code></pre></div>
<pre><code><span class="co">## DataFrame with 115 rows and 7 columns</span>
<span class="co">##                 p_val avg_log2FC     pct.1     pct.2    p_val_adj  cluster</span>
<span class="co">##             &lt;numeric&gt;  &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;    &lt;numeric&gt; &lt;factor&gt;</span>
<span class="co">## LCN2     1.32523e-302   0.681233     0.842     0.658 2.65047e-299        1</span>
<span class="co">## SPINK1   9.47703e-239   0.612831     0.870     0.735 1.89541e-235        1</span>
<span class="co">## CYP2A6.1 7.70864e-270   0.609182     0.999     0.858 1.54173e-266        2</span>
<span class="co">## HAMP     1.04490e-209   0.589038     0.997     0.859 2.08981e-206        2</span>
<span class="co">## APOF     4.64130e-192   0.537714     0.971     0.762 9.28259e-189        2</span>
<span class="co">## ...               ...        ...       ...       ...          ...      ...</span>
<span class="co">## CFHR5.1  1.13095e-156   0.579096     0.979     0.879 2.26189e-153        8</span>
<span class="co">## GRAMD4.2 1.13217e-152   0.547481     0.998     0.919 2.26434e-149        8</span>
<span class="co">## SPINK1.6 9.16304e-107   0.794890     1.000     0.787 1.83261e-103        8</span>
<span class="co">## NQO1.5    3.72937e-81   0.506632     0.998     0.696  7.45874e-78        8</span>
<span class="co">## CYP3A7.7  3.04553e-63   0.568287     1.000     0.817  6.09105e-60        8</span>
<span class="co">##                 gene</span>
<span class="co">##          &lt;character&gt;</span>
<span class="co">## LCN2            LCN2</span>
<span class="co">## SPINK1        SPINK1</span>
<span class="co">## CYP2A6.1      CYP2A6</span>
<span class="co">## HAMP            HAMP</span>
<span class="co">## APOF            APOF</span>
<span class="co">## ...              ...</span>
<span class="co">## CFHR5.1        CFHR5</span>
<span class="co">## GRAMD4.2      GRAMD4</span>
<span class="co">## SPINK1.6      SPINK1</span>
<span class="co">## NQO1.5          NQO1</span>
<span class="co">## CYP3A7.7      CYP3A7</span></code></pre>
<p>In the following, we perform gene set enrichment analysis for the DE genes of each Domain identified by DR-SC model using R package <code>gprofiler2</code>.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">gprofiler2</span><span class="op">)</span>
<span class="va">termList</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">8</span><span class="op">)</span> <span class="op">{</span>
    <span class="co"># k &lt;- 1</span>
    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">degs_sig</span><span class="op">$</span><span class="va">cluster</span> <span class="op">==</span> <span class="va">k</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span>
        <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"k = "</span>, <span class="va">k</span>, <span class="st">"\n"</span><span class="op">)</span>
        <span class="va">dat_degs_sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">degs_sig</span>, <span class="va">cluster</span> <span class="op">==</span> <span class="va">k</span><span class="op">)</span>

        <span class="va">que1</span> <span class="op">&lt;-</span> <span class="va">dat_degs_sub</span><span class="op">$</span><span class="va">gene</span>
        <span class="va">gostres</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/gprofiler2/man/gost.html" class="external-link">gost</a></span><span class="op">(</span>query <span class="op">=</span> <span class="va">que1</span>, organism <span class="op">=</span> <span class="st">"hsapiens"</span>, correction_method <span class="op">=</span> <span class="st">"fdr"</span><span class="op">)</span>
        <span class="va">termList</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">gostres</span>
    <span class="op">}</span>

<span class="op">}</span></code></pre></div>
<pre><code><span class="co">## k =  1 </span>
<span class="co">## k =  2 </span>
<span class="co">## k =  3 </span>
<span class="co">## k =  4 </span>
<span class="co">## k =  5 </span>
<span class="co">## k =  6 </span>
<span class="co">## k =  7 </span>
<span class="co">## k =  8</span></code></pre>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">termList</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">result</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##     query significant    p_value term_size query_size intersection_size</span>
<span class="co">## 1 query_1        TRUE 0.02257092         7          2                 1</span>
<span class="co">## 2 query_1        TRUE 0.02257092        10          2                 1</span>
<span class="co">## 3 query_1        TRUE 0.02257092         6          2                 1</span>
<span class="co">## 4 query_1        TRUE 0.02257092         9          2                 1</span>
<span class="co">## 5 query_1        TRUE 0.02257092         7          2                 1</span>
<span class="co">## 6 query_1        TRUE 0.02257092        14          2                 1</span>
<span class="co">##   precision     recall    term_id source</span>
<span class="co">## 1       0.5 0.14285714 GO:0090186  GO:BP</span>
<span class="co">## 2       0.5 0.10000000 GO:0090281  GO:BP</span>
<span class="co">## 3       0.5 0.16666667 GO:0097577  GO:BP</span>
<span class="co">## 4       0.5 0.11111111 GO:1900003  GO:BP</span>
<span class="co">## 5       0.5 0.14285714 GO:1902572  GO:BP</span>
<span class="co">## 6       0.5 0.07142857 GO:1901678  GO:BP</span>
<span class="co">##                                               term_name effective_domain_size</span>
<span class="co">## 1              regulation of pancreatic juice secretion                 21092</span>
<span class="co">## 2             negative regulation of calcium ion import                 21092</span>
<span class="co">## 3                              sequestering of iron ion                 21092</span>
<span class="co">## 4      regulation of serine-type endopeptidase activity                 21092</span>
<span class="co">## 5 negative regulation of serine-type peptidase activity                 21092</span>
<span class="co">## 6                    iron coordination entity transport                 21092</span>
<span class="co">##   source_order                                        parents</span>
<span class="co">## 1        21177 GO:0030157, GO:0044058, GO:0050878, GO:0051046</span>
<span class="co">## 2        21267             GO:0051926, GO:0070509, GO:0090279</span>
<span class="co">## 3        21858             GO:0006879, GO:0051238, GO:0051651</span>
<span class="co">## 4        23354                         GO:0052548, GO:1902571</span>
<span class="co">## 5        25729                         GO:0010466, GO:1902571</span>
<span class="co">## 6        24939                                     GO:0006826</span></code></pre>
<p>To understand the functions of the identified spatial domains by DR-SC model, we compare the top significant biological process (BP) pathways in GO database for the DE genes from Domain 1 and 2. Here, we only show to visualize the significant BP pathways and users can explore the other databases such as KEGG and HPA.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Most commonly used databases</span>
<span class="va">source_set</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"GO:BP"</span>, <span class="st">"GO:CC"</span>, <span class="st">"GO:MF"</span>, <span class="st">"KEGG"</span>, <span class="st">"HPA"</span><span class="op">)</span>
<span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"steelblue3"</span>, <span class="st">"goldenrod"</span>, <span class="st">"brown3"</span>, <span class="st">"#f98866"</span>, <span class="st">"#CE6DBD"</span><span class="op">)</span>
<span class="co">## Here, we show GO:BP</span>
<span class="va">source1</span> <span class="op">&lt;-</span> <span class="st">"GO:BP"</span>
<span class="va">ss</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">source_set</span> <span class="op">==</span> <span class="va">source1</span><span class="op">)</span>
<span class="va">ntop</span> <span class="op">=</span> <span class="fl">5</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cols</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">source_set</span>
<span class="va">pList_enrich</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">ii</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span> <span class="op">{</span>
    <span class="co">## ii &lt;- 5</span>
    <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"ii="</span>, <span class="va">ii</span><span class="op">)</span>
    <span class="va">gostres2</span> <span class="op">&lt;-</span> <span class="va">termList</span><span class="op">[[</span><span class="va">ii</span><span class="op">]</span><span class="op">]</span>
    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">gostres2</span><span class="op">$</span><span class="va">result</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
        <span class="va">dat1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">gostres2</span><span class="op">$</span><span class="va">result</span>, <span class="va">term_size</span> <span class="op">&lt;</span> <span class="fl">500</span><span class="op">)</span>
        <span class="va">dat1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_top_pathway.html">get_top_pathway</a></span><span class="op">(</span><span class="va">dat1</span>, ntop <span class="op">=</span> <span class="va">ntop</span>, source_set <span class="op">=</span> <span class="va">source1</span><span class="op">)</span>
        <span class="va">dat1</span> <span class="op">&lt;-</span> <span class="va">dat1</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html" class="external-link">complete.cases</a></span><span class="op">(</span><span class="va">dat1</span><span class="op">)</span>, <span class="op">]</span>
        <span class="va">dat1</span><span class="op">$</span><span class="va">nlog10P</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">dat1</span><span class="op">$</span><span class="va">p_value</span><span class="op">)</span>

        <span class="va">pList_enrich</span><span class="op">[[</span><span class="va">ii</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/barPlot_enrich.html">barPlot_enrich</a></span><span class="op">(</span><span class="va">dat1</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">dat1</span><span class="op">$</span><span class="va">nlog10P</span><span class="op">)</span>, <span class="op">]</span>, source <span class="op">=</span> <span class="st">"source"</span>, <span class="st">"term_name"</span>,
            <span class="st">"nlog10P"</span>, cols <span class="op">=</span> <span class="va">cols</span><span class="op">[</span><span class="va">source_set</span><span class="op">[</span><span class="va">ss</span><span class="op">]</span><span class="op">]</span>, base_size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ylab</span><span class="op">(</span><span class="st">"-log10(p-adj)"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">xlab</span><span class="op">(</span><span class="st">"Biological terms"</span><span class="op">)</span> <span class="op">+</span>
            <span class="fu">ggtitle</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Domain"</span>, <span class="va">ii</span><span class="op">)</span><span class="op">)</span>
    <span class="op">}</span>
<span class="op">}</span>
<span class="fu"><a href="../reference/drawFigs.html">drawFigs</a></span><span class="op">(</span><span class="va">pList_enrich</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span><span class="op">]</span>, layout.dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span>, common.legend <span class="op">=</span> <span class="cn">T</span>, align <span class="op">=</span> <span class="st">"hv"</span><span class="op">)</span></code></pre></div>
<p><img src="multibatch_HCC4_tutorial_files/figure-html/unnamed-chunk-23-1.png" width="700"></p>
<p>We take out the top DE genes for each cluster for visualization.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>
<span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">5</span>
<span class="va">dat_degs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="va">as.data.frame</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">cluster</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/top_n.html" class="external-link">top_n</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, wt <span class="op">=</span> <span class="va">avg_log2FC</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">topGene</span>
<span class="va">topGene</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 40 x 7</span></span>
<span class="co">## <span style="color: #949494;"># Groups:   cluster [8]</span></span>
<span class="co">##        p_val avg_log2FC pct.1 pct.2 p_val_adj cluster gene   </span>
<span class="co">##        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  </span>
<span class="co">## <span style="color: #BCBCBC;"> 1</span> 1.33<span style="color: #949494;">e</span><span style="color: #BB0000;">-302</span>      0.681 0.842 0.658 2.65<span style="color: #949494;">e</span><span style="color: #BB0000;">-299</span> 1       LCN2   </span>
<span class="co">## <span style="color: #BCBCBC;"> 2</span> 9.48<span style="color: #949494;">e</span><span style="color: #BB0000;">-239</span>      0.613 0.87  0.735 1.90<span style="color: #949494;">e</span><span style="color: #BB0000;">-235</span> 1       SPINK1 </span>
<span class="co">## <span style="color: #BCBCBC;"> 3</span> 2.98<span style="color: #949494;">e</span><span style="color: #BB0000;">-220</span>      0.492 0.896 0.766 5.96<span style="color: #949494;">e</span><span style="color: #BB0000;">-217</span> 1       CYP3A7 </span>
<span class="co">## <span style="color: #BCBCBC;"> 4</span> 1.38<span style="color: #949494;">e</span><span style="color: #BB0000;">-209</span>      0.482 0.816 0.629 2.75<span style="color: #949494;">e</span><span style="color: #BB0000;">-206</span> 1       GPC3   </span>
<span class="co">## <span style="color: #BCBCBC;"> 5</span> 1.11<span style="color: #949494;">e</span><span style="color: #BB0000;">-177</span>      0.487 0.85  0.715 2.21<span style="color: #949494;">e</span><span style="color: #BB0000;">-174</span> 1       AKR1B10</span>
<span class="co">## <span style="color: #BCBCBC;"> 6</span> 7.71<span style="color: #949494;">e</span><span style="color: #BB0000;">-270</span>      0.609 0.999 0.858 1.54<span style="color: #949494;">e</span><span style="color: #BB0000;">-266</span> 2       CYP2A6 </span>
<span class="co">## <span style="color: #BCBCBC;"> 7</span> 1.04<span style="color: #949494;">e</span><span style="color: #BB0000;">-209</span>      0.589 0.997 0.859 2.09<span style="color: #949494;">e</span><span style="color: #BB0000;">-206</span> 2       HAMP   </span>
<span class="co">## <span style="color: #BCBCBC;"> 8</span> 4.64<span style="color: #949494;">e</span><span style="color: #BB0000;">-192</span>      0.538 0.971 0.762 9.28<span style="color: #949494;">e</span><span style="color: #BB0000;">-189</span> 2       APOF   </span>
<span class="co">## <span style="color: #BCBCBC;"> 9</span> 2.49<span style="color: #949494;">e</span><span style="color: #BB0000;">-185</span>      0.556 0.999 0.858 4.99<span style="color: #949494;">e</span><span style="color: #BB0000;">-182</span> 2       MT1E   </span>
<span class="co">## <span style="color: #BCBCBC;">10</span> 4.42<span style="color: #949494;">e</span><span style="color: #BB0000;">-137</span>      0.604 0.999 0.907 8.84<span style="color: #949494;">e</span><span style="color: #BB0000;">-134</span> 2       RBP4   </span>
<span class="co">## <span style="color: #949494;"># ... with 30 more rows</span></span></code></pre>
<p>We visualize the DE genes for each cluster group by gene-by-cell heatmap using the <code><a href="../reference/GCHeatMap.html">GCHeatMap()</a></code> function.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GCHeatMap.html">GCHeatMap</a></span><span class="op">(</span><span class="va">speInt</span>, features <span class="op">=</span> <span class="va">topGene</span><span class="op">$</span><span class="va">gene</span>, grp_color <span class="op">=</span> <span class="va">cols_cluster</span>, y_text_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>
<span class="va">p1</span></code></pre></div>
<p><img src="multibatch_HCC4_tutorial_files/figure-html/unnamed-chunk-25-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="trajectory-inference">Trajectory inference<a class="anchor" aria-label="anchor" href="#trajectory-inference"></a>
</h2>
<p>Next, we performed trajectory inference using the aligned embeddings and domain labels estimated by PRECAST model.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">speInt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/AddTrajectory.html">AddTrajectory</a></span><span class="op">(</span><span class="va">speInt</span>, reduction <span class="op">=</span> <span class="st">"aligned.PRECAST"</span><span class="op">)</span>
<span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/EmbedPlot.html">EmbedPlot</a></span><span class="op">(</span><span class="va">speInt</span>, plotEmbeddings <span class="op">=</span> <span class="st">"aligned.PRECAST"</span>, colour_by <span class="op">=</span> <span class="st">"PT"</span><span class="op">)</span>
<span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/EmbedPlot.html">EmbedPlot</a></span><span class="op">(</span><span class="va">speInt</span>, plotEmbeddings <span class="op">=</span> <span class="st">"tSNE"</span>, colour_by <span class="op">=</span> <span class="st">"PT"</span><span class="op">)</span>
<span class="fu"><a href="../reference/drawFigs.html">drawFigs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span><span class="op">)</span>, layout.dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, common.legend <span class="op">=</span> <span class="cn">TRUE</span>, legend.position <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span></code></pre></div>
<p><img src="multibatch_HCC4_tutorial_files/figure-html/unnamed-chunk-26-1.png" width="700"></p>
<p>Visualize the inferred pseudotime on the spatial coordinates for each data batch.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p_spa</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/EachEmbedPlot.html">EachEmbedPlot</a></span><span class="op">(</span><span class="va">speInt</span>, reduction <span class="op">=</span> <span class="st">"Coord"</span>, colour_by <span class="op">=</span> <span class="st">"PT"</span>, layout.dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span>
<span class="va">p_spa</span></code></pre></div>
<p><img src="multibatch_HCC4_tutorial_files/figure-html/unnamed-chunk-27-1.png" width="700"></p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># save(SRTProj, file=paste0(SRTProj@projectMetadata$outputPath,'/SRTProj.rds'))</span>
<span class="co"># load('F:/Research</span>
<span class="co"># paper/IntegrateDRcluster/AnalysisCode/SRTpipeline/vignettes/Liver8/SRTProj.rds')</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="other-downstream-analyses">Other downstream analyses<a class="anchor" aria-label="anchor" href="#other-downstream-analyses"></a>
</h2>
<details><p><summary><strong>Session Info</strong></summary></p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## R version 4.1.2 (2021-11-01)</span>
<span class="co">## Platform: x86_64-w64-mingw32/x64 (64-bit)</span>
<span class="co">## Running under: Windows 10 x64 (build 22621)</span>
<span class="co">## </span>
<span class="co">## Matrix products: default</span>
<span class="co">## </span>
<span class="co">## locale:</span>
<span class="co">## [1] LC_COLLATE=Chinese (Simplified)_China.936 </span>
<span class="co">## [2] LC_CTYPE=Chinese (Simplified)_China.936   </span>
<span class="co">## [3] LC_MONETARY=Chinese (Simplified)_China.936</span>
<span class="co">## [4] LC_NUMERIC=C                              </span>
<span class="co">## [5] LC_TIME=Chinese (Simplified)_China.936    </span>
<span class="co">## </span>
<span class="co">## attached base packages:</span>
<span class="co">## [1] stats4    stats     graphics  grDevices utils     datasets  methods  </span>
<span class="co">## [8] base     </span>
<span class="co">## </span>
<span class="co">## other attached packages:</span>
<span class="co">##  [1] scater_1.25.1               scuttle_1.4.0              </span>
<span class="co">##  [3] slingshot_2.2.0             TrajectoryUtils_1.2.0      </span>
<span class="co">##  [5] princurve_2.1.6             gprofiler2_0.2.1           </span>
<span class="co">##  [7] bigalgebra_1.1.0            bigmemory_4.5.36           </span>
<span class="co">##  [9] SpatialExperiment_1.4.0     SingleCellExperiment_1.16.0</span>
<span class="co">## [11] SummarizedExperiment_1.24.0 Biobase_2.54.0             </span>
<span class="co">## [13] GenomicRanges_1.46.1        GenomeInfoDb_1.30.1        </span>
<span class="co">## [15] IRanges_2.28.0              MatrixGenerics_1.6.0       </span>
<span class="co">## [17] matrixStats_0.62.0          dplyr_1.0.9                </span>
<span class="co">## [19] ggplot2_3.3.6               colorspace_2.0-3           </span>
<span class="co">## [21] Matrix_1.4-0                hdf5r_1.3.5                </span>
<span class="co">## [23] ff_4.0.7                    bit_4.0.4                  </span>
<span class="co">## [25] S4Vectors_0.32.3            BiocGenerics_0.40.0        </span>
<span class="co">## [27] rhdf5_2.38.0                sp_1.5-0                   </span>
<span class="co">## [29] SeuratObject_4.1.0          Seurat_4.1.1               </span>
<span class="co">## [31] SRTpipeline_0.1.1          </span>
<span class="co">## </span>
<span class="co">## loaded via a namespace (and not attached):</span>
<span class="co">##   [1] scattermore_0.8           ggthemes_4.2.4           </span>
<span class="co">##   [3] R.methodsS3_1.8.1         GiRaF_1.0.1              </span>
<span class="co">##   [5] ragg_1.2.2                tidyr_1.2.0              </span>
<span class="co">##   [7] bit64_4.0.5               knitr_1.37               </span>
<span class="co">##   [9] irlba_2.3.5               DelayedArray_0.20.0      </span>
<span class="co">##  [11] R.utils_2.11.0            data.table_1.14.2        </span>
<span class="co">##  [13] rpart_4.1.16              RCurl_1.98-1.6           </span>
<span class="co">##  [15] generics_0.1.2            ScaledMatrix_1.2.0       </span>
<span class="co">##  [17] cowplot_1.1.1             RANN_2.6.1               </span>
<span class="co">##  [19] future_1.26.1             spatstat.data_3.0-0      </span>
<span class="co">##  [21] httpuv_1.6.5              assertthat_0.2.1         </span>
<span class="co">##  [23] viridis_0.6.2             xfun_0.29                </span>
<span class="co">##  [25] jquerylib_0.1.4           evaluate_0.15            </span>
<span class="co">##  [27] promises_1.2.0.1          fansi_1.0.3              </span>
<span class="co">##  [29] igraph_1.3.5              DBI_1.1.2                </span>
<span class="co">##  [31] htmlwidgets_1.5.4         spatstat.geom_2.4-0      </span>
<span class="co">##  [33] purrr_0.3.4               ellipsis_0.3.2           </span>
<span class="co">##  [35] RSpectra_0.16-1           ggpubr_0.4.0             </span>
<span class="co">##  [37] backports_1.4.1           DR.SC_3.1                </span>
<span class="co">##  [39] deldir_1.0-6              sparseMatrixStats_1.6.0  </span>
<span class="co">##  [41] vctrs_0.4.1               ROCR_1.0-11              </span>
<span class="co">##  [43] abind_1.4-5               cachem_1.0.6             </span>
<span class="co">##  [45] withr_2.5.0               PRECAST_1.4              </span>
<span class="co">##  [47] progressr_0.10.1          sctransform_0.3.3        </span>
<span class="co">##  [49] mclust_5.4.10             goftest_1.2-3            </span>
<span class="co">##  [51] cluster_2.1.2             lazyeval_0.2.2           </span>
<span class="co">##  [53] crayon_1.5.1              SpatialAnno_1.0.0        </span>
<span class="co">##  [55] edgeR_3.36.0              pkgconfig_2.0.3          </span>
<span class="co">##  [57] labeling_0.4.2            nlme_3.1-155             </span>
<span class="co">##  [59] vipor_0.4.5               rlang_1.0.2              </span>
<span class="co">##  [61] globals_0.15.0            lifecycle_1.0.1          </span>
<span class="co">##  [63] miniUI_0.1.1.1            bigmemory.sri_0.1.3      </span>
<span class="co">##  [65] rsvd_1.0.5                rprojroot_2.0.3          </span>
<span class="co">##  [67] polyclip_1.10-0           lmtest_0.9-40            </span>
<span class="co">##  [69] SC.MEB_1.1                carData_3.0-5            </span>
<span class="co">##  [71] Rhdf5lib_1.16.0           zoo_1.8-10               </span>
<span class="co">##  [73] beeswarm_0.4.0            ggridges_0.5.3           </span>
<span class="co">##  [75] rjson_0.2.21              png_0.1-7                </span>
<span class="co">##  [77] viridisLite_0.4.0         iSC.MEB_1.0.1            </span>
<span class="co">##  [79] bitops_1.0-7              R.oo_1.24.0              </span>
<span class="co">##  [81] KernSmooth_2.23-20        rhdf5filters_1.6.0       </span>
<span class="co">##  [83] DelayedMatrixStats_1.16.0 stringr_1.4.0            </span>
<span class="co">##  [85] parallelly_1.32.0         spatstat.random_2.2-0    </span>
<span class="co">##  [87] rstatix_0.7.0             ggsignif_0.6.3           </span>
<span class="co">##  [89] beachmat_2.10.0           scales_1.2.0             </span>
<span class="co">##  [91] memoise_2.0.1             magrittr_2.0.3           </span>
<span class="co">##  [93] plyr_1.8.7                ica_1.0-2                </span>
<span class="co">##  [95] zlibbioc_1.40.0           compiler_4.1.2           </span>
<span class="co">##  [97] dqrng_0.3.0               RColorBrewer_1.1-3       </span>
<span class="co">##  [99] fitdistrplus_1.1-8        cli_3.2.0                </span>
<span class="co">## [101] XVector_0.34.0            listenv_0.8.0            </span>
<span class="co">## [103] patchwork_1.1.1           pbapply_1.5-0            </span>
<span class="co">## [105] formatR_1.11              MASS_7.3-55              </span>
<span class="co">## [107] mgcv_1.8-39               tidyselect_1.1.2         </span>
<span class="co">## [109] stringi_1.7.6             textshaping_0.3.6        </span>
<span class="co">## [111] highr_0.9                 yaml_2.3.6               </span>
<span class="co">## [113] locfit_1.5-9.4            BiocSingular_1.10.0      </span>
<span class="co">## [115] ggrepel_0.9.1             grid_4.1.2               </span>
<span class="co">## [117] sass_0.4.1                tools_4.1.2              </span>
<span class="co">## [119] future.apply_1.9.0        parallel_4.1.2           </span>
<span class="co">## [121] rstudioapi_0.13           gridExtra_2.3            </span>
<span class="co">## [123] farver_2.1.0              Rtsne_0.16               </span>
<span class="co">## [125] DropletUtils_1.14.2       digest_0.6.29            </span>
<span class="co">## [127] rgeos_0.5-9               shiny_1.7.1              </span>
<span class="co">## [129] Rcpp_1.0.10               car_3.0-12               </span>
<span class="co">## [131] broom_0.7.12              later_1.3.0              </span>
<span class="co">## [133] RcppAnnoy_0.0.19          httr_1.4.3               </span>
<span class="co">## [135] fs_1.5.2                  tensor_1.5               </span>
<span class="co">## [137] reticulate_1.25           splines_4.1.2            </span>
<span class="co">## [139] uwot_0.1.11               spatstat.utils_3.0-1     </span>
<span class="co">## [141] pkgdown_2.0.6             plotly_4.10.0            </span>
<span class="co">## [143] systemfonts_1.0.4         xtable_1.8-4             </span>
<span class="co">## [145] jsonlite_1.8.0            R6_2.5.1                 </span>
<span class="co">## [147] pillar_1.7.0              htmltools_0.5.2          </span>
<span class="co">## [149] mime_0.12                 glue_1.6.2               </span>
<span class="co">## [151] fastmap_1.1.0             BiocParallel_1.28.3      </span>
<span class="co">## [153] BiocNeighbors_1.12.0      codetools_0.2-18         </span>
<span class="co">## [155] utf8_1.2.2                lattice_0.20-45          </span>
<span class="co">## [157] bslib_0.3.1               spatstat.sparse_2.1-1    </span>
<span class="co">## [159] tibble_3.1.7              ggbeeswarm_0.6.0         </span>
<span class="co">## [161] leiden_0.4.2              gtools_3.9.2.2           </span>
<span class="co">## [163] magick_2.7.3              limma_3.50.1             </span>
<span class="co">## [165] survival_3.2-13           CompQuadForm_1.4.3       </span>
<span class="co">## [167] rmarkdown_2.11            desc_1.4.0               </span>
<span class="co">## [169] munsell_0.5.0             GenomeInfoDbData_1.2.7   </span>
<span class="co">## [171] HDF5Array_1.22.1          reshape2_1.4.4           </span>
<span class="co">## [173] gtable_0.3.0              spatstat.core_2.4-4</span></code></pre>
</details>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Wei Liu, Yi Yang, Xu Liao, Xiao Zhang, Jin Liu.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
