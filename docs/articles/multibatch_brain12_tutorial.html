<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fast and accurate multiple data integration • SRTpipeline</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Fast and accurate multiple data integration">
<meta property="og:description" content="SRTpipeline">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">SRTpipeline</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="../articles/Installation.html">
    <span class="fas fa-book"></span>
     
    Install
  </a>
</li>
<li>
  <a href="../articles/get_started.html">
    <span class="fas fa-book"></span>
     
    Get Started
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-book"></span>
     
    Single Data Analysis
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/single_basic_tutorial.html">Basic overview</a>
    </li>
    <li>
      <a href="../articles/dlpfc_tutorial.html">Analyze a human DLPFC section</a>
    </li>
    <li>
      <a href="../articles/single_Embryo_SC_tutorial.html">Analyze a mouse embryo section</a>
    </li>
    <li>
      <a href="../articles/single_Embryo_DRSC_tutorial.html">Analyze a mouse embryo section v2</a>
    </li>
    <li>
      <a href="../articles/single_MOB_Anno_tutorial.html">Analyze a mouse olfactory bulb section</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-book"></span>
     
    Multiple Data Analysis
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/multibatch_basic_tutorial.html">Basic overview</a>
    </li>
    <li>
      <a href="../articles/integration_introduction.html">Integration introduction</a>
    </li>
    <li>
      <a href="../articles/multibatch_brain12_tutorial.html">Integrate three human DLPFC slices</a>
    </li>
    <li>
      <a href="../articles/multibatch_HCC4_tutorial.html">Integrate four human HCC slices</a>
    </li>
    <li>
      <a href="../articles/multibatch_liver8_tutorial.html">Integrate eight mouse liver slices</a>
    </li>
    <li>
      <a href="../articles/multibatch_BS2_tutorial.html">Integrate two human breast cancer slices</a>
    </li>
    <li>
      <a href="../articles/integration_large_datasets.html">Tips for integrating large datasets</a>
    </li>
  </ul>
</li>
<li>
  <a href="../articles/faq.html">
    <span class="fa fa-question-circle-o"></span>
     
    FAQ
  </a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li>
  <a href="../reference/index.html">
    <span class="fa fa-file-code-o"></span>
     
    Functions
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Fast and accurate multiple data integration</h1>
            
            <h4 data-toc-skip class="date">Compiled: 二月 23, 2023</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/feiyoung/SRTpipeline/blob/HEAD/vignettes/multibatch_brain12_tutorial.Rmd"><code>vignettes/multibatch_brain12_tutorial.Rmd</code></a></small>
      <div class="hidden name"><code>multibatch_brain12_tutorial.Rmd</code></div>

    </div>

    
    
<hr>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>This tutorial demonstrates how to use <code>SRTpipeline</code> (&gt;=0.1.0) to analyze multiple spatially-resolved transcriptomics (SRT) data. We emphases how to use iSC.MEB model for spatial clustering and integration and its followed applications based on <code>SRTProject</code> object in the <code>SRTpipeline</code> package. This tutorial will cover the following tasks, which we believe will be common for many spatial analyses:</p>
<ul>
<li>Normalization</li>
<li>Feature selection</li>
<li>Spatial clustering</li>
<li>Data integration</li>
<li>Batch-corrected gene expression</li>
<li>DEG analysis</li>
<li>Spatial trajectory inference</li>
<li>Visualization</li>
</ul>
<p>First, we load <code>SRTpipeline</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/feiyoung/SRTpipeline">SRTpipeline</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2023</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="dataset">Dataset<a class="anchor" aria-label="anchor" href="#dataset"></a>
</h2>
<p>For this tutorial, we will introduce how to create a <code>SRTProject</code> object with multiple SRT samples using SRTpipeline that includes an introduction to common analytical workflows for multiple data batches. Here, we will be taking spatial transcriptomics dataset for human dorsolateral prefrontal cortex (DLPFC) as an example. There are three tissue slices from the various donors with 3500~4500 spots and 33538 genes that were sequenced on the 10x Visium platform. Our preprocessed data can be downloaded <a href="https://github.com/feiyoung/DR-SC.Analysis/blob/main/data/DLPFC_data/" class="external-link">here</a>, and the raw data can be found <a href="https://github.com/LieberInstitute/spatialLIBD" class="external-link">here</a>.</p>
<p>Next, we download the data to the current working path for the followed analysis by the following command:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">name_ID12</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">151507</span>, <span class="fl">151669</span>, <span class="fl">151673</span><span class="op">)</span><span class="op">)</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">r</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">name_ID12</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">githubURL</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"https://github.com/feiyoung/DR-SC.Analysis/blob/main/data/DLPFC_data/"</span>,
        <span class="va">name_ID12</span><span class="op">[</span><span class="va">r</span><span class="op">]</span>, <span class="st">".rds?raw=true"</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span><span class="va">githubURL</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"dlpfc_"</span>, <span class="va">name_ID12</span><span class="op">[</span><span class="va">r</span><span class="op">]</span>, <span class="st">".rds"</span><span class="op">)</span>, mode <span class="op">=</span> <span class="st">"wb"</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="pre-processing-workflow">Pre-processing workflow<a class="anchor" aria-label="anchor" href="#pre-processing-workflow"></a>
</h2>
<p>Then load to R and prepare for creating the <code>SRTProject</code> object.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dir_file</span> <span class="op">&lt;-</span> <span class="st">"D:/LearnFiles/Research paper/ProPCA/DR-SC.Analysis/data/DLPFC_data/"</span>
<span class="va">name_ID12</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">151507</span>, <span class="fl">151669</span>, <span class="fl">151673</span><span class="op">)</span><span class="op">)</span>
<span class="co"># dir_file &lt;- './dlpfc_'</span>
<span class="va">n_sample</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">name_ID12</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://satijalab.org/seurat" class="external-link">Seurat</a></span><span class="op">)</span>
<span class="co">## create count matrix list: note each component has a name, i.e., `ID151672`.</span>
<span class="va">cntList</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">## create spatial coordinate matrix</span>
<span class="va">coordList</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">## create metadata list</span>
<span class="va">metadataList</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">r</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_sample</span><span class="op">)</span> <span class="op">{</span>
    <span class="co"># r &lt;- 1</span>
    <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"r = "</span>, <span class="va">r</span><span class="op">)</span>
    <span class="va">id</span> <span class="op">&lt;-</span> <span class="va">name_ID12</span><span class="op">[</span><span class="va">r</span><span class="op">]</span>
    <span class="va">dlpfc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">dir_file</span>, <span class="va">id</span>, <span class="st">".rds"</span><span class="op">)</span><span class="op">)</span>
    <span class="va">sp_count</span> <span class="op">&lt;-</span> <span class="va">dlpfc</span><span class="op">@</span><span class="va">assays</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">counts</span>
    <span class="va">meta.data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>annotated_label <span class="op">=</span> <span class="va">dlpfc</span><span class="op">$</span><span class="va">layer_guess_reordered</span>, row <span class="op">=</span> <span class="va">dlpfc</span><span class="op">$</span><span class="va">row</span>, col <span class="op">=</span> <span class="va">dlpfc</span><span class="op">$</span><span class="va">col</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">meta.data</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">sp_count</span><span class="op">)</span>
    <span class="va">cntList</span><span class="op">[[</span><span class="va">r</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">sp_count</span>
    <span class="va">metadataList</span><span class="op">[[</span><span class="va">r</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">meta.data</span>
    <span class="va">coordList</span><span class="op">[[</span><span class="va">r</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>row <span class="op">=</span> <span class="va">dlpfc</span><span class="op">$</span><span class="va">row</span>, col <span class="op">=</span> <span class="va">dlpfc</span><span class="op">$</span><span class="va">col</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cntList</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">name_ID12</span>
<span class="co">## create meta data for each data batches. Here we only have one data batch.</span>
<span class="va">sampleMetadata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Human"</span>, <span class="va">n_sample</span><span class="op">)</span>, tissues <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"DLPFC"</span>, <span class="va">n_sample</span><span class="op">)</span>,
    donor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, each <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">sampleMetadata</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cntList</span><span class="op">)</span>
<span class="co">## Name of this project</span>
<span class="va">projectName</span> <span class="op">&lt;-</span> <span class="st">"DLPFC3"</span></code></pre></div>
<p>We check the data by printing it. We can see there are 3500~4500 spots and 33538 genes for each data batch.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">cntList</span>, <span class="va">dim</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##      151507 151669 151673</span>
<span class="co">## [1,]  33538  33538  33538</span>
<span class="co">## [2,]   4226   3661   3639</span></code></pre>
<p>Check whether each data batch has the same genes: Yes.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">geneNamesList</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">cntList</span>, <span class="va">row.names</span><span class="op">)</span>
<span class="va">shared_genes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/funprog.html" class="external-link">Reduce</a></span><span class="op">(</span><span class="va">intersect</span>, <span class="va">geneNamesList</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">shared_genes</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] 33538</span></code></pre>
<div class="section level3">
<h3 id="create-a-srtproject-object">Create a SRTProject object<a class="anchor" aria-label="anchor" href="#create-a-srtproject-object"></a>
</h3>
<p>First, we show how to create a SRTProject object step by step.</p>
<p>Because the gene name is ensembl in this data, we change the genes’ ensembl name to symbols for convenience of followed analyses.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cntList</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">cntList</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">[</span><span class="va">shared_genes</span>, <span class="op">]</span><span class="op">)</span>
<span class="co">## Use eg.db database: this method is fast</span>
<span class="va">symbol_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/transferGeneNames.html">transferGeneNames</a></span><span class="op">(</span><span class="va">shared_genes</span>, now_name <span class="op">=</span> <span class="st">"ensembl"</span>, to_name <span class="op">=</span> <span class="st">"symbol"</span>, species <span class="op">=</span> <span class="st">"Human"</span>,
    Method <span class="op">=</span> <span class="st">"eg.db"</span><span class="op">)</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">r</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_sample</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">cntList</span><span class="op">[[</span><span class="va">r</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">symbol_name</span>
<span class="op">}</span>
<span class="va">symbol_name</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span></code></pre></div>
<pre><code><span class="co">##  [1] "ENSG00000243485" "Fam138a"         "Or4f5"           "Loc100996442"   </span>
<span class="co">##  [5] "ENSG00000239945" "ENSG00000239906" "ENSG00000241599" "ENSG00000236601"</span>
<span class="co">##  [9] "Or4f29"          "ENSG00000235146"</span></code></pre>
<p>Next, we start creating SRTProject object. We can print the basic information of this object, including three parts. The first part have the class of this object, outputPath of data that require to output, h5filePath that save the memory-cusuming data (i.e., count, logcount, …). The second part is about the datasets basic information, such as how many data batches(sample) and the data names, sample meta data (sampleColData) and meta data for each spot (cellMetaData). The last part is about downstream analyses information that is empty when this object created.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SRTProj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CreateSRTProject.html">CreateSRTProject</a></span><span class="op">(</span><span class="va">cntList</span>, <span class="va">coordList</span>, projectName <span class="op">=</span> <span class="va">projectName</span>, <span class="va">metadataList</span>, <span class="va">sampleMetadata</span>,
    min.spots <span class="op">=</span> <span class="fl">20</span>, min.genes <span class="op">=</span> <span class="fl">20</span>, force <span class="op">=</span> <span class="cn">F</span><span class="op">)</span>
<span class="va">SRTProj</span></code></pre></div>
<pre><code><span class="co">## class: SRTProject </span>
<span class="co">## outputPath: F:\Research paper\IntegrateDRcluster\AnalysisCode\SRTpipeline\vignettes\DLPFC3 </span>
<span class="co">## h5filePath: F:\Research paper\IntegrateDRcluster\AnalysisCode\SRTpipeline\vignettes\DLPFC3/DLPFC3.h5 </span>
<span class="co">## ---------Datasets basic information-----------------</span>
<span class="co">## samples(3): 151507 151669 151673</span>
<span class="co">## sampleColData names(4): species tissues donor NumOfSpots</span>
<span class="co">## cellMetaData names(4): annotated_label row col batch</span>
<span class="co">## numberOfSpots(3): 4226 3661 3639</span>
<span class="co">## ---------Downstream analyses information-----------------</span>
<span class="co">## Low-dimensional embeddings(0):</span>
<span class="co">## Inferred cluster labels: No</span>
<span class="co">## Embedding for plotting(0):</span></code></pre>
<details><p><summary><strong>What does data in a h5 file look like?</strong></summary></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">h5ls</span><span class="op">(</span><span class="va">SRTProj</span><span class="op">@</span><span class="va">projectMetadata</span><span class="op">$</span><span class="va">h5filePath</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##             group           name       otype   dclass       dim</span>
<span class="co">## 0               /  SpatialCoords H5I_DATASET  INTEGER 11526 x 2</span>
<span class="co">## 1               /   cellMetaData H5I_DATASET COMPOUND     11526</span>
<span class="co">## 2               /          count   H5I_GROUP                   </span>
<span class="co">## 3          /count        count_1   H5I_GROUP                   </span>
<span class="co">## 4  /count/count_1            Dim H5I_DATASET  INTEGER         2</span>
<span class="co">## 5  /count/count_1      cellNames H5I_DATASET   STRING      4226</span>
<span class="co">## 6  /count/count_1           data H5I_DATASET    FLOAT   5908955</span>
<span class="co">## 7  /count/count_1      geneNames H5I_DATASET   STRING     13929</span>
<span class="co">## 8  /count/count_1        indices H5I_DATASET  INTEGER   5908955</span>
<span class="co">## 9  /count/count_1         indptr H5I_DATASET  INTEGER      4227</span>
<span class="co">## 10         /count        count_2   H5I_GROUP                   </span>
<span class="co">## 11 /count/count_2            Dim H5I_DATASET  INTEGER         2</span>
<span class="co">## 12 /count/count_2      cellNames H5I_DATASET   STRING      3661</span>
<span class="co">## 13 /count/count_2           data H5I_DATASET    FLOAT   6533642</span>
<span class="co">## 14 /count/count_2      geneNames H5I_DATASET   STRING     13929</span>
<span class="co">## 15 /count/count_2        indices H5I_DATASET  INTEGER   6533642</span>
<span class="co">## 16 /count/count_2         indptr H5I_DATASET  INTEGER      3662</span>
<span class="co">## 17         /count        count_3   H5I_GROUP                   </span>
<span class="co">## 18 /count/count_3            Dim H5I_DATASET  INTEGER         2</span>
<span class="co">## 19 /count/count_3      cellNames H5I_DATASET   STRING      3639</span>
<span class="co">## 20 /count/count_3           data H5I_DATASET    FLOAT   7943259</span>
<span class="co">## 21 /count/count_3      geneNames H5I_DATASET   STRING     13929</span>
<span class="co">## 22 /count/count_3        indices H5I_DATASET  INTEGER   7943259</span>
<span class="co">## 23 /count/count_3         indptr H5I_DATASET  INTEGER      3640</span>
<span class="co">## 24              / sampleMetadata H5I_DATASET COMPOUND         3</span>
<span class="co">## 25              /    samplenames H5I_DATASET   STRING         3</span></code></pre>
</details>
</div>
<div class="section level3">
<h3 id="normalizing-the-data">Normalizing the data<a class="anchor" aria-label="anchor" href="#normalizing-the-data"></a>
</h3>
<p>After removing unwanted cells and genes from the dataset, the next step is to normalize the data. To save RAM memory, normalized values are stored in disk as a <code>h5file</code>.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SRTProj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/normalizeSRT.html">normalizeSRT</a></span><span class="op">(</span><span class="va">SRTProj</span>, normalization.method <span class="op">=</span> <span class="st">"LogNormalize"</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="feature-selection">Feature selection<a class="anchor" aria-label="anchor" href="#feature-selection"></a>
</h2>
<p>We next select a subset of genes that exhibit high spot-to-spot variation in the dataset (i.e, they are highly expressed in some spots, and lowly expressed in others). It has been found that focusing on these genes in downstream analysis helps to highlight biological signal in single-cell datasets <a href="https://www.nature.com/articles/nmeth.2645" class="external-link">here</a>.</p>
<p>Then we choose variable features. The default number of variable features is 2,000, and users can change it using argument <code>nfeatures</code>. The default type is highly variable genes (HVGs), but users can use spatially variable genes by seting <code>type='SVGs'</code>, then <code>SPARK-X</code> will be used to choose SVGs. ## Choose highly variable features We can also directly use <code><a href="https://satijalab.org/seurat/reference/FindVariableFeatures.html" class="external-link">FindVariableFeatures()</a></code> to choose the top highly variable genes (HVGs). We found the performance of using SVGs or HVGs has no significant difference for the downstream analyses, such as dimension reduction and spatial clustering.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SRTProj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/selectVariableFeatures.html">selectVariableFeatures</a></span><span class="op">(</span><span class="va">SRTProj</span>, nfeatures <span class="op">=</span> <span class="fl">2000</span>, type <span class="op">=</span> <span class="st">"HVGs"</span>, method <span class="op">=</span> <span class="st">"vst"</span><span class="op">)</span>
<span class="va">SRTProj</span></code></pre></div>
<pre><code><span class="co">## class: SRTProject </span>
<span class="co">## outputPath: F:\Research paper\IntegrateDRcluster\AnalysisCode\SRTpipeline\vignettes\DLPFC3 </span>
<span class="co">## h5filePath: F:\Research paper\IntegrateDRcluster\AnalysisCode\SRTpipeline\vignettes\DLPFC3/DLPFC3.h5 </span>
<span class="co">## ---------Datasets basic information-----------------</span>
<span class="co">## samples(3): 151507 151669 151673</span>
<span class="co">## sampleColData names(4): species tissues donor NumOfSpots</span>
<span class="co">## cellMetaData names(4): annotated_label row col batch</span>
<span class="co">## numberOfSpots(3): 4226 3661 3639</span>
<span class="co">## ---------Downstream analyses information-----------------</span>
<span class="co">## Variable features:  2000 </span>
<span class="co">## Low-dimensional embeddings(0):</span>
<span class="co">## Inferred cluster labels: No</span>
<span class="co">## Embedding for plotting(0):</span></code></pre>
<div class="section level3">
<h3 id="choose-spatially-variable-features">Choose spatially variable features<a class="anchor" aria-label="anchor" href="#choose-spatially-variable-features"></a>
</h3>
<p>We first applied the SPARK-X to choose the top spatially variable genes (SVGs). SPARK-X is embeded in the <code>DR.SC</code> R package and is implement in the <code>FindSVGs()</code> function. By default, we return 2,000 genes per dataset. These will be used in downstream analysis, like probabilistic embeddings and spatial clustering. To further speed up the computation, we first use <code><a href="https://satijalab.org/seurat/reference/FindVariableFeatures.html" class="external-link">FindVariableFeatures()</a></code> to select 5,000 highly variable genes, then use SPARK-X to choose top SVGs in the implementation of <code>FindSVGs()</code> function. The selected SVGs are saved in <code>dlpfc@assays$RNA@var.features</code>.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># SRTProj &lt;- selectVariableFeatures(SRTProj,nfeatures = 2000, type = 'SVGs', method='SPARK-X')</span></code></pre></div>
<p>Calculate the adjcence matrix</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Obtain adjacence matrix</span>
<span class="va">SRTProj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/AddAdj.html">AddAdj</a></span><span class="op">(</span><span class="va">SRTProj</span>, platform <span class="op">=</span> <span class="st">"Visium"</span><span class="op">)</span></code></pre></div>
<p>Visualize</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">selectFeatures</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">SRTProj</span><span class="op">@</span><span class="va">geneMetaData</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">SRTProj</span><span class="op">@</span><span class="va">geneMetaData</span><span class="op">$</span><span class="va">`isVGs#combine`</span><span class="op">)</span>, <span class="op">]</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span>
<span class="fu"><a href="../reference/EachExprSpaHeatMap.html">EachExprSpaHeatMap</a></span><span class="op">(</span><span class="va">SRTProj</span>, batch <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, features <span class="op">=</span> <span class="va">selectFeatures</span>, title_name <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></code></pre></div>
<p><img src="multibatch_brain12_tutorial_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="dimension-reduction">Dimension reduction<a class="anchor" aria-label="anchor" href="#dimension-reduction"></a>
</h2>
<p>PCA is the most popular dimension reduction technique in single cell RNA sequencing (scRNA-seq) data and SRT　data because of its simplicity, computational efficiency, and relatively comparable performance. SRTpipeline provided three versions of PCA: standard PCA (PCA), approximated PCA (APCA), and weighted PCA (WPCA) by the function <code>AddPCA</code> with default version as APCA for fastest computation. The 15-dimensional PCs are extracted by default, and users can use their own values.</p>
<p>After running <code>AddPCA</code>, we would see the output of <code>SRTProj</code> includes <code>PCA</code> in the <code>Low-dimensional embeddings</code> field.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SRTProj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/AddPCA.html">AddPCA</a></span><span class="op">(</span><span class="va">SRTProj</span>, Method <span class="op">=</span> <span class="st">"PCA"</span><span class="op">)</span>
<span class="co"># weighted PCA SRTProj &lt;- AddPCA(SRTProj, Method='WPCA')</span>
<span class="va">SRTProj</span></code></pre></div>
<pre><code><span class="co">## class: SRTProject </span>
<span class="co">## outputPath: F:\Research paper\IntegrateDRcluster\AnalysisCode\SRTpipeline\vignettes\DLPFC3 </span>
<span class="co">## h5filePath: F:\Research paper\IntegrateDRcluster\AnalysisCode\SRTpipeline\vignettes\DLPFC3/DLPFC3.h5 </span>
<span class="co">## ---------Datasets basic information-----------------</span>
<span class="co">## samples(3): 151507 151669 151673</span>
<span class="co">## sampleColData names(4): species tissues donor NumOfSpots</span>
<span class="co">## cellMetaData names(4): annotated_label row col batch</span>
<span class="co">## numberOfSpots(3): 4226 3661 3639</span>
<span class="co">## ---------Downstream analyses information-----------------</span>
<span class="co">## Variable features:  2000 </span>
<span class="co">## Low-dimensional embeddings(1): PCA</span>
<span class="co">## Inferred cluster labels: No</span>
<span class="co">## Embedding for plotting(0):</span></code></pre>
</div>
<div class="section level2">
<h2 id="multiple-sample-integration-analysis-using-isc-meb-model">Multiple sample integration analysis using iSC.MEB model<a class="anchor" aria-label="anchor" href="#multiple-sample-integration-analysis-using-isc-meb-model"></a>
</h2>
<p>iSC.MEB model achieves joint clustering and alignment by integration analysis for multiple samples. Some SRT clustering methods use Markov random field to model clusters of spots. These approaches work extremely well and are a standard practice in scRNA-seq. For this reason, SRTpipeline uses existing state-of-the-art clustering methods from SRT packages for clustering.</p>
<p>We have had the most success using the graph clustering approach implemented by Seurat. In ArchR, clustering is performed using the addClusters() function which permits additional clustering parameters to be passed to the <code><a href="https://rdrr.io/pkg/SC.MEB/man/SC.MEB.html" class="external-link">SC.MEB::SC.MEB()</a></code> function via. In our hands, clustering using Seurat::FindClusters() is deterministic, meaning that the exact same input will always result in the exact same output.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SRTProj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Integrate_iSCMEB.html">Integrate_iSCMEB</a></span><span class="op">(</span><span class="va">SRTProj</span>, K <span class="op">=</span> <span class="fl">7</span>, reduction <span class="op">=</span> <span class="st">"PCA"</span>, init.start <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></code></pre></div>
<pre><code>## fitting ...
## 
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |===================================                                   |  50%
  |                                                                            
  |======================================================================| 100%
## fitting ...
## 
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |===================================                                   |  50%
  |                                                                            
  |======================================================================| 100%
## fitting ...
## 
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |===================================                                   |  50%
  |                                                                            
  |======================================================================| 100%
## fitting ...
## 
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |===================================                                   |  50%
  |                                                                            
  |======================================================================| 100%
## fitting ...
## 
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |===================================                                   |  50%
  |                                                                            
  |======================================================================| 100%
## Finish variable initialization 
## K = 7, iter = 2, loglik= -128198.503203, dloglik=0.999940 
## K = 7, iter = 3, loglik= -115952.203556, dloglik=0.095526 
## K = 7, iter = 4, loglik= -108543.160651, dloglik=0.063897 
## K = 7, iter = 5, loglik= -102090.438705, dloglik=0.059448 
## K = 7, iter = 6, loglik= -98110.071418, dloglik=0.038989 
## K = 7, iter = 7, loglik= -95115.651558, dloglik=0.030521 
## K = 7, iter = 8, loglik= -92827.787750, dloglik=0.024053 
## K = 7, iter = 9, loglik= -91087.896591, dloglik=0.018743 
## K = 7, iter = 10, loglik= -89750.370517, dloglik=0.014684 
## K = 7, iter = 11, loglik= -88721.667222, dloglik=0.011462 
## K = 7, iter = 12, loglik= -87938.954967, dloglik=0.008822 
## K = 7, iter = 13, loglik= -87343.710325, dloglik=0.006769 
## K = 7, iter = 14, loglik= -86773.371863, dloglik=0.006530 
## K = 7, iter = 15, loglik= -86478.920339, dloglik=0.003393 
## K = 7, iter = 16, loglik= -86175.174652, dloglik=0.003512 
## K = 7, iter = 17, loglik= -85908.423991, dloglik=0.003095 
## K = 7, iter = 18, loglik= -85727.649644, dloglik=0.002104 
## K = 7, iter = 19, loglik= -85542.893353, dloglik=0.002155 
## K = 7, iter = 20, loglik= -85389.825434, dloglik=0.001789 
## K = 7, iter = 21, loglik= -85236.504733, dloglik=0.001796 
## K = 7, iter = 22, loglik= -85110.273185, dloglik=0.001481 
## K = 7, iter = 23, loglik= -84984.569353, dloglik=0.001477 
## K = 7, iter = 24, loglik= -84881.239797, dloglik=0.001216 
## K = 7, iter = 25, loglik= -84803.291573, dloglik=0.000918</code></pre>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SRTProj</span></code></pre></div>
<pre><code><span class="co">## class: SRTProject </span>
<span class="co">## outputPath: F:\Research paper\IntegrateDRcluster\AnalysisCode\SRTpipeline\vignettes\DLPFC3 </span>
<span class="co">## h5filePath: F:\Research paper\IntegrateDRcluster\AnalysisCode\SRTpipeline\vignettes\DLPFC3/DLPFC3.h5 </span>
<span class="co">## ---------Datasets basic information-----------------</span>
<span class="co">## samples(3): 151507 151669 151673</span>
<span class="co">## sampleColData names(4): species tissues donor NumOfSpots</span>
<span class="co">## cellMetaData names(4): annotated_label row col batch</span>
<span class="co">## numberOfSpots(3): 4226 3661 3639</span>
<span class="co">## ---------Downstream analyses information-----------------</span>
<span class="co">## Variable features:  2000 </span>
<span class="co">## Low-dimensional embeddings(3): PCA microEnv.iSC.MEB aligned.iSC.MEB</span>
<span class="co">## Inferred cluster labels: Yes</span>
<span class="co">## Embedding for plotting(0):</span></code></pre>
<p>The estimated embeddings are saved in the slot<code>reductions$DR.SC</code> and the spatial clusters are saved in the slot <code>clusters$DR.SC</code>.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SRTProj</span><span class="op">@</span><span class="va">reductions</span></code></pre></div>
<pre><code><span class="co">## List of length 3</span>
<span class="co">## names(3): PCA microEnv.iSC.MEB aligned.iSC.MEB</span></code></pre>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">SRTProj</span><span class="op">@</span><span class="va">clusters</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## </span>
<span class="co">##    1    2    3    4    5    6    7 </span>
<span class="co">## 2659 2949 2040  467 1039 1727  645</span></code></pre>
<div class="section level3">
<h3 id="srt-embeddings">SRT embeddings<a class="anchor" aria-label="anchor" href="#srt-embeddings"></a>
</h3>
<p>To run tSNE in SRTpipeline we use the AddTSNE() function:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SRTProj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/AddTSNE.html">AddTSNE</a></span><span class="op">(</span><span class="va">SRTProj</span>, n_comp <span class="op">=</span> <span class="fl">2</span>, reduction <span class="op">=</span> <span class="st">"aligned.iSC.MEB"</span><span class="op">)</span></code></pre></div>
<p>The <code>reduction</code> tells AddTSNE uses specified reduction in the <code>SRTProj@reductions</code> slot.</p>
<p>To plot the two-dimensional tSNE results, we use the <code><a href="../reference/EmbedPlot.html">EmbedPlot()</a></code> function and pass the name of the UMAP embedding we just generated (“UMAP”). We can tell SRTpipeline how to color the spots by using a combination of cols which tells ArchR which matrix to use to find the specified metadata column provided to name.</p>
<p>DR-SC model can oﬀer good data visualization. We visualized the inferred embeddings for biological eﬀects between domain types using two components from tSNE. The tSNE plot showed the domain clusters were well segregated.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p_tsne2_cluster</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/EmbedPlot.html">EmbedPlot</a></span><span class="op">(</span><span class="va">SRTProj</span>, item <span class="op">=</span> <span class="st">"cluster"</span>, plotEmbeddings <span class="op">=</span> <span class="st">"tSNE"</span>, cols <span class="op">=</span> <span class="fu"><a href="../reference/chooseColors.html">chooseColors</a></span><span class="op">(</span>n_colors <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>,
    legend.position <span class="op">=</span> <span class="st">"bottom"</span>, pt_size <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span>
<span class="va">p_tsne2_batch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/EmbedPlot.html">EmbedPlot</a></span><span class="op">(</span><span class="va">SRTProj</span>, item <span class="op">=</span> <span class="st">"batch"</span>, plotEmbeddings <span class="op">=</span> <span class="st">"tSNE"</span>, cols <span class="op">=</span> <span class="fu"><a href="../reference/chooseColors.html">chooseColors</a></span><span class="op">(</span>palettes_name <span class="op">=</span> <span class="st">"Light 13"</span>,
    n_colors <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="st">"bottom"</span>, pt_size <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span>
<span class="fu"><a href="../reference/drawFigs.html">drawFigs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">p_tsne2_cluster</span>, <span class="va">p_tsne2_batch</span><span class="op">)</span>, layout.dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></code></pre></div>
<p><img src="multibatch_brain12_tutorial_files/figure-html/unnamed-chunk-17-1.png" width="700"> Next, we summarized the inferred embeddings for biological eﬀects between spatial domain types (the slot <code>reductions</code>) using three components from either tSNE or UMAP and visualized the resulting tSNE/UMAP components with red/green/blue (RGB) colors in the RGB plot.</p>
<p>The resulting RGB plots from DR-SC showed the laminar organization of the human cerebral cortex, and DR-SC provided smooth transitions across neighboring spots and spatial domains.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SRTProj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/AddTSNE.html">AddTSNE</a></span><span class="op">(</span><span class="va">SRTProj</span>, n_comp <span class="op">=</span> <span class="fl">3</span>, reduction <span class="op">=</span> <span class="st">"aligned.iSC.MEB"</span><span class="op">)</span>
<span class="va">p_tsne3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/EachRGBSpaHeatMap.html">EachRGBSpaHeatMap</a></span><span class="op">(</span><span class="va">SRTProj</span>, plot_type <span class="op">=</span> <span class="st">"tSNE"</span>, layout.dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span>, pt_size <span class="op">=</span> <span class="fl">2</span>, title_name <span class="op">=</span> <span class="st">"tSNE RGB plot: "</span><span class="op">)</span>
<span class="va">p_tsne3</span></code></pre></div>
<p><img src="multibatch_brain12_tutorial_files/figure-html/unnamed-chunk-18-1.png" width="700"></p>
<p>To run UMAP in SRTpipeline we use the AddUMAP() function. Frist, we evaluate the two-dimensional UMAPs.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SRTProj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/AddUMAP.html">AddUMAP</a></span><span class="op">(</span><span class="va">SRTProj</span>, n_comp <span class="op">=</span> <span class="fl">2</span>, reduction <span class="op">=</span> <span class="st">"aligned.iSC.MEB"</span><span class="op">)</span>
<span class="va">p_umap2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/EmbedPlot.html">EmbedPlot</a></span><span class="op">(</span><span class="va">SRTProj</span>, item <span class="op">=</span> <span class="st">"cluster"</span>, plotEmbeddings <span class="op">=</span> <span class="st">"UMAP"</span>, cols <span class="op">=</span> <span class="fu"><a href="../reference/chooseColors.html">chooseColors</a></span><span class="op">(</span>n_colors <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>,
    legend.position <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span>
<span class="va">p_umap2</span></code></pre></div>
<p><img src="multibatch_brain12_tutorial_files/figure-html/unnamed-chunk-19-1.png" width="700"> Then, we evaluate the three-dimensional UMAPs.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SRTProj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/AddUMAP.html">AddUMAP</a></span><span class="op">(</span><span class="va">SRTProj</span>, n_comp <span class="op">=</span> <span class="fl">3</span>, reduction <span class="op">=</span> <span class="st">"aligned.iSC.MEB"</span><span class="op">)</span>
<span class="va">p_umap3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/EachRGBSpaHeatMap.html">EachRGBSpaHeatMap</a></span><span class="op">(</span><span class="va">SRTProj</span>, plot_type <span class="op">=</span> <span class="st">"UMAP"</span>, layout.dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span>, pt_size <span class="op">=</span> <span class="fl">2</span>, title_name <span class="op">=</span> <span class="st">"UMAP RGB plot: "</span><span class="op">)</span>

<span class="va">p_umap3</span></code></pre></div>
<p><img src="multibatch_brain12_tutorial_files/figure-html/unnamed-chunk-20-1.png" width="700"></p>
<p>To save the plot, we can use <code><a href="../reference/write_fig.html">write_fig()</a></code> function.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/write_fig.html">write_fig</a></span><span class="op">(</span><span class="va">p_umap3</span>, filename <span class="op">=</span> <span class="st">"iSCMEB_p_umap3.png"</span>, width <span class="op">=</span> <span class="fl">14</span>, height <span class="op">=</span> <span class="fl">11</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="visualization">Visualization<a class="anchor" aria-label="anchor" href="#visualization"></a>
</h3>
<p>Except for the embedding plots, SRTpipeline also provides a variaty of visualization functions. First, we visualize the spatial distribution of cluster labels that shows the layer structure for all 12 data batches.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## choose colors to function chooseColors</span>
<span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/chooseColors.html">chooseColors</a></span><span class="op">(</span>n_colors <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>
<span class="va">p12</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/EachClusterSpaHeatMap.html">EachClusterSpaHeatMap</a></span><span class="op">(</span><span class="va">SRTProj</span>, cols <span class="op">=</span> <span class="va">cols</span>, legend.position <span class="op">=</span> <span class="st">"bottom"</span>, base_size <span class="op">=</span> <span class="fl">12</span>, pt_size <span class="op">=</span> <span class="fl">0.5</span>,
    layout.dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span>, nrow.legend <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="va">p12</span></code></pre></div>
<p><img src="multibatch_brain12_tutorial_files/figure-html/unnamed-chunk-22-1.png" width="700"></p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># remove the border EachClusterSpaHeatMap(SRTProj, cols=cols,</span>
<span class="co"># legend.position='right',base_size=16, border_col='white') write_fig(p12, filename =</span>
<span class="co"># 'iSCMEB_p12.png',width =14, height =11)</span></code></pre></div>
<p>By setting <code>combine =FALSE</code>, this function will return a list of ggplot2 objects, thus user can revise each plot.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pList</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/EachClusterSpaHeatMap.html">EachClusterSpaHeatMap</a></span><span class="op">(</span><span class="va">SRTProj</span>, cols <span class="op">=</span> <span class="va">cols</span>, legend.position <span class="op">=</span> <span class="st">"bottom"</span>, base_size <span class="op">=</span> <span class="fl">12</span>,
    pt_size <span class="op">=</span> <span class="fl">0.5</span>, layout.dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span>, nrow.legend <span class="op">=</span> <span class="fl">1</span>, combine <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="co">## Calculate the ARIs and NMIs for each data batch</span>
<span class="va">annotateList</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vec2list.html">vec2list</a></span><span class="op">(</span><span class="va">SRTProj</span><span class="op">@</span><span class="va">cellMetaData</span><span class="op">$</span><span class="va">annotated_label</span>, nvec <span class="op">=</span> <span class="va">SRTProj</span><span class="op">@</span><span class="va">sampleMetaData</span><span class="op">$</span><span class="va">NumOfSpots</span><span class="op">)</span>
<span class="va">clusterList</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vec2list.html">vec2list</a></span><span class="op">(</span><span class="va">SRTProj</span><span class="op">@</span><span class="va">clusters</span>, nvec <span class="op">=</span> <span class="va">SRTProj</span><span class="op">@</span><span class="va">sampleMetaData</span><span class="op">$</span><span class="va">NumOfSpots</span><span class="op">)</span>
<span class="va">ARI_vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">annotateList</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">r</span><span class="op">)</span> <span class="fu"><a href="../reference/cluster_metric.html">cluster_metric</a></span><span class="op">(</span><span class="va">annotateList</span><span class="op">[[</span><span class="va">r</span><span class="op">]</span><span class="op">]</span>, <span class="va">clusterList</span><span class="op">[[</span><span class="va">r</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="va">ARI_vec</span></code></pre></div>
<pre><code><span class="co">## [1] 0.5097505 0.3779750 0.5429999</span></code></pre>
<p>We plotted the heatmap of Pearson’s correlation coefcients of the estimated embeddings among the detected domains shows the good separation of the estimated embeddings across domains and the correlations between deeper layers were high, e.g., there were high correlations between domain 2 and 3, while correlations among the separated layers were low, i.e., domain 1 and 4.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p_cc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CCHeatMap.html">CCHeatMap</a></span><span class="op">(</span><span class="va">SRTProj</span>, reduction <span class="op">=</span> <span class="st">"aligned.iSC.MEB"</span>, grp_color <span class="op">=</span> <span class="va">cols</span><span class="op">)</span>
<span class="va">p_cc</span></code></pre></div>
<p><img src="multibatch_brain12_tutorial_files/figure-html/unnamed-chunk-24-1.png" width="700"></p>
<p>After adding the quantities for data visualization, the <code>SRTProject</code> object will have more information in the downstream analyses information. Now, we print this <code>SRTProject</code> object to check it. We observed two components added in the slot <code>plotEmbeddings</code> (Embeddings for plotting): <code>tSNE</code>, <code>tSNE3</code>, <code>UMAP</code> and <code>UMAP3</code>.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SRTProj</span></code></pre></div>
<pre><code><span class="co">## class: SRTProject </span>
<span class="co">## outputPath: F:\Research paper\IntegrateDRcluster\AnalysisCode\SRTpipeline\vignettes\DLPFC3 </span>
<span class="co">## h5filePath: F:\Research paper\IntegrateDRcluster\AnalysisCode\SRTpipeline\vignettes\DLPFC3/DLPFC3.h5 </span>
<span class="co">## ---------Datasets basic information-----------------</span>
<span class="co">## samples(3): 151507 151669 151673</span>
<span class="co">## sampleColData names(4): species tissues donor NumOfSpots</span>
<span class="co">## cellMetaData names(4): annotated_label row col batch</span>
<span class="co">## numberOfSpots(3): 4226 3661 3639</span>
<span class="co">## ---------Downstream analyses information-----------------</span>
<span class="co">## Variable features:  2000 </span>
<span class="co">## Low-dimensional embeddings(3): PCA microEnv.iSC.MEB aligned.iSC.MEB</span>
<span class="co">## Inferred cluster labels: Yes</span>
<span class="co">## Embedding for plotting(4): tSNE tSNE3 UMAP UMAP3</span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="combined-deg-analysis">Combined DEG analysis<a class="anchor" aria-label="anchor" href="#combined-deg-analysis"></a>
</h2>
<p>After obtain the spatial cluster labels using a clustering model, we can perform differentially expression analysis.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">speInt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getIntegratedData.html">getIntegratedData</a></span><span class="op">(</span><span class="va">SRTProj</span>, Method <span class="op">=</span> <span class="st">"iSC.MEB"</span>, species <span class="op">=</span> <span class="st">"Human"</span><span class="op">)</span></code></pre></div>
<p>First, we detect the DE genes for cluster 3.</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dat_deg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/FindDEGs.html">FindDEGs</a></span><span class="op">(</span><span class="va">speInt</span>, cluster1 <span class="op">=</span> <span class="st">"3"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">dat_deg</span>, <span class="va">avg_log2FC</span> <span class="op">&gt;</span> <span class="fl">0.5</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## DataFrame with 1 row and 5 columns</span>
<span class="co">##             p_val avg_log2FC     pct.1     pct.2    p_val_adj</span>
<span class="co">##         &lt;numeric&gt;  &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;    &lt;numeric&gt;</span>
<span class="co">## Pcp4 9.38956e-173   0.617137     0.776     0.691 1.87791e-169</span></code></pre>
<p>We perform differential expression analysis for all clusters by using <code><a href="https://satijalab.org/seurat/reference/FindAllMarkers.html" class="external-link">FindAllMarkers()</a></code> function, then the DE genes’ information is saved in a data.frame object <code>dat_degs</code>.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dat_degs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/FindAllDEGs.html">FindAllDEGs</a></span><span class="op">(</span><span class="va">speInt</span><span class="op">)</span>
<span class="va">dat_degs</span></code></pre></div>
<pre><code><span class="co">## DataFrame with 327 rows and 7 columns</span>
<span class="co">##                p_val avg_log2FC     pct.1     pct.2    p_val_adj  cluster</span>
<span class="co">##            &lt;numeric&gt;  &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;    &lt;numeric&gt; &lt;factor&gt;</span>
<span class="co">## Mbp      0.00000e+00  -0.429159     0.921     0.944  0.00000e+00        1</span>
<span class="co">## Hpcal1  1.40823e-301   0.577412     0.898     0.672 2.81646e-298        1</span>
<span class="co">## Enc1    4.29637e-261   0.272601     0.991     0.968 8.59274e-258        1</span>
<span class="co">## Plp1    7.43878e-228  -0.473909     0.888     0.909 1.48776e-224        1</span>
<span class="co">## Hopx    3.57081e-187   0.386511     0.924     0.814 7.14162e-184        1</span>
<span class="co">## ...              ...        ...       ...       ...          ...      ...</span>
<span class="co">## Evi2a     0.00201784   0.670291     0.527     0.582            1        7</span>
<span class="co">## Cox7a1    0.00313152  -0.322798     0.952     0.766            1        7</span>
<span class="co">## Plekhg3   0.00498131   0.463233     0.440     0.541            1        7</span>
<span class="co">## Prr18     0.00542455   0.687814     0.505     0.624            1        7</span>
<span class="co">## Gldn      0.00764878   0.681893     0.501     0.594            1        7</span>
<span class="co">##                gene</span>
<span class="co">##         &lt;character&gt;</span>
<span class="co">## Mbp             Mbp</span>
<span class="co">## Hpcal1       Hpcal1</span>
<span class="co">## Enc1           Enc1</span>
<span class="co">## Plp1           Plp1</span>
<span class="co">## Hopx           Hopx</span>
<span class="co">## ...             ...</span>
<span class="co">## Evi2a         Evi2a</span>
<span class="co">## Cox7a1       Cox7a1</span>
<span class="co">## Plekhg3     Plekhg3</span>
<span class="co">## Prr18         Prr18</span>
<span class="co">## Gldn           Gldn</span></code></pre>
<p>We identify the significant DE genes by two criteria: (a) adjustd p-value less than 0.01 and (b) average log fold change greater than 0.4.</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">degs_sig</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">dat_degs</span>, <span class="va">p_val_adj</span> <span class="op">&lt;</span> <span class="fl">0.01</span> <span class="op">&amp;</span> <span class="va">avg_log2FC</span> <span class="op">&gt;</span> <span class="fl">0.25</span><span class="op">)</span>
<span class="va">degs_sig</span></code></pre></div>
<pre><code><span class="co">## DataFrame with 222 rows and 7 columns</span>
<span class="co">##                 p_val avg_log2FC     pct.1     pct.2    p_val_adj  cluster</span>
<span class="co">##             &lt;numeric&gt;  &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;    &lt;numeric&gt; &lt;factor&gt;</span>
<span class="co">## Hpcal1   1.40823e-301   0.577412     0.898     0.672 2.81646e-298        1</span>
<span class="co">## Enc1     4.29637e-261   0.272601     0.991     0.968 8.59274e-258        1</span>
<span class="co">## Hopx     3.57081e-187   0.386511     0.924     0.814 7.14162e-184        1</span>
<span class="co">## Serpine2  6.09920e-72   0.295167     0.781     0.655  1.21984e-68        1</span>
<span class="co">## Cartpt    1.62123e-59   0.388721     0.643     0.533  3.24247e-56        1</span>
<span class="co">## ...               ...        ...       ...       ...          ...      ...</span>
<span class="co">## Gjb1      5.08479e-07   0.614240     0.422     0.612   0.00101696        7</span>
<span class="co">## Usp54     6.70383e-07   0.404278     0.546     0.519   0.00134077        7</span>
<span class="co">## Sox8      1.42277e-06   0.676708     0.557     0.627   0.00284554        7</span>
<span class="co">## Rffl      1.62039e-06   0.343141     0.557     0.497   0.00324077        7</span>
<span class="co">## Ugt8      4.80698e-06   0.757972     0.547     0.625   0.00961396        7</span>
<span class="co">##                 gene</span>
<span class="co">##          &lt;character&gt;</span>
<span class="co">## Hpcal1        Hpcal1</span>
<span class="co">## Enc1            Enc1</span>
<span class="co">## Hopx            Hopx</span>
<span class="co">## Serpine2    Serpine2</span>
<span class="co">## Cartpt        Cartpt</span>
<span class="co">## ...              ...</span>
<span class="co">## Gjb1            Gjb1</span>
<span class="co">## Usp54          Usp54</span>
<span class="co">## Sox8            Sox8</span>
<span class="co">## Rffl            Rffl</span>
<span class="co">## Ugt8            Ugt8</span></code></pre>
<p>In the following, we perform gene set enrichment analysis for the DE genes of each Domain identified by DR-SC model using R package <code>gprofiler2</code>.</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">gprofiler2</span><span class="op">)</span>
<span class="va">termList</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">7</span><span class="op">)</span> <span class="op">{</span>
    <span class="co"># k &lt;- 1</span>
    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"k = "</span>, <span class="va">k</span>, <span class="st">"\n"</span><span class="op">)</span>
    <span class="va">dat_degs_sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">degs_sig</span>, <span class="va">cluster</span> <span class="op">==</span> <span class="va">k</span><span class="op">)</span>

    <span class="va">que1</span> <span class="op">&lt;-</span> <span class="va">dat_degs_sub</span><span class="op">$</span><span class="va">gene</span>
    <span class="va">gostres</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/gprofiler2/man/gost.html" class="external-link">gost</a></span><span class="op">(</span>query <span class="op">=</span> <span class="va">que1</span>, organism <span class="op">=</span> <span class="st">"hsapiens"</span>, correction_method <span class="op">=</span> <span class="st">"fdr"</span><span class="op">)</span>
    <span class="va">termList</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">gostres</span>
<span class="op">}</span></code></pre></div>
<pre><code><span class="co">## k =  1 </span>
<span class="co">## k =  2 </span>
<span class="co">## k =  3 </span>
<span class="co">## k =  4 </span>
<span class="co">## k =  5 </span>
<span class="co">## k =  6 </span>
<span class="co">## k =  7</span></code></pre>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">termList</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">result</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##     query significant      p_value term_size query_size intersection_size</span>
<span class="co">## 1 query_1        TRUE 1.010518e-05       753          8                 6</span>
<span class="co">## 2 query_1        TRUE 1.010518e-05       729          8                 6</span>
<span class="co">## 3 query_1        TRUE 1.010518e-05       721          8                 6</span>
<span class="co">## 4 query_1        TRUE 1.010518e-05       721          8                 6</span>
<span class="co">## 5 query_1        TRUE 9.429021e-05       208          8                 4</span>
<span class="co">## 6 query_1        TRUE 6.917997e-04       104          8                 3</span>
<span class="co">##   precision      recall    term_id source                            term_name</span>
<span class="co">## 1     0.750 0.007968127 GO:0099536  GO:BP                   synaptic signaling</span>
<span class="co">## 2     0.750 0.008230453 GO:0099537  GO:BP             trans-synaptic signaling</span>
<span class="co">## 3     0.750 0.008321775 GO:0007268  GO:BP       chemical synaptic transmission</span>
<span class="co">## 4     0.750 0.008321775 GO:0098916  GO:BP anterograde trans-synaptic signaling</span>
<span class="co">## 5     0.500 0.019230769 GO:0048167  GO:BP    regulation of synaptic plasticity</span>
<span class="co">## 6     0.375 0.028846154 GO:0060291  GO:BP      long-term synaptic potentiation</span>
<span class="co">##   effective_domain_size source_order                parents</span>
<span class="co">## 1                 21092        22305             GO:0007267</span>
<span class="co">## 2                 21092        22306             GO:0099536</span>
<span class="co">## 3                 21092         3155             GO:0098916</span>
<span class="co">## 4                 21092        22136             GO:0099537</span>
<span class="co">## 5                 21092        14572 GO:0050804, GO:0065008</span>
<span class="co">## 6                 21092        17047 GO:0048167, GO:0050806</span></code></pre>
<p>To understand the functions of the identified spatial domains by DR-SC model, we compare the top significant biological process (BP) pathways in GO database for the DE genes from Domain 1 and 2. Here, we only show to visualize the significant BP pathways and users can explore the other databases such as KEGG and HPA.</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Most commonly used databases</span>
<span class="va">source_set</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"GO:BP"</span>, <span class="st">"GO:CC"</span>, <span class="st">"GO:MF"</span>, <span class="st">"KEGG"</span>, <span class="st">"HPA"</span><span class="op">)</span>
<span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"steelblue3"</span>, <span class="st">"goldenrod"</span>, <span class="st">"brown3"</span>, <span class="st">"#f98866"</span>, <span class="st">"#CE6DBD"</span><span class="op">)</span>
<span class="co">## Here, we show GO:BP</span>
<span class="va">source1</span> <span class="op">&lt;-</span> <span class="st">"GO:BP"</span>
<span class="va">ss</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">source_set</span> <span class="op">==</span> <span class="va">source1</span><span class="op">)</span>
<span class="va">ntop</span> <span class="op">=</span> <span class="fl">5</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cols</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">source_set</span>
<span class="va">pList_enrich</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">ii</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span> <span class="op">{</span>
    <span class="co">## ii &lt;- 3</span>
    <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"ii="</span>, <span class="va">ii</span><span class="op">)</span>
    <span class="va">gostres2</span> <span class="op">&lt;-</span> <span class="va">termList</span><span class="op">[[</span><span class="va">ii</span><span class="op">]</span><span class="op">]</span>
    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">gostres2</span><span class="op">$</span><span class="va">result</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
        <span class="va">dat1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">gostres2</span><span class="op">$</span><span class="va">result</span>, <span class="va">term_size</span> <span class="op">&lt;</span> <span class="fl">500</span><span class="op">)</span>
        <span class="va">dat1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_top_pathway.html">get_top_pathway</a></span><span class="op">(</span><span class="va">dat1</span>, ntop <span class="op">=</span> <span class="va">ntop</span>, source_set <span class="op">=</span> <span class="va">source1</span><span class="op">)</span>
        <span class="va">dat1</span> <span class="op">&lt;-</span> <span class="va">dat1</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html" class="external-link">complete.cases</a></span><span class="op">(</span><span class="va">dat1</span><span class="op">)</span>, <span class="op">]</span>
        <span class="va">dat1</span><span class="op">$</span><span class="va">nlog10P</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">dat1</span><span class="op">$</span><span class="va">p_value</span><span class="op">)</span>

        <span class="va">pList_enrich</span><span class="op">[[</span><span class="va">ii</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/barPlot_enrich.html">barPlot_enrich</a></span><span class="op">(</span><span class="va">dat1</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">dat1</span><span class="op">$</span><span class="va">nlog10P</span><span class="op">)</span>, <span class="op">]</span>, source <span class="op">=</span> <span class="st">"source"</span>, <span class="st">"term_name"</span>,
            <span class="st">"nlog10P"</span>, cols <span class="op">=</span> <span class="va">cols</span><span class="op">[</span><span class="va">source_set</span><span class="op">[</span><span class="va">ss</span><span class="op">]</span><span class="op">]</span>, base_size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ylab</span><span class="op">(</span><span class="st">"-log10(p-adj)"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">xlab</span><span class="op">(</span><span class="st">"Biological terms"</span><span class="op">)</span> <span class="op">+</span>
            <span class="fu">ggtitle</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Domain"</span>, <span class="va">ii</span><span class="op">)</span><span class="op">)</span>
    <span class="op">}</span>

<span class="op">}</span>

<span class="fu"><a href="../reference/drawFigs.html">drawFigs</a></span><span class="op">(</span><span class="va">pList_enrich</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">]</span>, layout.dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span>, common.legend <span class="op">=</span> <span class="cn">T</span>, align <span class="op">=</span> <span class="st">"hv"</span><span class="op">)</span></code></pre></div>
<p><img src="multibatch_brain12_tutorial_files/figure-html/unnamed-chunk-31-1.png" width="700"></p>
<p>We take out the top DE genes for each cluster for visualization.</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>
<span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">5</span>
<span class="va">dat_degs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="va">as.data.frame</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">cluster</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/top_n.html" class="external-link">top_n</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, wt <span class="op">=</span> <span class="va">avg_log2FC</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">topGene</span>
<span class="va">topGene</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 35 x 7</span></span>
<span class="co">## <span style="color: #949494;"># Groups:   cluster [7]</span></span>
<span class="co">##        p_val avg_log2FC pct.1 pct.2 p_val_adj cluster gene    </span>
<span class="co">##        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   </span>
<span class="co">## <span style="color: #BCBCBC;"> 1</span> 1.41<span style="color: #949494;">e</span><span style="color: #BB0000;">-301</span>      0.577 0.898 0.672 2.82<span style="color: #949494;">e</span><span style="color: #BB0000;">-298</span> 1       Hpcal1  </span>
<span class="co">## <span style="color: #BCBCBC;"> 2</span> 3.57<span style="color: #949494;">e</span><span style="color: #BB0000;">-187</span>      0.387 0.924 0.814 7.14<span style="color: #949494;">e</span><span style="color: #BB0000;">-184</span> 1       Hopx    </span>
<span class="co">## <span style="color: #BCBCBC;"> 3</span> 6.10<span style="color: #949494;">e</span><span style="color: #BB0000;">- 72</span>      0.295 0.781 0.655 1.22<span style="color: #949494;">e</span><span style="color: #BB0000;">- 68</span> 1       Serpine2</span>
<span class="co">## <span style="color: #BCBCBC;"> 4</span> 1.62<span style="color: #949494;">e</span><span style="color: #BB0000;">- 59</span>      0.389 0.643 0.533 3.24<span style="color: #949494;">e</span><span style="color: #BB0000;">- 56</span> 1       Cartpt  </span>
<span class="co">## <span style="color: #BCBCBC;"> 5</span> 2.92<span style="color: #949494;">e</span><span style="color: #BB0000;">- 48</span>      0.304 0.659 0.569 5.84<span style="color: #949494;">e</span><span style="color: #BB0000;">- 45</span> 1       Sowaha  </span>
<span class="co">## <span style="color: #BCBCBC;"> 6</span> 3.51<span style="color: #949494;">e</span><span style="color: #BB0000;">-194</span>      0.268 0.977 0.957 7.03<span style="color: #949494;">e</span><span style="color: #BB0000;">-191</span> 2       Nefl    </span>
<span class="co">## <span style="color: #BCBCBC;"> 7</span> 1.04<span style="color: #949494;">e</span><span style="color: #BB0000;">-145</span>      0.365 0.871 0.825 2.07<span style="color: #949494;">e</span><span style="color: #BB0000;">-142</span> 2       Nefm    </span>
<span class="co">## <span style="color: #BCBCBC;"> 8</span> 2.97<span style="color: #949494;">e</span><span style="color: #BB0000;">- 74</span>      0.267 0.852 0.831 5.95<span style="color: #949494;">e</span><span style="color: #BB0000;">- 71</span> 2       Sncg    </span>
<span class="co">## <span style="color: #BCBCBC;"> 9</span> 7.35<span style="color: #949494;">e</span><span style="color: #BB0000;">- 59</span>      0.292 0.779 0.76  1.47<span style="color: #949494;">e</span><span style="color: #BB0000;">- 55</span> 2       Scn1b   </span>
<span class="co">## <span style="color: #BCBCBC;">10</span> 7.22<span style="color: #949494;">e</span><span style="color: #BB0000;">- 14</span>      0.278 0.619 0.634 1.44<span style="color: #949494;">e</span><span style="color: #BB0000;">- 10</span> 2       Nefh    </span>
<span class="co">## <span style="color: #949494;"># ... with 25 more rows</span></span></code></pre>
<p>We visualize the DE genes for each cluster group by gene-by-cell heatmap using the <code><a href="../reference/GCHeatMap.html">GCHeatMap()</a></code> function.</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cols_cluster</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/chooseColors.html">chooseColors</a></span><span class="op">(</span>n_colors <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>

<span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GCHeatMap.html">GCHeatMap</a></span><span class="op">(</span><span class="va">speInt</span>, features <span class="op">=</span> <span class="va">topGene</span><span class="op">$</span><span class="va">gene</span>, grp_color <span class="op">=</span> <span class="va">cols_cluster</span>, y_text_size <span class="op">=</span> <span class="fl">9</span><span class="op">)</span>
<span class="va">p1</span></code></pre></div>
<p><img src="multibatch_brain12_tutorial_files/figure-html/unnamed-chunk-33-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="trajectory-inference">Trajectory inference<a class="anchor" aria-label="anchor" href="#trajectory-inference"></a>
</h2>
<p>Next, we performed trajectory inference using the embeddings and domain labels estimated by DR-SC model.</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">speInt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/AddTrajectory.html">AddTrajectory</a></span><span class="op">(</span><span class="va">speInt</span>, reduction <span class="op">=</span> <span class="st">"aligned.iSC.MEB"</span><span class="op">)</span>

<span class="fu"><a href="../reference/EmbedPlot.html">EmbedPlot</a></span><span class="op">(</span><span class="va">speInt</span>, plotEmbeddings <span class="op">=</span> <span class="st">"tSNE"</span>, colour_by <span class="op">=</span> <span class="st">"PT"</span><span class="op">)</span></code></pre></div>
<p><img src="multibatch_brain12_tutorial_files/figure-html/unnamed-chunk-34-1.png" width="700"></p>
<p>Visualize the inferred pseudotime on the spatial coordinates for each data batch.</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p_spa</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/EachEmbedPlot.html">EachEmbedPlot</a></span><span class="op">(</span><span class="va">speInt</span>, reduction <span class="op">=</span> <span class="st">"Coord"</span>, colour_by <span class="op">=</span> <span class="st">"PT"</span>, layout.dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span>, add_border_box <span class="op">=</span> <span class="cn">T</span>,
    no_axis <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">p_spa</span></code></pre></div>
<p><img src="multibatch_brain12_tutorial_files/figure-html/unnamed-chunk-35-1.png" width="700"></p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># save(SRTProj, file=paste0(SRTProj@projectMetadata$outputPath,'/SRTProj.rds'))</span>
<span class="co"># load('F://Research</span>
<span class="co"># paper//IntegrateDRcluster//AnalysisCode//SRTpipeline//vignettes//DLPFC12V2//SRTProj.rds')</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="other-downstream-analyses">Other downstream analyses<a class="anchor" aria-label="anchor" href="#other-downstream-analyses"></a>
</h2>
<details><p><summary><strong>Session Info</strong></summary></p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## R version 4.1.2 (2021-11-01)</span>
<span class="co">## Platform: x86_64-w64-mingw32/x64 (64-bit)</span>
<span class="co">## Running under: Windows 10 x64 (build 22621)</span>
<span class="co">## </span>
<span class="co">## Matrix products: default</span>
<span class="co">## </span>
<span class="co">## locale:</span>
<span class="co">## [1] LC_COLLATE=Chinese (Simplified)_China.936 </span>
<span class="co">## [2] LC_CTYPE=Chinese (Simplified)_China.936   </span>
<span class="co">## [3] LC_MONETARY=Chinese (Simplified)_China.936</span>
<span class="co">## [4] LC_NUMERIC=C                              </span>
<span class="co">## [5] LC_TIME=Chinese (Simplified)_China.936    </span>
<span class="co">## </span>
<span class="co">## attached base packages:</span>
<span class="co">## [1] parallel  stats4    stats     graphics  grDevices utils     datasets </span>
<span class="co">## [8] methods   base     </span>
<span class="co">## </span>
<span class="co">## other attached packages:</span>
<span class="co">##  [1] scater_1.25.1               scuttle_1.4.0              </span>
<span class="co">##  [3] slingshot_2.2.0             TrajectoryUtils_1.2.0      </span>
<span class="co">##  [5] princurve_2.1.6             gprofiler2_0.2.1           </span>
<span class="co">##  [7] bigalgebra_1.1.0            bigmemory_4.5.36           </span>
<span class="co">##  [9] SpatialExperiment_1.4.0     SingleCellExperiment_1.16.0</span>
<span class="co">## [11] SummarizedExperiment_1.24.0 GenomicRanges_1.46.1       </span>
<span class="co">## [13] GenomeInfoDb_1.30.1         MatrixGenerics_1.6.0       </span>
<span class="co">## [15] matrixStats_0.62.0          aricode_1.0.0              </span>
<span class="co">## [17] mclust_5.4.10               colorspace_2.0-3           </span>
<span class="co">## [19] iSC.MEB_1.0.1               gtools_3.9.2.2             </span>
<span class="co">## [21] DR.SC_3.1                   spatstat.geom_2.4-0        </span>
<span class="co">## [23] spatstat.data_3.0-0         ggplot2_3.3.6              </span>
<span class="co">## [25] dplyr_1.0.9                 Matrix_1.4-0               </span>
<span class="co">## [27] hdf5r_1.3.5                 ff_4.0.7                   </span>
<span class="co">## [29] bit_4.0.4                   rhdf5_2.38.0               </span>
<span class="co">## [31] org.Hs.eg.db_3.14.0         AnnotationDbi_1.56.2       </span>
<span class="co">## [33] IRanges_2.28.0              S4Vectors_0.32.3           </span>
<span class="co">## [35] Biobase_2.54.0              BiocGenerics_0.40.0        </span>
<span class="co">## [37] sp_1.5-0                    SeuratObject_4.1.0         </span>
<span class="co">## [39] Seurat_4.1.1                SRTpipeline_0.1.1          </span>
<span class="co">## </span>
<span class="co">## loaded via a namespace (and not attached):</span>
<span class="co">##   [1] scattermore_0.8           ggthemes_4.2.4           </span>
<span class="co">##   [3] R.methodsS3_1.8.1         GiRaF_1.0.1              </span>
<span class="co">##   [5] ragg_1.2.2                tidyr_1.2.0              </span>
<span class="co">##   [7] bit64_4.0.5               knitr_1.37               </span>
<span class="co">##   [9] R.utils_2.11.0            irlba_2.3.5              </span>
<span class="co">##  [11] DelayedArray_0.20.0       data.table_1.14.2        </span>
<span class="co">##  [13] rpart_4.1.16              KEGGREST_1.34.0          </span>
<span class="co">##  [15] RCurl_1.98-1.6            generics_0.1.2           </span>
<span class="co">##  [17] ScaledMatrix_1.2.0        cowplot_1.1.1            </span>
<span class="co">##  [19] RSQLite_2.2.10            RANN_2.6.1               </span>
<span class="co">##  [21] future_1.26.1             httpuv_1.6.5             </span>
<span class="co">##  [23] assertthat_0.2.1          viridis_0.6.2            </span>
<span class="co">##  [25] xfun_0.29                 jquerylib_0.1.4          </span>
<span class="co">##  [27] evaluate_0.15             promises_1.2.0.1         </span>
<span class="co">##  [29] fansi_1.0.3               igraph_1.3.5             </span>
<span class="co">##  [31] DBI_1.1.2                 htmlwidgets_1.5.4        </span>
<span class="co">##  [33] purrr_0.3.4               ellipsis_0.3.2           </span>
<span class="co">##  [35] RSpectra_0.16-1           ggpubr_0.4.0             </span>
<span class="co">##  [37] backports_1.4.1           deldir_1.0-6             </span>
<span class="co">##  [39] sparseMatrixStats_1.6.0   vctrs_0.4.1              </span>
<span class="co">##  [41] ROCR_1.0-11               abind_1.4-5              </span>
<span class="co">##  [43] cachem_1.0.6              withr_2.5.0              </span>
<span class="co">##  [45] PRECAST_1.4               progressr_0.10.1         </span>
<span class="co">##  [47] sctransform_0.3.3         goftest_1.2-3            </span>
<span class="co">##  [49] cluster_2.1.2             lazyeval_0.2.2           </span>
<span class="co">##  [51] crayon_1.5.1              SpatialAnno_1.0.0        </span>
<span class="co">##  [53] edgeR_3.36.0              pkgconfig_2.0.3          </span>
<span class="co">##  [55] labeling_0.4.2            nlme_3.1-155             </span>
<span class="co">##  [57] vipor_0.4.5               rlang_1.0.2              </span>
<span class="co">##  [59] globals_0.15.0            lifecycle_1.0.1          </span>
<span class="co">##  [61] miniUI_0.1.1.1            bigmemory.sri_0.1.3      </span>
<span class="co">##  [63] rsvd_1.0.5                rprojroot_2.0.3          </span>
<span class="co">##  [65] polyclip_1.10-0           lmtest_0.9-40            </span>
<span class="co">##  [67] SC.MEB_1.1                carData_3.0-5            </span>
<span class="co">##  [69] Rhdf5lib_1.16.0           zoo_1.8-10               </span>
<span class="co">##  [71] beeswarm_0.4.0            ggridges_0.5.3           </span>
<span class="co">##  [73] rjson_0.2.21              png_0.1-7                </span>
<span class="co">##  [75] viridisLite_0.4.0         bitops_1.0-7             </span>
<span class="co">##  [77] R.oo_1.24.0               KernSmooth_2.23-20       </span>
<span class="co">##  [79] rhdf5filters_1.6.0        Biostrings_2.62.0        </span>
<span class="co">##  [81] blob_1.2.2                DelayedMatrixStats_1.16.0</span>
<span class="co">##  [83] stringr_1.4.0             parallelly_1.32.0        </span>
<span class="co">##  [85] spatstat.random_2.2-0     rstatix_0.7.0            </span>
<span class="co">##  [87] ggsignif_0.6.3            beachmat_2.10.0          </span>
<span class="co">##  [89] scales_1.2.0              memoise_2.0.1            </span>
<span class="co">##  [91] magrittr_2.0.3            plyr_1.8.7               </span>
<span class="co">##  [93] ica_1.0-2                 zlibbioc_1.40.0          </span>
<span class="co">##  [95] compiler_4.1.2            dqrng_0.3.0              </span>
<span class="co">##  [97] RColorBrewer_1.1-3        fitdistrplus_1.1-8       </span>
<span class="co">##  [99] cli_3.2.0                 XVector_0.34.0           </span>
<span class="co">## [101] listenv_0.8.0             patchwork_1.1.1          </span>
<span class="co">## [103] pbapply_1.5-0             formatR_1.11             </span>
<span class="co">## [105] MASS_7.3-55               mgcv_1.8-39              </span>
<span class="co">## [107] tidyselect_1.1.2          stringi_1.7.6            </span>
<span class="co">## [109] textshaping_0.3.6         highr_0.9                </span>
<span class="co">## [111] yaml_2.3.6                locfit_1.5-9.4           </span>
<span class="co">## [113] BiocSingular_1.10.0       ggrepel_0.9.1            </span>
<span class="co">## [115] grid_4.1.2                sass_0.4.1               </span>
<span class="co">## [117] tools_4.1.2               future.apply_1.9.0       </span>
<span class="co">## [119] rstudioapi_0.13           gridExtra_2.3            </span>
<span class="co">## [121] farver_2.1.0              Rtsne_0.16               </span>
<span class="co">## [123] DropletUtils_1.14.2       digest_0.6.29            </span>
<span class="co">## [125] rgeos_0.5-9               shiny_1.7.1              </span>
<span class="co">## [127] Rcpp_1.0.10               car_3.0-12               </span>
<span class="co">## [129] broom_0.7.12              later_1.3.0              </span>
<span class="co">## [131] RcppAnnoy_0.0.19          httr_1.4.3               </span>
<span class="co">## [133] fs_1.5.2                  tensor_1.5               </span>
<span class="co">## [135] reticulate_1.25           splines_4.1.2            </span>
<span class="co">## [137] uwot_0.1.11               spatstat.utils_3.0-1     </span>
<span class="co">## [139] pkgdown_2.0.6             plotly_4.10.0            </span>
<span class="co">## [141] systemfonts_1.0.4         xtable_1.8-4             </span>
<span class="co">## [143] jsonlite_1.8.0            R6_2.5.1                 </span>
<span class="co">## [145] pillar_1.7.0              htmltools_0.5.2          </span>
<span class="co">## [147] mime_0.12                 glue_1.6.2               </span>
<span class="co">## [149] fastmap_1.1.0             BiocParallel_1.28.3      </span>
<span class="co">## [151] BiocNeighbors_1.12.0      codetools_0.2-18         </span>
<span class="co">## [153] utf8_1.2.2                lattice_0.20-45          </span>
<span class="co">## [155] bslib_0.3.1               spatstat.sparse_2.1-1    </span>
<span class="co">## [157] tibble_3.1.7              ggbeeswarm_0.6.0         </span>
<span class="co">## [159] leiden_0.4.2              magick_2.7.3             </span>
<span class="co">## [161] limma_3.50.1              survival_3.2-13          </span>
<span class="co">## [163] CompQuadForm_1.4.3        rmarkdown_2.11           </span>
<span class="co">## [165] desc_1.4.0                munsell_0.5.0            </span>
<span class="co">## [167] GenomeInfoDbData_1.2.7    HDF5Array_1.22.1         </span>
<span class="co">## [169] reshape2_1.4.4            gtable_0.3.0             </span>
<span class="co">## [171] spatstat.core_2.4-4</span></code></pre>
</details>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Wei Liu, Yi Yang, Xu Liao, Xiao Zhang, Jin Liu.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
