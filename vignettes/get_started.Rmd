---
title: "Getting Started with SRTpipeline"
output:
  html_document:
    theme: united
    df_print: kable
  pdf_document: default
---

```{r fxns, include = FALSE}
library('htmlTable')
make_list <- function(items) {
  paste0("<ul>", sprintf('<li>%s</li>', items), '</ul>', collapse = '')
}
make_href <- function(url, text){
  paste0("<div style='text-align:center; font-size:large; font-weight:bold'><a href=", url ,">", text, "</a></div>")
}
make_href2 <- function(url, text){
  paste0("<a href=", url ,">", text, "</a>")
}
process_entry <- function(dat) {
  if (grepl(pattern = "https://satijalab.org/img/vignette_images", x = dat$image)) {
    img <- paste0('![](', dat$image, '){width=3000px}')
  } else if (grepl(pattern = "./assets/", x= dat$image)) {
    img <- paste0('![](', './references/figures/',dat$image, '){width=3000px}') 
  } else {
    img <- paste0('![](', './references/figures/', dat$image, '){width=3000px}')
  }
  if (grepl(pattern = "https://github.com/feiyoung/SRTpipeline/tree/master/docs/reference/figures", x = dat$name)) {
    link <- dat$name
  } else {
    link <- paste0(dat$name, ".html")
  }
  go.button <- paste0('<a class="btn btn-primary" href="', link, '" role="button" style="width:100%">GO</a>')
  data.frame(
    title = make_href(url = link, text = dat$title),
    img = img,
    desc = dat$summary,
    btn = go.button
  )
}
process_wrapper_entry <- function(dat) {
  data.frame(
    Package = dat$name,
    Vignette = make_href2(url = dat$link, text = dat$title),
    Reference = make_href2(url = dat$reference, text = dat$citation),
    Source = make_href2(url = dat$source, text = dat$source)
  )
}
make_vignette_card_section <- function(vdat, cat) {
  vignettes <- vdat[[cat]]$vignettes
  dat <- data.frame(title = character(), img = character(), desc = character())
  for (v in 1:length(x = vignettes)) {
    # v <- 1
    dat <- rbind(dat, process_entry(vignettes[[v]]))
    # dat <- dat[,-2]
    if(nrow(x = dat) == 3 | v == length(x = vignettes)){
      colnames(dat) <- NULL
      dat <- t(dat)
      if (ncol(x = dat) == 2) {
        print(htmlTable(
          dat,  # dat[-2,],
          align = '|l|l|', 
          css.cell = "padding-left: .75em; width: 50%", 
          css.class = "two-column-htmltable"
        ))
      } else if (ncol(x = dat) == 1){
        print(htmlTable(
          dat, # dat[-2,],
          align = '|l|', 
          css.cell = "padding-left: .75em; width: 100%", 
          css.class = "one-column-htmltable"
        ))
      } else {
        print(htmlTable(
          dat,  # dat[-2,],
          align = '|l|l|l|', 
          css.cell = "padding-left: .75em; width: 30%"
        ))
      }
      dat <- data.frame(title = character(), img = character(), desc = character())
    }
  }
}

make_vignette_card_dat <- function(vdat, cat) {
  vignettes <- vdat[[cat]]$vignettes
  dat <- data.frame(title = character(), img = character(), desc = character())
  for (v in 1:length(x = vignettes)) {
    # v <- 1
    dat <- rbind(dat, process_entry(vignettes[[v]]))
    # dat <- dat[,-2]
    if(nrow(x = dat) == 3 | v == length(x = vignettes)){
      colnames(dat) <- NULL
      dat <- t(dat)
    }
  }
  return(dat)
}
```

```{r yaml, include = FALSE}
library(yaml)
vdat <- read_yaml(file = "vignettes.yaml")
```

```{=html}
<style>
.two-column-htmltable {
  width: 66.666%;
}
.one-column-htmltable {
  width: 33.333%;
}

</style>
```

We provide a series of vignettes, tutorials, and analysis walkthroughs to help users get started with SRTpipeline. You can also check out our [Reference page](../reference/index.html) which contains a full list of functions available to users.

# Introductory Vignettes

For new users of SRTpipeline, we suggest starting with a guided walk through of  a spatial transcriptomics dataset (SampleID: 151672) for human dorsolateral prefrontal cortex (DLPFC). This tutorial implements the major components of a standard unsupervised clustering workflow including QC and data filtration, calculation of high-variance genes or spatially variable genes, dimensional reduction, Markov random field-based spatial clustering, and the identification of cluster markers.

We provide additional introductory vignettes for users who are interested in analyzing multiple datasets.

```{r results='asis', echo=FALSE, warning=FALSE, message = FALSE}
make_vignette_card_section(vdat = vdat, cat = 1)
```
# Single SRT Data Analyses

Recently, we have developed computational methods ( [SC-MEB](https://doi.org/10.1093/bib/bbab466), [DR-SC](https://doi.org/10.1093/nar/gkac219) and [SpatialAnno](https://doi.org/10.1101/2023.02.08.527590)) for  analysis of slngle SRT dataset generated by different platforms. As an example, we provide a guided walk through for analyzing a mouse embryo seqFISH dataset and a mouse olfactory bulb ST dataset. The workflow consists of QC and data filtration, calculation of high-variance genes or spatially variable genes, dimension reduction, spatial clustering/annotation, the identification of cluster markers and trajectory inference.

```{r results='asis', echo=FALSE, warning=FALSE, message = FALSE}
make_vignette_card_section(vdat = vdat, cat = 2)
```

# Mulitple SRT Data Integration

Recently, we have developed computational methods ( [PRECAST](https://doi.org/10.1038/s41467-023-35947-w) and [iSC.MEB](https://doi.org/10.1093/bioadv/vbad019))  for integrated analysis of SRT datasets generated across different conditions, experimental batches, individuals or datasets with only partially shared cell/domain clusters. As an example, we provide a guided walk through for integrating and comparing hepatocellular carcinoma (HCC) Visium data generated under different  conditions. There are four slides of in-house HCC data generated using the 10x Visium platform, with two slides from tumors (HCC1 and HCC2) and two from tumor-adjacent tissues (HCC3 and HCC4) from an HCC patient. We provide additional vignettes demonstrating how to leverage iSC.MEB to efficiently integrate large datasets.

```{r results='asis', echo=FALSE, warning=FALSE, message = FALSE}
make_vignette_card_section(vdat = vdat, cat = 3)
```

# Other 

Here we provide a series of short vignettes to demonstrate a number of features that are commonly used in SRTpipeline. Weâ€™ve focused the vignettes around questions that we frequently receive from users. Click on a vignette to get started.

```{r results='asis', echo=FALSE, warning=FALSE, message = FALSE}
make_vignette_card_section(vdat = vdat, cat = 4)
```
